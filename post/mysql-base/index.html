<!doctype html>
<html lang="en-us">
  <head>
    <title>MySQL 基础学习 // 洛七的摸鱼池塘</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="洛七" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="MySQL 基础学习"/>
<meta name="twitter:description" content="1. 数据库概述 1. 为什么要使用数据库 为了持久化数据, 把数据保存到可掉电式存储设备中以供之后使用。持久化的主要作用是将内存中的数据存储在关系型数据库中, 当然也可以存储在磁盘文件、XML 数据文件中。但是数据量大的时候MySQL效率更高.
2. 数据库与数据库管理系统 2.1 数据库的相关概念
 DB: 数据库(Database): 本质是一个文件系统 DBMS: 数据库管理系统(DB Management System): 一种操作数据库的软件, 用域建立、使用和维护数据库 SQL: 结构化查询语言  2.2 数据库与数据库管理系统的关系
MySQL其实是数据库管理系统
2.3 常见的数据库管理系统
MySQL, Oracle, Redis, MongDB, PostgreSQL, SQLite 等等
3. MySQL 介绍 Sun 收购 MySQL, 然后 Oracle 收购 SUN.
MySQL 6.x 之后分为社区版和商业版
MySQL 在32最大表文件最大4GB, 64位支持最大8TB表文件
存储引擎一开始用的 MyISAM, 后面转为默认 InnoDB 引擎.
Oracle 适合大公司, 对于费用不敏感的.
4. RDMBS 和 非RDMBS RDBMS 是现在的一个主流, 使用最多的是 Oracle, MySQL, SQL server, 都是关系型数据库."/>

    <meta property="og:title" content="MySQL 基础学习" />
<meta property="og:description" content="1. 数据库概述 1. 为什么要使用数据库 为了持久化数据, 把数据保存到可掉电式存储设备中以供之后使用。持久化的主要作用是将内存中的数据存储在关系型数据库中, 当然也可以存储在磁盘文件、XML 数据文件中。但是数据量大的时候MySQL效率更高.
2. 数据库与数据库管理系统 2.1 数据库的相关概念
 DB: 数据库(Database): 本质是一个文件系统 DBMS: 数据库管理系统(DB Management System): 一种操作数据库的软件, 用域建立、使用和维护数据库 SQL: 结构化查询语言  2.2 数据库与数据库管理系统的关系
MySQL其实是数据库管理系统
2.3 常见的数据库管理系统
MySQL, Oracle, Redis, MongDB, PostgreSQL, SQLite 等等
3. MySQL 介绍 Sun 收购 MySQL, 然后 Oracle 收购 SUN.
MySQL 6.x 之后分为社区版和商业版
MySQL 在32最大表文件最大4GB, 64位支持最大8TB表文件
存储引擎一开始用的 MyISAM, 后面转为默认 InnoDB 引擎.
Oracle 适合大公司, 对于费用不敏感的.
4. RDMBS 和 非RDMBS RDBMS 是现在的一个主流, 使用最多的是 Oracle, MySQL, SQL server, 都是关系型数据库." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Lu0key.github.io/post/mysql-base/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2024-03-24T20:37:52&#43;08:00" />
<meta property="article:modified_time" content="2024-03-24T20:37:52&#43;08:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://Lu0key.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="洛七" /></a>
      <span class="app-header-title">洛七的摸鱼池塘</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>即将没书读的咸鱼</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">MySQL 基础学习</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Mar 24, 2024
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          80 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://Lu0key.github.io/tags/mysql/">MySQL</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h2 id="1-数据库概述">1. 数据库概述</h2>
<h3 id="1-为什么要使用数据库">1. 为什么要使用数据库</h3>
<p>为了持久化数据, 把数据保存到可掉电式存储设备中以供之后使用。持久化的主要作用是将内存中的数据存储在关系型数据库中, 当然也可以存储在磁盘文件、XML 数据文件中。但是数据量大的时候MySQL效率更高.</p>
<h3 id="2-数据库与数据库管理系统">2. 数据库与数据库管理系统</h3>
<p>2.1 数据库的相关概念</p>
<ul>
<li>DB: 数据库(Database): 本质是一个文件系统</li>
<li>DBMS: 数据库管理系统(DB Management System): 一种操作数据库的软件, 用域建立、使用和维护数据库</li>
<li>SQL: 结构化查询语言</li>
</ul>
<p>2.2 数据库与数据库管理系统的关系</p>
<p>MySQL其实是数据库管理系统</p>
<p>2.3 常见的数据库管理系统</p>
<p>MySQL, Oracle, Redis, MongDB, PostgreSQL, SQLite 等等</p>
<h3 id="3-mysql-介绍">3. MySQL 介绍</h3>
<p>Sun 收购 MySQL, 然后 Oracle 收购 SUN.</p>
<p>MySQL 6.x 之后分为社区版和商业版</p>
<p>MySQL 在32最大表文件最大4GB, 64位支持最大8TB表文件</p>
<p>存储引擎一开始用的 MyISAM, 后面转为默认 InnoDB 引擎.</p>
<p>Oracle 适合大公司, 对于费用不敏感的.</p>
<h3 id="4-rdmbs-和-非rdmbs">4. RDMBS 和 非RDMBS</h3>
<p>RDBMS 是现在的一个主流, 使用最多的是 Oracle, MySQL, SQL server, 都是关系型数据库.</p>
<p>4.1 关系型数据库</p>
<p>关系型数据库模型十八复杂的数据结构归结位简单的二元关系, 即二维表</p>
<p>优势:</p>
<ul>
<li>复杂查询: 可以用SQL语句方便地在一个表和多个表之间做复杂的数据查询</li>
<li>事务支持, 是的对于安全性能很高的数据访问要求得以实现</li>
</ul>
<p>4.2 非关系型数据库</p>
<p>可以看成传统关系型数据库的功能阉割版, 轻量版, 基于对键值对存储数据, 不需要经过SQL层的解析, 性能<strong>非常高</strong>。同时减少不常用的功能进一步提高性能。</p>
<ul>
<li>键值型的数据库 Redis K:V</li>
<li>文档型的数据库 MongoDB, 可以存放并获取文档, 可以是XML, JSON等格式.</li>
<li>搜索引擎数据库: Solr, ES</li>
<li>列式数据库： 相对于MySQL这种行式存储, 适合用于分布式文件系统, HBase</li>
<li>图数据库: Neo4J</li>
</ul>
<p>NoSQL 对于关系型数据库是一个很好的补充, 用于一些适合非关系数据库的场景, 比如日志收集, 排行榜, 定时器等</p>
<p>4.3 小结</p>
<p>NoSQL 分类很多, 除去SQL的都算NoSQL, 但是还是SQL的阵营很强大.</p>
<h3 id="5-关系型数据库设计规则">5. 关系型数据库设计规则</h3>
<ul>
<li>关系型数据库的典型数据结构就是数据表, 数据表都是结构化的</li>
<li>将数据放到表中, 表放到数据库中</li>
<li>一个数据库中可以有多个表, 每个表都有一个名字, 具有唯一性</li>
</ul>
<p>5.1 表、记录、字段</p>
<ul>
<li>E-R（Entity-relationship, 实体-联系）模型中有个三个主要概念是：实体集、属性、联系集</li>
<li>一个实体集（class）对应于数据库中的一个表（table）, 一个实体（instance）则对应数据库表中的一行（row）, 也称为一条记录（record）。一个属性（attribute）对应于数据库表中的一列（column）, 也成为一个字段（filed）。</li>
</ul>
<pre><code>ORM 思想（Object Relational Mapping）体现：
数据库一个表 对应 Java中一个类
表中一条数据 对应 一个对象, 实体
表中一个列 对应 类中的一个字段或属性
</code></pre><p>5.2 表的关联关系</p>
<ul>
<li>表与表之间的数据记录有关系（relationship）。现实世界中的各种实体以及实体之间的各种联系均用关系模型表示</li>
<li>四种：一对一关联、一对多关联, 多对多关联, 自我引用</li>
</ul>
<p>5.2.1 一对一关联（one-to-one）</p>
<ul>
<li>实际的开发中应用不对, 因为效率不高</li>
<li>例如设计学生表：学号、姓名、手机号、班级、身份证号、籍贯。。。。。
<ul>
<li>可以拆分成两个表</li>
<li>基础信息表（常用信息表）：学号、姓名、手机号、班级</li>
<li>档案信息表（不常用信息表）：学号、籍贯、家庭住址</li>
</ul>
</li>
<li>两种建表原则
<ul>
<li>外键唯一：主表的逐渐和从表的外键（唯一）, 形成主外键关系, 外键唯一</li>
<li>外键是逐渐：主表的主键和从表的主键, 形成主外键关系。</li>
</ul>
</li>
</ul>
<p>5.2.2 一对多关系（one-to-many）</p>
<ul>
<li>常见示例场景：客户表和订单表, 分类表和商品表, 部门表和员工表</li>
</ul>
<p>一个部门编号, 在别的表里一个部门编号会对应多个员工</p>
<p>5.2.3 多对多关系（many-to-many）</p>
<p>要表示多对多关系, 必须创建第三个表, 该表通常称为联接表, 他将多对多关系划分为两个一对多关系, 将这两个表的主键都插入到第三个表中</p>
<ul>
<li>例如：学生和课程</li>
<li>例如: 用户和角色</li>
</ul>
<p>5.2.4 自我引用（self refence）</p>
<p>比如员工表, 有一个字段是该员工的主管编号, 这个字段来自于员工表里的员工编号. 因此是自我引用.</p>
<h2 id="2-mysql-环境搭建">2. MySQL 环境搭建</h2>
<h3 id="1-mysql的卸载">1. MySQL的卸载</h3>
<h4 id="windows">Windows</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bat" data-lang="bat">mysql --version
</code></pre></div><ol>
<li>
<p>软件位置：你看你自己安装的时候设置的</p>
</li>
<li>
<p>数据文件一般在 C:\ProgramData\MySQL\xxxx\Data<br>
例如我的：C:\ProgramData\MySQL\MySQL Server 8.2\Data</p>
</li>
<li>
<p>服务：我的电脑-&gt;管理-&gt;服务-&gt;MySQL80-&gt; 设置停止</p>
</li>
<li>
<p>环境变量里也有MySQL, 也需要删除</p>
</li>
</ol>
<p>通过控制面板卸载 MySQL, 或者用安装的时候的工具去卸载, 数据文件此时还会在</p>
<p>之前5.7的版本卸载需要手动删除<strong>注册表</strong>（regedit中删除）：</p>
<blockquote>
<p>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet{xxx}\Services\Eventlog\Application\MySQL服务</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\ControlSet{xxx}\Services\MySQL服务</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Eventlog\Application\MySQL服务</p>
<p>HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\MySQL服务</p>
</blockquote>
<p>最后重启电脑</p>
<h3 id="2-mysql-的下载">2. MySQL 的下载</h3>
<p>我们装社区版就行了.</p>
<p>还有一个集群版 MySQL Cluster 集群版(免费)</p>
<p>还有一个 MySQL Workbench, 一款专门为 MySQL 设计的图形管理工具</p>
<p>安装 MySQL 社区版, 然后配置环境变量, 把你的安装位置的 bin 目录放到环境变量里</p>
<p>然后还装一个 5.7, 这个要招 msi文件去 MySQL for windows 里面找</p>
<p>这时候同时有两个MySQL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># 登录 mysql8</span>
mysql -uroot -h localhost -P <span style="color:#ae81ff">3306</span> -p
<span style="color:#75715e"># 登录 mysql5.7</span>
mysql -uroot -h localhost -P <span style="color:#ae81ff">13306</span> -p
<span style="color:#75715e"># 这是因为我把 8的端口设置为 3306</span>
<span style="color:#75715e"># 把5.7的端口设置成了 13306</span>

<span style="color:#75715e"># 退出</span>
quit <span style="color:#75715e"># 或 exit</span>
</code></pre></div><p>MySQL 5.7 默认的字符编码是 latin1, 我们可以用</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 查看默认使用的字符集
</span><span style="color:#75715e"></span><span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;character_%&#39;</span>;
<span style="color:#66d9ef">show</span> variables <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;collation_%&#39;</span>;
</code></pre></div><p>在 my.ini 下面修改</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[mysql]</span>
<span style="color:#a6e22e">default-character-set</span><span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>

<span style="color:#66d9ef">[mysqld]</span>
<span style="color:#a6e22e">character-set-server</span><span style="color:#f92672">=</span><span style="color:#e6db74">utf8</span>
<span style="color:#a6e22e">collation-server</span><span style="color:#f92672">=</span><span style="color:#e6db74">utf8_general_ci</span>
</code></pre></div><p>我的这个文件在 <code>C:\ProgramData\MySQL\MySQL Server 5.7</code> 下面</p>
<p>重启服务, 然后就会发现生效了.</p>
<h3 id="抽象问题">抽象问题</h3>
<h4 id="密码重置">密码重置</h4>
<ol>
<li>先关闭 mysqld 服务</li>
<li>通过特殊参数开启mysqld</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysqld --defaults-file<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;xxxx\my.ini&#34;</span>
</code></pre></div><ol start="3">
<li>此时 mysqld 已打开</li>
<li>mysql -uroot 直接登录服务器</li>
<li>修改权限表</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">use mysql;
<span style="color:#66d9ef">update</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">set</span> authentication_string<span style="color:#f92672">=</span>password(<span style="color:#e6db74">&#39;123456&#39;</span>) <span style="color:#66d9ef">where</span> <span style="color:#66d9ef">user</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;root;
</span><span style="color:#e6db74">flush privileges;
</span><span style="color:#e6db74">
</span></code></pre></div><h2 id="3-基本的select语句">3. 基本的SELECT语句</h2>
<h3 id="1-sql-概述">1. SQL 概述</h3>
<p>SQL的分类</p>
<ul>
<li>DDL: 数据定义语言
<ul>
<li>CREATE</li>
<li>ALTER</li>
<li>DROP</li>
<li>RENAME</li>
<li>TRUNCATE</li>
</ul>
</li>
<li>DML: 数据操作语言
<ul>
<li>INSERT</li>
<li>DELETE</li>
<li>UPDATE</li>
<li>SELECT</li>
</ul>
</li>
<li>DCL: 数据控制语言
<ul>
<li>COMMIT</li>
<li>ROLLBACK</li>
<li>SAVEPOINT</li>
<li>GRANT</li>
<li>REVOKE</li>
</ul>
</li>
</ul>
<h3 id="2-sql语言的规则和规范">2. SQL语言的规则和规范</h3>
<p>2.1 基本规则</p>
<ul>
<li>SQL 可以写在一行或者多行, 为了提高可读性, 各句子分行写, 必要时使用缩进.</li>
<li>每条命令以 <code>;</code> 或 <code>\g</code> 或 <code>\G</code> 结束</li>
<li>关键字不能被缩写也不能分行</li>
<li>关于标点符号
<ul>
<li>必须保证所有的 <code>()</code>、单引号、双引号是成对出现的</li>
<li>必须使用英文状态下的半角输入方式</li>
<li>字符串型和日期时间类型的数据可以使用单引号 <code>' '</code> 表示</li>
<li>列的别名, 尽量使用双引号 <code>&quot;&quot;</code>, 并且不建议省略 <code>as</code></li>
</ul>
</li>
</ul>
<p>2.2 SQL 大小写规范</p>
<ul>
<li>MySQL 在 Windows 环境下是大小写不敏感的</li>
<li>MySQL 在 Linux 环境下是大小写敏感的
<ul>
<li>数据库名、表名、表的别名、变量名是严格区分大小写的</li>
<li>关键字、函数名、列名、列的别名是不区分大小写的</li>
</ul>
</li>
<li>推荐采用统一的书写规范
<ul>
<li>数据库名、表明、表别名、字段名、字段别名等都是小写</li>
<li>SQL 关键字、函数名、绑定变量等都是大写</li>
</ul>
</li>
</ul>
<p>2.3 注释</p>
<p>可以使用如下格式的注释结构</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 单行注释 -- 要加上空格
</span><span style="color:#75715e"></span><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">单行注释</span>(MySQL特有)
<span style="color:#75715e">/* 多行注释 */</span>
</code></pre></div><p>2.4 命名规则</p>
<p>2.5 数据导入导出</p>
<p>导入现有的数据表、表的数据</p>
<p>方式1: source 文件的全路径名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">mysql -uroot -p 
<span style="color:#75715e"># 登入后</span>
source xxx.sql;
</code></pre></div><p>方式2: 基于具体的图形化界面的工具可以导入数据</p>
<h3 id="3-基本的-select-语句">3. 基本的 SELECT 语句</h3>
<h4 id="30-select">3.0 SELECT</h4>
<p>最基本的 SELECT 语句</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span>;
<span style="color:#75715e">-- mysql&gt; select 1;
</span><span style="color:#75715e">-- +---+
</span><span style="color:#75715e">-- | 1 |
</span><span style="color:#75715e">-- +---+
</span><span style="color:#75715e">-- | 1 |
</span><span style="color:#75715e">-- +---+
</span><span style="color:#75715e">-- 1 row in set (0.00 sec)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>;
<span style="color:#75715e">-- mysql&gt; select 1+1;
</span><span style="color:#75715e">-- +-----+
</span><span style="color:#75715e">-- | 1+1 |
</span><span style="color:#75715e">-- +-----+
</span><span style="color:#75715e">-- |   2 |
</span><span style="color:#75715e">-- +-----+
</span><span style="color:#75715e">-- 1 row in set (0.00 sec)
</span><span style="color:#75715e">-- 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span><span style="color:#f92672">*</span><span style="color:#ae81ff">2</span>;
<span style="color:#75715e">-- mysql&gt; SELECT 1+1, 3*2;
</span><span style="color:#75715e">-- +-----+-----+
</span><span style="color:#75715e">-- | 1+1 | 3*2 |
</span><span style="color:#75715e">-- +-----+-----+
</span><span style="color:#75715e">-- |   2 |   6 |
</span><span style="color:#75715e">-- +-----+-----+
</span><span style="color:#75715e">-- 1 row in set (0.00 sec)
</span></code></pre></div><p>最基本的 SELECT 语句: SELECT 字段1, 字段2, &hellip; FROM 表名;</p>
<p>*：表中的所有字段</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> employees;
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+------------+-----------+------+---------------+------------+---------+--------+----------------+------------+---------------+
</span><span style="color:#75715e">-- | employee_id | first_name | last_name | email| phone_number  | hire_date  | job_id | salary | commission_pct | manager_id | department_id |
</span><span style="color:#75715e">-- +-------------+------------+-----------+------+---------------+------------+--------+--------+----------------+------------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- | employee_id | last_name   | salary   |
</span><span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- |         100 | King        | 24000.00 |
</span><span style="color:#75715e">-- |         101 | Kochhar     | 17000.00 |
</span></code></pre></div><p>列的别名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+-------------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name   | department_id |
</span><span style="color:#75715e">-- +-------------+-------------+---------------+
</span><span style="color:#75715e">-- |         100 | King        |            90 |
</span><span style="color:#75715e">-- |         101 | Kochhar     |            90 |
</span><span style="color:#75715e">-- as 的全程是 alias, 可以省略
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name <span style="color:#66d9ef">as</span> lname, department_id <span style="color:#66d9ef">as</span> dep_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- | employee_id | lname       | dep_id |
</span><span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- |         100 | King        |     90 |
</span><span style="color:#75715e">-- |         101 | Kochhar     |     90 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 别名可以用双引号引起来, 不要使用单引号
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;lname&#34;</span>, department_id <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;dep id&#34;</span> <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- | employee_id | lname       | dep id |
</span><span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- |         100 | King        |     90 |
</span><span style="color:#75715e">-- |         101 | Kochhar     |     90 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 别名可以用反引号引起来
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name <span style="color:#66d9ef">as</span> <span style="color:#f92672">`</span>lname<span style="color:#f92672">`</span>, department_id <span style="color:#66d9ef">as</span> <span style="color:#f92672">`</span>dep id<span style="color:#f92672">`</span> <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- | employee_id | lname       | dep id |
</span><span style="color:#75715e">-- +-------------+-------------+--------+
</span><span style="color:#75715e">-- |         100 | King        |     90 |
</span><span style="color:#75715e">-- |         101 | Kochhar     |     90 |
</span></code></pre></div><p>去除重复行</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> department_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +---------------+
</span><span style="color:#75715e">-- | department_id |
</span><span style="color:#75715e">-- +---------------+
</span><span style="color:#75715e">-- |          NULL |
</span><span style="color:#75715e">-- |            10 |
</span><span style="color:#75715e">-- |            20 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- DISTINCT 需要放到所有列名的前面
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> salary, <span style="color:#66d9ef">DISTINCT</span> department_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- 上面这样会报错
</span></code></pre></div><p>空值参与运算</p>
<ol>
<li>空值: null</li>
<li>null 不等同于 0, 也不等同于空字符串</li>
<li>加减乘除等运算中, 只要有一个操作数为 null, 结果都是 null</li>
<li>实际的解决方案: 使用 IFNULL 函数, IFNULL(列名, 替代值)</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +--------+
</span><span style="color:#75715e">-- | 1+NULL |
</span><span style="color:#75715e">-- +--------+
</span><span style="color:#75715e">-- |   NULL |
</span><span style="color:#75715e">-- +--------+
</span><span style="color:#75715e">-- 1 row in set (0.00 sec)
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, salary <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;月工资&#34;</span>, salary <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>commission_pct) <span style="color:#f92672">*</span> <span style="color:#ae81ff">12</span> <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;年工资&#34;</span> 
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- +-------------+----------+-----------+
</span><span style="color:#75715e">-- | employee_id | 月工资   | 年工资    |
</span><span style="color:#75715e">-- +-------------+----------+-----------+
</span><span style="color:#75715e">-- |         100 | 24000.00 |      NULL |
</span><span style="color:#75715e">-- |         101 | 17000.00 |      NULL |
</span><span style="color:#75715e">-- 因为有一些 commission_pct 为 NULL
</span></code></pre></div><p>着重号 <code>``</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- ORDER 是一个关键字;
</span><span style="color:#75715e">-- 下面的 ORDER 是一个表名, 下面这样写就有问题
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#66d9ef">ORDER</span>;
<span style="color:#75715e">-- ERROR 1064 (42000): You have an error in your SQL syntax; check the manual that corresponds to your MySQL server version for the right syntax to use near &#39;ORDER&#39; at line 1
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 应该要用着重号(反引号)包起来
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">ORDER</span><span style="color:#f92672">`</span>;
<span style="color:#75715e">-- +----------+------------+
</span><span style="color:#75715e">-- | order_id | order_name |
</span><span style="color:#75715e">-- +----------+------------+
</span><span style="color:#75715e">-- |        1 | shkstart   |
</span><span style="color:#75715e">-- |        2 | tomcat     |
</span><span style="color:#75715e">-- |        3 | dubbo      |
</span><span style="color:#75715e">-- +----------+------------+
</span><span style="color:#75715e"></span>
</code></pre></div><p>查询常数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;你好&#34;</span>, order_name <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">ORDER</span><span style="color:#f92672">`</span>;
<span style="color:#75715e">-- +------+------------+
</span><span style="color:#75715e">-- | 你好 | order_name |
</span><span style="color:#75715e">-- +------+------------+
</span><span style="color:#75715e">-- | 你好 | shkstart   |
</span><span style="color:#75715e">-- | 你好 | tomcat     |
</span><span style="color:#75715e">-- | 你好 | dubbo      |
</span><span style="color:#75715e">-- +------+------------+
</span></code></pre></div><h3 id="4-显示表格结构">4. 显示表格结构</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DESC</span> employees;
<span style="color:#75715e">-- +----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e">-- | Field          | Type        | Null | Key | Default | Extra |
</span><span style="color:#75715e">-- +----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e">-- | employee_id    | int         | NO   | PRI | 0       |       |
</span><span style="color:#75715e">-- | first_name     | varchar(20) | YES  |     | NULL    |       |
</span><span style="color:#75715e">-- | last_name      | varchar(25) | NO   |     | NULL    |       |
</span><span style="color:#75715e">-- | email          | varchar(25) | NO   | UNI | NULL    |       |
</span><span style="color:#75715e">-- | phone_number   | varchar(20) | YES  |     | NULL    |       |
</span><span style="color:#75715e">-- | hire_date      | date        | NO   |     | NULL    |       |
</span><span style="color:#75715e">-- | job_id         | varchar(10) | NO   | MUL | NULL    |       |
</span><span style="color:#75715e">-- | salary         | double(8,2) | YES  |     | NULL    |       |
</span><span style="color:#75715e">-- | commission_pct | double(2,2) | YES  |     | NULL    |       |
</span><span style="color:#75715e">-- | manager_id     | int         | YES  | MUL | NULL    |       |
</span><span style="color:#75715e">-- | department_id  | int         | YES  | MUL | NULL    |       |
</span><span style="color:#75715e">-- +----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#66d9ef">DESCRIBE</span> employees; <span style="color:#75715e">-- 这个也是一样的, DESC 是 DESCRIBE 的缩写
</span></code></pre></div><h3 id="5-过滤数据条件查询">5. 过滤数据(条件查询)</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- 查出来了 107 条记录
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>;
<span style="color:#75715e">-- 查出来了 3 条记录
</span><span style="color:#75715e">-- 查询字段
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> 
<span style="color:#75715e">-- 查询的表
</span><span style="color:#75715e"></span><span style="color:#66d9ef">FROM</span> employees
<span style="color:#75715e">-- 过滤条件 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span> <span style="color:#66d9ef">AND</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
</code></pre></div><p>Windows 下的 MySQL 默认是不区分大小写的(MySQL甚至字符串的值有时候都能不分大小写), Linux 下是区分大小写的.</p>
<p>作业:</p>
<ol>
<li>查询员工12个月的工资总和, 起别名为 annual_salary</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> employee_id, last_name, salary <span style="color:#f92672">*</span><span style="color:#ae81ff">12</span> <span style="color:#66d9ef">as</span> annual_salary <span style="color:#66d9ef">from</span> employees;
<span style="color:#75715e">-- 基本工资+奖金
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> employee_id, last_name, salary <span style="color:#f92672">*</span><span style="color:#ae81ff">12</span> <span style="color:#f92672">*</span> (<span style="color:#ae81ff">1</span><span style="color:#f92672">+</span>IFNULL(commission_pct, <span style="color:#ae81ff">0</span>)) <span style="color:#66d9ef">as</span> annual_salary <span style="color:#66d9ef">from</span> employees;
</code></pre></div><ol start="2">
<li>查询 employees 表中去除重复的 job_id 以后的数据</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> job_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- 107 rows in set (0.00 sec)
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> job_id <span style="color:#66d9ef">FROM</span> employees;
<span style="color:#75715e">-- 19 rows in set (0.00 sec)
</span></code></pre></div><ol start="3">
<li>查询工资大于 12000 的员工姓名和工资</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">12000</span>;
</code></pre></div><ol start="4">
<li>查询员工号为176的员工的姓名和部门号</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">176</span>;
</code></pre></div><ol start="5">
<li>显示表 departments 的结构, 并查询其中的全部数据</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DESC</span> departments;

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> departments;
</code></pre></div><h2 id="4-运算符">4. 运算符</h2>
<h3 id="1-算数运算符">1. 算数运算符</h3>
<ul>
<li>加法: +</li>
<li>减法: -</li>
<li>乘法: *</li>
<li>除法: / 或 DIV</li>
<li>取模: % 或 MOD</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span><span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">4</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">5</span><span style="color:#f92672">%</span><span style="color:#ae81ff">2</span>;
<span style="color:#75715e">-- +-----+-----+-----+--------+------+
</span><span style="color:#75715e">-- | 1+1 | 1-1 | 2*3 | 4/2    | 5%2  |
</span><span style="color:#75715e">-- +-----+-----+-----+--------+------+
</span><span style="color:#75715e">-- |   2 |   0 |   6 | 2.0000 |    1 |
</span><span style="color:#75715e">-- +-----+-----+-----+--------+------+
</span><span style="color:#75715e">-- 1 row in set (0.00 sec)
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- SQL 中 + 号没有连接的作用, 就是表示加法的运算结果. 因此下面会将字符串转换为数值
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;10&#39;</span>, <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;01&#39;</span>;
<span style="color:#75715e">-- +-----------+------------+------------+
</span><span style="color:#75715e">-- | 100 + &#39;a&#39; | 100 + &#39;10&#39; | 100 + &#39;01&#39; |
</span><span style="color:#75715e">-- +-----------+------------+------------+
</span><span style="color:#75715e">-- |       100 |        110 |        101 |
</span><span style="color:#75715e">-- +-----------+------------+------------+
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">100</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;10a&#39;</span>;
<span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e">-- | 100 + &#39;10a&#39; |
</span><span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e">-- |         110 |
</span><span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e">-- 如果有 null 值参与运算, 那么结果为 null
</span><span style="color:#75715e">-- 除法中分母如果为0, 那么结果为 null
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">%</span><span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">4</span>;
<span style="color:#75715e">-- +---------+
</span><span style="color:#75715e">-- | 12 %5.4 |
</span><span style="color:#75715e">-- +---------+
</span><span style="color:#75715e">-- |     1.2 |
</span><span style="color:#75715e">-- +---------+
</span><span style="color:#75715e">--  12 = 5.4*2 +1.2 = 10.8+1.2
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">12</span> <span style="color:#f92672">%</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">5</span>;
<span style="color:#75715e">-- +---------+
</span><span style="color:#75715e">-- | 12 % -5 |
</span><span style="color:#75715e">-- +---------+
</span><span style="color:#75715e">-- |       2 |
</span><span style="color:#75715e">-- +---------+
</span></code></pre></div><h3 id="2-比较运算符">2. 比较运算符</h3>
<h4 id="21-符号类">2.1 符号类</h4>
<ul>
<li>等于: =</li>
<li>安全等于: &lt;=&gt;</li>
<li>不等于: != 或 &lt;&gt;</li>
<li>小于: &lt;</li>
<li>小于等于: &lt;=</li>
<li>大于: &gt;</li>
<li>大于等于: &gt;=</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">1</span><span style="color:#f92672">!=</span><span style="color:#ae81ff">2</span>;
<span style="color:#75715e">-- +-----+------+
</span><span style="color:#75715e">-- | 1=2 | 1!=2 |
</span><span style="color:#75715e">-- +-----+------+
</span><span style="color:#75715e">-- |   0 |    1 |
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>;
<span style="color:#75715e">-- +-------+
</span><span style="color:#75715e">-- | 1=&#39;a&#39; |
</span><span style="color:#75715e">-- +-------+
</span><span style="color:#75715e">-- |     0 |
</span><span style="color:#75715e">-- +-------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 如果字符串存在隐式转换, 如果转换数值不成功, 那么转换成0, 因此会有下面这种情况.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">0</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span>;
<span style="color:#75715e">-- +-------+
</span><span style="color:#75715e">-- | 0=&#39;a&#39; |
</span><span style="color:#75715e">-- +-------+
</span><span style="color:#75715e">-- |     1 |
</span><span style="color:#75715e">-- +-------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;b&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | &#39;a&#39; = &#39;b&#39; |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- |         0 |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- 此时两边都是字符串, 那么就是字符串的比较
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#39;你&#39;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;你&#39;</span>;
<span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e">-- | &#39;你&#39; = &#39;你&#39; |
</span><span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e">-- |           1 |
</span><span style="color:#75715e">-- +-------------+
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>, <span style="color:#66d9ef">NULL</span><span style="color:#f92672">=</span><span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +----------+-----------+
</span><span style="color:#75715e">-- | 1 = NULL | NULL=NULL |
</span><span style="color:#75715e">-- +----------+-----------+
</span><span style="color:#75715e">-- |     NULL |      NULL |
</span><span style="color:#75715e">-- +----------+-----------+
</span><span style="color:#75715e">-- 只要有 NULL 参与比较, 那么就是NULL
</span><span style="color:#75715e">-- 对是1, 错是0
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">12000</span>;
<span style="color:#75715e">-- +-----------+----------+
</span><span style="color:#75715e">-- | last_name | salary   |
</span><span style="color:#75715e">-- +-----------+----------+
</span><span style="color:#75715e">-- | King      | 24000.00 |
</span><span style="color:#75715e">-- | Kochhar   | 17000.00 |
</span><span style="color:#75715e"></span>

<span style="color:#75715e">-- 抽象的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- Empty set (0.00 sec)
</span><span style="color:#75715e">-- NULL 不能用 = 来判断, 要用 is null
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">is</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e">-- | last_name | salary  | department_id |
</span><span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e">-- | Grant     | 7000.00 |          NULL |
</span><span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 安全等于也可以用于比较 NULL
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>, <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +------------+---------------+
</span><span style="color:#75715e">-- | 1 &lt;=&gt; NULL | NULL &lt;=&gt; NULL |
</span><span style="color:#75715e">-- +------------+---------------+
</span><span style="color:#75715e">-- |          0 |             1 |
</span><span style="color:#75715e">-- +------------+---------------+
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">&lt;=&gt;</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- IS NOT NULL 也可以写为 WHERE NOT DEPARTMENT_ID &lt;=&gt; NULL
</span><span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e">-- | last_name | salary  | department_id |
</span><span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e">-- | Grant     | 7000.00 |          NULL |
</span><span style="color:#75715e">-- +-----------+---------+---------------+
</span><span style="color:#75715e">-- 安全等于在没有 NULL 的时候和等于是一样的
</span><span style="color:#75715e">-- 安全等于相当于是专门增加来比较 NULL 的
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">&gt;</span><span style="color:#66d9ef">NULL</span>, <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">NULL</span>, <span style="color:#ae81ff">0</span><span style="color:#f92672">!=</span><span style="color:#66d9ef">NULL</span>, <span style="color:#ae81ff">0</span><span style="color:#f92672">=</span><span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +--------+--------------+---------+--------+
</span><span style="color:#75715e">-- | 1&gt;NULL | NULL != NULL | 0!=NULL | 0=NULL |
</span><span style="color:#75715e">-- +--------+--------------+---------+--------+
</span><span style="color:#75715e">-- |   NULL |         NULL |    NULL |   NULL |
</span><span style="color:#75715e">-- +--------+--------------+---------+--------+
</span><span style="color:#75715e">-- 全是 NULL
</span></code></pre></div><h3 id="22-非符号类">2.2 非符号类</h3>
<ul>
<li>IS NULL</li>
<li>IS NOT NULL</li>
<li>ISNULL(): 判断是否为 NULL</li>
<li>LEAST(): 返回参数列表中的最小值</li>
<li>GREATEST(): 返回参数列表中的最大值</li>
<li>BETWEEN &hellip; AND &hellip;: 在某个范围内</li>
<li>IN: 在某个集合内</li>
<li>NOT IN: 不在某个集合内</li>
<li>LIKE: 模糊查询</li>
<li>REGEXP: 正则表达式</li>
<li>RLIKE: 正则表达式</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#75715e">-- WHERE department_id IS NULL;
</span><span style="color:#75715e"></span><span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">ISNULL</span>(department_id) ;

<span style="color:#75715e">-- 最小
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> LEAST(<span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;t&#39;</span>, <span style="color:#e6db74">&#39;m&#39;</span>) ;
<span style="color:#75715e">-- +---------------------------+
</span><span style="color:#75715e">-- | LEAST(&#39;g&#39;, &#39;b&#39;, &#39;t&#39;, &#39;m&#39;) |
</span><span style="color:#75715e">-- +---------------------------+
</span><span style="color:#75715e">-- | b                         |
</span><span style="color:#75715e">-- +---------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> GREATEST(<span style="color:#e6db74">&#39;g&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;t&#39;</span>, <span style="color:#e6db74">&#39;m&#39;</span>) ;
<span style="color:#75715e">-- +------------------------------+
</span><span style="color:#75715e">-- | GREATEST(&#39;g&#39;, &#39;b&#39;, &#39;t&#39;, &#39;m&#39;) |
</span><span style="color:#75715e">-- +------------------------------+
</span><span style="color:#75715e">-- | t                            |
</span><span style="color:#75715e">-- +------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">10000</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">20000</span>;
<span style="color:#75715e">-- 等价于 WHERE salary &gt;= 10000 AND salary &lt;= 20000
</span><span style="color:#75715e">-- +-------------+-----------+----------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name | salary   | department_id |
</span><span style="color:#75715e">-- +-------------+-----------+----------+---------------+
</span><span style="color:#75715e">-- |         101 | Kochhar   | 17000.00 |            90 |
</span><span style="color:#75715e">-- |         102 | De Haan   | 17000.00 |            90 |
</span><span style="color:#75715e">-- |         108 | Greenberg | 12000.00 |           100 |
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">20000</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#75715e">-- Empty set (0.00 sec)
</span><span style="color:#75715e">-- 第一个数是下界, 第二个数是上界, 因此是空集
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> salary <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">10000</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">20000</span>;
<span style="color:#75715e">-- 不在 10000 和 20000 之间的
</span><span style="color:#75715e">-- +-------------+-------------+----------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name   | salary   | department_id |
</span><span style="color:#75715e">-- +-------------+-------------+----------+---------------+
</span><span style="color:#75715e">-- |         100 | King        | 24000.00 |            90 |
</span><span style="color:#75715e">-- |         103 | Hunold      |  9000.00 |            60 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 查询部门为 10, 20, 30 的员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>);
<span style="color:#75715e">-- +-------------+------------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name  | department_id |
</span><span style="color:#75715e">-- +-------------+------------+---------------+
</span><span style="color:#75715e">-- |         200 | Whalen     |            10 |
</span><span style="color:#75715e">-- |         201 | Hartstein  |            20 |
</span><span style="color:#75715e">-- |         114 | Raphaely   |            30 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 或者写抽象一点
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#75715e">-- 这里要写完整, 不能写成
</span><span style="color:#75715e">-- WHERE department_id IN 10 OR 20 OR 30
</span><span style="color:#75715e"></span><span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">OR</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span> <span style="color:#66d9ef">OR</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">30</span>;
<span style="color:#75715e">-- +-------------+------------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name  | department_id |
</span><span style="color:#75715e">-- +-------------+------------+---------------+
</span><span style="color:#75715e">-- |         200 | Whalen     |            10 |
</span><span style="color:#75715e">-- |         201 | Hartstein  |            20 |
</span><span style="color:#75715e">-- |         114 | Raphaely   |            30 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 查询部门不为 10, 20, 30 的员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>);
<span style="color:#75715e">-- +-------------+-------------+---------------+
</span><span style="color:#75715e">-- | employee_id | last_name   | department_id |
</span><span style="color:#75715e">-- +-------------+-------------+---------------+
</span><span style="color:#75715e">-- |         100 | King        |            90 |
</span><span style="color:#75715e">-- |         101 | Kochhar     |            90 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 模糊查询
</span><span style="color:#75715e">-- % 代表不确定个数的字符, 也包括 0 个
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;K%&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | King      |
</span><span style="color:#75715e">-- | Kochhar   |
</span><span style="color:#75715e">-- | Khoo      |
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%k%&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Kaufling    <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Mikkilineni <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Markle      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Atkinson    <span style="color:#f92672">|</span>
<span style="color:#75715e">-- 这里是因为 MySQL 在 Windows 下是不区分大小写的, 所以抽象
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 找包含字符 a 并且包含字符 k 的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%a%k%&#39;</span>;
<span style="color:#75715e">-- 这种是不行的, 这种是 a一定在k前面的, 这个只能查出3个
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%a%&#39;</span> <span style="color:#66d9ef">AND</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%k%&#39;</span>;
<span style="color:#75715e">-- 这个能查出 6个
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 如果要查第二个字符为a的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_a%&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Pataballa |
</span><span style="color:#75715e">-- | Faviet    |
</span><span style="color:#75715e">-- | Raphaely  |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 这里的 _ 代表一个字符
</span><span style="color:#75715e"></span>

<span style="color:#75715e">-- 查询第二个字符为 _ , 且第三个字符为 a 的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_\_a%&#39;</span>;
<span style="color:#75715e">-- 这里用转义字符
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 或者
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;_$_a%&#39;</span> <span style="color:#66d9ef">ESCAPE</span> <span style="color:#e6db74">&#39;$&#39;</span>;
<span style="color:#75715e">-- ESCAPE &#39;$&#39; 是指定转义字符
</span><span style="color:#75715e">-- 一般不用的
</span><span style="color:#75715e"></span>

<span style="color:#75715e">--  REGEXP 正则表达式
</span><span style="color:#75715e">-- ^ 代表开头
</span><span style="color:#75715e">-- $ 代表结尾
</span><span style="color:#75715e">-- . 代表任意一个字符
</span><span style="color:#75715e">-- * 代表前面的字符出现 0 次或多次
</span><span style="color:#75715e">-- + 代表前面的字符出现 1 次或多次
</span><span style="color:#75715e">-- ? 代表前面的字符出现 0 次或 1 次
</span><span style="color:#75715e">-- [] 代表字符集合
</span><span style="color:#75715e">-- [^] 代表非字符集合
</span><span style="color:#75715e">-- | 代表或
</span><span style="color:#75715e"></span>
<span style="color:#75715e">--  以 s 开头的 -&gt; ^s
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name REGEXP <span style="color:#e6db74">&#39;^s&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Sciarra   |
</span><span style="color:#75715e">-- | Stiles    |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 以 t 结尾的 -&gt; t$
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name REGEXP <span style="color:#e6db74">&#39;t$&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Ernst     |
</span><span style="color:#75715e">-- | Faviet    |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 以 e 开头并且以 t 结尾的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name REGEXP <span style="color:#e6db74">&#39;^e.*t$&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Ernst     |
</span><span style="color:#75715e">-- | Everett   |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;e%t&#39;</span>;
<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Ernst     |
</span><span style="color:#75715e">-- | Everett   |
</span><span style="color:#75715e">-- +-----------+
</span></code></pre></div><h3 id="3-逻辑运算符">3. 逻辑运算符</h3>
<ul>
<li>NOT: 非(!)</li>
<li>AND：与(&amp;&amp;)</li>
<li>OR：或(||)</li>
<li>XOR：异或</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 异或可以认为是两个同时只满足一个. 也就是说两个都不满足或者两个都满足都不行
</span><span style="color:#75715e">-- AND 的优先级大于别的.
</span></code></pre></div><h3 id="4-位运算符">4. 位运算符</h3>
<p>会先将数组操作变成二进制数, 然后进行位运算, 最后将计算结果转换成十进制数</p>
<p>一般用不到.</p>
<ul>
<li>&amp;: 按位与</li>
<li>|: 按位或</li>
<li>^: 按位异或</li>
<li>~: 按位取反</li>
<li>&laquo;: 左移</li>
<li>
<blockquote>
<blockquote>
<p>: 右移</p>
</blockquote>
</blockquote>
</li>
</ul>
<h3 id="5-运算符的优先级">5. 运算符的优先级</h3>
<p>一般不用记, 用括号就好了.</p>
<h3 id="6-练习">6. 练习</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 1. 选择工资不在5000到12000的员工的姓名和工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> salary  <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">5000</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">12000</span>;
<span style="color:#75715e">-- 这里也可以放在 NOT BETWEEN 5000 AND 12000
</span><span style="color:#75715e">-- +-------------+----------+
</span><span style="color:#75715e">-- | last_name   | salary   |
</span><span style="color:#75715e">-- +-------------+----------+
</span><span style="color:#75715e">-- | King        | 24000.00 |
</span><span style="color:#75715e">-- | Kochhar     | 17000.00 |
</span><span style="color:#75715e">-- | De Haan     | 17000.00 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 2. 选择在20或者50号部门工作的员工姓名或部门号
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">50</span>);
<span style="color:#75715e">-- +-------------+---------------+
</span><span style="color:#75715e">-- | last_name   | department_id |
</span><span style="color:#75715e">-- +-------------+---------------+
</span><span style="color:#75715e">-- | Weiss       |            50 |
</span><span style="color:#75715e">-- | Fripp       |            50 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 3. 选择公司中没有管理者的员工姓名及job_id
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, job_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;

<span style="color:#75715e">-- +-----------+---------+
</span><span style="color:#75715e">-- | last_name | job_id  |
</span><span style="color:#75715e">-- +-----------+---------+
</span><span style="color:#75715e">-- | King      | AD_PRES |
</span><span style="color:#75715e">-- +-----------+---------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 4. 选择公司中有奖金的员工姓名, 工资和奖金级别
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary, commission_pct
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> commission_pct <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- +------------+----------+----------------+
</span><span style="color:#75715e">-- | last_name  | salary   | commission_pct |
</span><span style="color:#75715e">-- +------------+----------+----------------+
</span><span style="color:#75715e">-- | Russell    | 14000.00 |           0.40 |
</span><span style="color:#75715e">-- | Partners   | 13500.00 |           0.30 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 5. 选择员工姓名的第三个字母是a的员工姓名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;__a%&#39;</span>;

<span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | last_name |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e">-- | Grant     |
</span><span style="color:#75715e">-- | Grant     |
</span><span style="color:#75715e">-- | Whalen    |
</span><span style="color:#75715e">-- +-----------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 6. 选择员工中有字母 a 和 k 的员工姓名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%a%&#39;</span> <span style="color:#66d9ef">AND</span> last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%k%&#39;</span>;
<span style="color:#75715e">-- +------------+
</span><span style="color:#75715e">-- | last_name  |
</span><span style="color:#75715e">-- +------------+
</span><span style="color:#75715e">-- | Kochhar    |
</span><span style="color:#75715e">-- | Kaufling   |
</span><span style="color:#75715e">-- | Markle     |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 7. 显示出表 employee 表中 first_name 以 e 结尾的员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> first_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> first_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%e&#39;</span>;
<span style="color:#75715e">-- +------------+
</span><span style="color:#75715e">-- | first_name |
</span><span style="color:#75715e">-- +------------+
</span><span style="color:#75715e">-- | Bruce      |
</span><span style="color:#75715e">-- | Irene      |
</span><span style="color:#75715e"></span>

<span style="color:#75715e">-- 8. 显示出表 employees 部门编号在 80 - 100 之间的姓名、工种
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, job_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">80</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">100</span>;
<span style="color:#75715e">-- +------------+------------+
</span><span style="color:#75715e">-- | last_name  | job_id     |
</span><span style="color:#75715e">-- +------------+------------+
</span><span style="color:#75715e">-- | King       | AD_PRES    |
</span><span style="color:#75715e">-- | Kochhar    | AD_VP      |
</span><span style="color:#75715e">-- | De Haan    | AD_VP      |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 9. 显示出表 employees 的manager_id 是 100,  101,  110 的员工姓名、工资、管理者 ID
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary, manager_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">101</span>, <span style="color:#ae81ff">110</span>);
<span style="color:#75715e">-- +-----------+----------+------------+
</span><span style="color:#75715e">-- | last_name | salary   | manager_id |
</span><span style="color:#75715e">-- +-----------+----------+------------+
</span><span style="color:#75715e">-- | Kochhar   | 17000.00 |        100 |
</span><span style="color:#75715e">-- | De Haan   | 17000.00 |        100 |
</span><span style="color:#75715e">-- | Raphaely  | 11000.00 |        100 |
</span></code></pre></div><h2 id="5-排序与分页">5. 排序与分页</h2>
<h3 id="1-排序数据">1. 排序数据</h3>
<h4 id="11-排序规则">1.1 排序规则</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 如果没有使用排序操作 ,默认情况下查询返回的数据是按照添加数据的顺序返回的
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> employees;

<span style="color:#75715e">-- 我们希望按照 salary 从高到低的顺序显示员工信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees 
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">DESC</span>;
<span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- | employee_id | last_name   | salary   |
</span><span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- |         100 | King        | 24000.00 |
</span><span style="color:#75715e">-- |         101 | Kochhar     | 17000.00 |
</span><span style="color:#75715e">-- |         102 | De Haan     | 17000.00 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 升序: ASC （默认）
</span><span style="color:#75715e">-- 降序: DESC
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">ASC</span>;
<span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- | employee_id | last_name   | salary   |
</span><span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- |         132 | Olson       |  2100.00 |
</span><span style="color:#75715e">-- |         128 | Markle      |  2200.00 |
</span><span style="color:#75715e">-- |         136 | Philtanker  |  2200.00 |
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 列的别名只能在 ORDER BY 子句中使用, 不能在 WHERE 子句中使用
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;月工资&#34;</span>
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#34;月工资&#34;</span> <span style="color:#66d9ef">DESC</span>;
<span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- | employee_id | last_name   | 月工资   |
</span><span style="color:#75715e">-- +-------------+-------------+----------+
</span><span style="color:#75715e">-- |         100 | King        | 24000.00 |
</span><span style="color:#75715e">-- |         101 | Kochhar     | 17000.00 |
</span><span style="color:#75715e">-- |         102 | De Haan     | 17000.00 |
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;月工资&#34;</span>
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> <span style="color:#e6db74">&#34;月工资&#34;</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#75715e">-- Empty set, 1 warning (0.00 sec)
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 因为是先执行 FROM 子句, 然后才执行 SELECT 子句, 所以在 WHERE 子句中不能使用别名
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 但是可以使用别名
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;月工资&#34;</span>
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#75715e">-- +-------------+-----------+----------+
</span><span style="color:#75715e">-- | employee_id | last_name | 月工资   |
</span><span style="color:#75715e">-- +-------------+-----------+----------+
</span><span style="color:#75715e">-- |         100 | King      | 24000.00 |
</span><span style="color:#75715e">-- |         101 | Kochhar   | 17000.00 |
</span><span style="color:#75715e">-- |         102 | De Haan   | 17000.00 |
</span><span style="color:#75715e"></span>

<span style="color:#75715e">-- WHERE 是要在 ORDER BY 之前执行的, FROM 之后执行的
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 因此可以
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary <span style="color:#66d9ef">as</span> <span style="color:#e6db74">&#34;月工资&#34;</span>
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#e6db74">&#34;月工资&#34;</span> <span style="color:#66d9ef">DESC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">月工资</span>   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>

<span style="color:#960050;background-color:#1e0010">所以执行顺序是</span>: <span style="color:#66d9ef">FROM</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>


</code></pre></div><h4 id="12-单列排序">1.2 单列排序</h4>
<p>上面已经涵盖了.</p>
<h4 id="13-多列排序">1.3 多列排序</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">二级排序</span>
<span style="color:#960050;background-color:#1e0010">按照</span> Department_id <span style="color:#960050;background-color:#1e0010">降序</span>, <span style="color:#960050;background-color:#1e0010">然后按照</span> salary <span style="color:#960050;background-color:#1e0010">升序排列</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">DESC</span>, salary <span style="color:#66d9ef">ASC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">206</span> <span style="color:#f92672">|</span> Gietz       <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">205</span> <span style="color:#f92672">|</span> Higgins     <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">113</span> <span style="color:#f92672">|</span> Popp        <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6900</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">111</span> <span style="color:#f92672">|</span> Sciarra     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7700</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
</code></pre></div><h3 id="2-分页">2. 分页</h3>
<h4 id="21-背景">2.1 背景</h4>
<ul>
<li>一次性查询大量数据, 会导致网络传输压力大, 数据传输时间长</li>
<li>一次性查询大量数据, 会导致客户端内存压力大, 数据处理时间长</li>
<li>一次性查询大量数据, 会导致数据库服务器压力大, 数据处理时间长</li>
<li>一次性查询大量数据, 会导致客户端显示压力大, 数据显示时间长</li>
</ul>
<h4 id="22-实现规则">2.2 实现规则</h4>
<p>使用 LIMIT 实现数据的分页显示</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">每页显示</span><span style="color:#ae81ff">20</span><span style="color:#960050;background-color:#1e0010">条记录</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">DESC</span>, salary <span style="color:#66d9ef">ASC</span>
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">20</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">206</span> <span style="color:#f92672">|</span> Gietz     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">205</span> <span style="color:#f92672">|</span> Higgins   <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">113</span> <span style="color:#f92672">|</span> Popp      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6900</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">111</span> <span style="color:#f92672">|</span> Sciarra   <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7700</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">112</span> <span style="color:#f92672">|</span> Urman     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span> Chen      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">109</span> <span style="color:#f92672">|</span> Faviet    <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">173</span> <span style="color:#f92672">|</span> Kumar     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">179</span> <span style="color:#f92672">|</span> Johnson   <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">167</span> <span style="color:#f92672">|</span> Banda     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">166</span> <span style="color:#f92672">|</span> Ande      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">165</span> <span style="color:#f92672">|</span> Lee       <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">155</span> <span style="color:#f92672">|</span> Tuvault   <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">161</span> <span style="color:#f92672">|</span> Sewall    <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">164</span> <span style="color:#f92672">|</span> Marvins   <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">172</span> <span style="color:#f92672">|</span> Bates     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">这里的</span> <span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">是偏移量</span>, <span style="color:#ae81ff">20</span> <span style="color:#960050;background-color:#1e0010">是每页显示的记录数</span>

<span style="color:#960050;background-color:#1e0010">如果要显示下一页</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">DESC</span>, salary <span style="color:#66d9ef">ASC</span>
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>;

<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name  <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">171</span> <span style="color:#f92672">|</span> Smith      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">154</span> <span style="color:#f92672">|</span> Cambrault  <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">160</span> <span style="color:#f92672">|</span> Doran      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">153</span> <span style="color:#f92672">|</span> Olsen      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">159</span> <span style="color:#f92672">|</span> Smith      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">177</span> <span style="color:#f92672">|</span> Livingston <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">176</span> <span style="color:#f92672">|</span> Taylor     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8600</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">175</span> <span style="color:#f92672">|</span> Hutton     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">152</span> <span style="color:#f92672">|</span> Hall       <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">158</span> <span style="color:#f92672">|</span> McEwen     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">163</span> <span style="color:#f92672">|</span> Greene     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">157</span> <span style="color:#f92672">|</span> Sully      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">151</span> <span style="color:#f92672">|</span> Bernstein  <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">170</span> <span style="color:#f92672">|</span> Fox        <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9600</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">156</span> <span style="color:#f92672">|</span> King       <span style="color:#f92672">|</span> <span style="color:#ae81ff">10000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">169</span> <span style="color:#f92672">|</span> Bloom      <span style="color:#f92672">|</span> <span style="color:#ae81ff">10000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">150</span> <span style="color:#f92672">|</span> Tucker     <span style="color:#f92672">|</span> <span style="color:#ae81ff">10000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">162</span> <span style="color:#f92672">|</span> Vishney    <span style="color:#f92672">|</span> <span style="color:#ae81ff">10500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">149</span> <span style="color:#f92672">|</span> Zlotkey    <span style="color:#f92672">|</span> <span style="color:#ae81ff">10500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">148</span> <span style="color:#f92672">|</span> Cambrault  <span style="color:#f92672">|</span> <span style="color:#ae81ff">11000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+----------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">因此对应第</span> pageNo <span style="color:#960050;background-color:#1e0010">页的话</span>, <span style="color:#960050;background-color:#1e0010">条数为</span> pageSize, <span style="color:#960050;background-color:#1e0010">就是</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">DESC</span>, salary <span style="color:#66d9ef">ASC</span>
<span style="color:#66d9ef">LIMIT</span> (pageNo<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>pageSize, pageSize;

<span style="color:#960050;background-color:#1e0010">声明顺序</span>
<span style="color:#66d9ef">SELECT</span> xxx
<span style="color:#66d9ef">FROM</span> xxx
<span style="color:#66d9ef">WHERE</span> xxx
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> xxx
<span style="color:#66d9ef">LIMIT</span> xxx, xxx;

<span style="color:#66d9ef">LIMIT</span> <span style="color:#960050;background-color:#1e0010">偏移量</span>, <span style="color:#960050;background-color:#1e0010">条目数</span>;
</code></pre></div><h4 id="23-拓展">2.3 拓展</h4>
<p>MySQL 8.0 新特性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">OFFSET</span> <span style="color:#ae81ff">2</span>;
<span style="color:#66d9ef">LIMIT</span> pageSize <span style="color:#66d9ef">OFFSET</span> <span style="color:#960050;background-color:#1e0010">偏移量</span>

<span style="color:#960050;background-color:#1e0010">查询员工表中工资最高的员工信息</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">DESC</span>
<span style="color:#75715e">-- LIMIT 1;
</span><span style="color:#75715e">-- LIMIT 0,1;
</span><span style="color:#75715e">-- 新特性
</span><span style="color:#75715e"></span><span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">OFFSET</span> <span style="color:#ae81ff">0</span>;
<span style="color:#75715e">-- 以上三个等价.
</span><span style="color:#75715e"></span><span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+----------+---------------+
</span><span style="color:#75715e"></span>
</code></pre></div><p>LIMIT 可以使用在 MySQL, PGSQL, MariaDB, SQLite 等数据库中使用, 表示分页, 不能在 SQL Server 和 Oracle 中使用.</p>
<h3 id="24-练习">2.4 练习</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 1. 查询员工的姓名和部门号和年薪, 按年薪降序, 按姓名升序显示
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, department_id, salary<span style="color:#f92672">*</span><span style="color:#ae81ff">12</span> <span style="color:#66d9ef">as</span> annual_salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> annual_salary <span style="color:#66d9ef">DESC</span>, last_name <span style="color:#66d9ef">ASC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+---------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> annual_salary <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+---------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">288000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">204000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">204000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>


<span style="color:#75715e">-- 2. 选择公司不在 8000 到 17000 的员工的姓名和工资, 按工资降序, 显示第21到40位置的数据
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">BETWEEN</span> <span style="color:#ae81ff">8000</span> <span style="color:#66d9ef">AND</span> <span style="color:#ae81ff">17000</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> salary <span style="color:#66d9ef">DESC</span>
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">20</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Ernst     <span style="color:#f92672">|</span> <span style="color:#ae81ff">6000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Fay       <span style="color:#f92672">|</span> <span style="color:#ae81ff">6000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Mourgos   <span style="color:#f92672">|</span> <span style="color:#ae81ff">5800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Austin    <span style="color:#f92672">|</span> <span style="color:#ae81ff">4800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Pataballa <span style="color:#f92672">|</span> <span style="color:#ae81ff">4800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Whalen    <span style="color:#f92672">|</span> <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Lorentz   <span style="color:#f92672">|</span> <span style="color:#ae81ff">4200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Sarchand  <span style="color:#f92672">|</span> <span style="color:#ae81ff">4200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Bull      <span style="color:#f92672">|</span> <span style="color:#ae81ff">4100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Bell      <span style="color:#f92672">|</span> <span style="color:#ae81ff">4000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Everett   <span style="color:#f92672">|</span> <span style="color:#ae81ff">3900</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Chung     <span style="color:#f92672">|</span> <span style="color:#ae81ff">3800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Dilly     <span style="color:#f92672">|</span> <span style="color:#ae81ff">3600</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ladwig    <span style="color:#f92672">|</span> <span style="color:#ae81ff">3600</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Rajs      <span style="color:#f92672">|</span> <span style="color:#ae81ff">3500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Dellinger <span style="color:#f92672">|</span> <span style="color:#ae81ff">3400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Bissot    <span style="color:#f92672">|</span> <span style="color:#ae81ff">3300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Mallin    <span style="color:#f92672">|</span> <span style="color:#ae81ff">3300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Stiles    <span style="color:#f92672">|</span> <span style="color:#ae81ff">3200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Nayer     <span style="color:#f92672">|</span> <span style="color:#ae81ff">3200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 3. 查询邮箱中包含 e 的员工信息, 并先按照邮箱的字节数降序, 再按照部门号升序.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, email,department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> email <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;%e%&#39;</span>
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">LENGTH</span>(email) <span style="color:#66d9ef">DESC</span>, department_id <span style="color:#66d9ef">ASC</span>;

<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name  <span style="color:#f92672">|</span> email    <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">201</span> <span style="color:#f92672">|</span> Hartstein  <span style="color:#f92672">|</span> MHARTSTE <span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">114</span> <span style="color:#f92672">|</span> Raphaely   <span style="color:#f92672">|</span> DRAPHEAL <span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">119</span> <span style="color:#f92672">|</span> Colmenares <span style="color:#f92672">|</span> KCOLMENA <span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">186</span> <span style="color:#f92672">|</span> Dellinger  <span style="color:#f92672">|</span> JDELLING <span style="color:#f92672">|</span>            <span style="color:#ae81ff">50</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">191</span> <span style="color:#f92672">|</span> Perkins    <span style="color:#f92672">|</span> RPERKINS <span style="color:#f92672">|</span>            <span style="color:#ae81ff">50</span> <span style="color:#f92672">|</span>

</code></pre></div><h2 id="6-多表查询">6. 多表查询</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">学习中遇到的几个表</span>
<span style="color:#66d9ef">DESC</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field          <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id    <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> PRI <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> first_name     <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name      <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> email          <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> UNI <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> phone_number   <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date      <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> job_id         <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">10</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary         <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> commission_pct <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">2</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> manager_id     <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> department_id  <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">DESC</span> departments;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field           <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id   <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> PRI <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> department_name <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">30</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> manager_id      <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> location_id     <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">DESC</span> locations;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field          <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> location_id    <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> PRI <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> street_address <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">40</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> postal_code    <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">12</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> city           <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">30</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> state_province <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> country_id     <span style="color:#f92672">|</span> char(<span style="color:#ae81ff">2</span>)     <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+-------------+------+-----+---------+-------+
</span></code></pre></div><h3 id="1-一个案例引发的多表查询">1. 一个案例引发的多表查询</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询员工名为</span> Abel <span style="color:#960050;background-color:#1e0010">的员工在哪个城市</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Abel&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-----------+-------+--------------------+------------+--------+----------+----------------+------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> first_name <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> email <span style="color:#f92672">|</span> phone_number       <span style="color:#f92672">|</span> hire_date  <span style="color:#f92672">|</span> job_id <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> commission_pct <span style="color:#f92672">|</span> manager_id <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-----------+-------+--------------------+------------+--------+----------+----------------+------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">174</span> <span style="color:#f92672">|</span> Ellen      <span style="color:#f92672">|</span> Abel      <span style="color:#f92672">|</span> EABEL <span style="color:#f92672">|</span> <span style="color:#ae81ff">011</span>.<span style="color:#ae81ff">44</span>.<span style="color:#ae81ff">1644</span>.<span style="color:#ae81ff">429267</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">1996</span><span style="color:#f92672">-</span><span style="color:#ae81ff">05</span><span style="color:#f92672">-</span><span style="color:#ae81ff">11</span> <span style="color:#f92672">|</span> SA_REP <span style="color:#f92672">|</span> <span style="color:#ae81ff">11000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>           <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">149</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-----------+-------+--------------------+------------+--------+----------+----------------+------------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">知道了部门</span> id
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> departments
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">80</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-----------------+------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> department_name <span style="color:#f92672">|</span> manager_id <span style="color:#f92672">|</span> location_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-----------------+------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span> Sales           <span style="color:#f92672">|</span>        <span style="color:#ae81ff">145</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2500</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-----------------+------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">知道了</span> location_id
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> locations
<span style="color:#66d9ef">WHERE</span> location_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2500</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------------------------------------+-------------+--------+----------------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> location_id <span style="color:#f92672">|</span> street_address                           <span style="color:#f92672">|</span> postal_code <span style="color:#f92672">|</span> city   <span style="color:#f92672">|</span> state_province <span style="color:#f92672">|</span> country_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------------------------------------+-------------+--------+----------------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>        <span style="color:#ae81ff">2500</span> <span style="color:#f92672">|</span> Magdalen Centre, The Oxford Science Park <span style="color:#f92672">|</span> OX9 <span style="color:#ae81ff">9</span>ZB     <span style="color:#f92672">|</span> Oxford <span style="color:#f92672">|</span> Oxford         <span style="color:#f92672">|</span> UK         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------------------------------------+-------------+--------+----------------+------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">因此就知道了这个人在这个城市工作</span>.
</code></pre></div><p>这里需要我们查询三次才能得到结果, 这里就是多表查询的一个案例.</p>
<h4 id="笛卡尔积">笛卡尔积</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id
<span style="color:#66d9ef">FROM</span> employees, departments;
<span style="color:#75715e">-- 这里就是笛卡尔积, 也就是两个表的乘积
</span><span style="color:#75715e">-- 这里是 107 * 27 = 2889 条记录
</span><span style="color:#75715e">-- 这里是 107 是 employees 表的记录数, 27 是 departments 表的记录数
</span><span style="color:#75715e">-- employees 表里的每条记录都和 departments 表里的每条记录进行了匹配, 这样是没有意义的
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">笛卡尔积又叫交叉连接</span> <span style="color:#66d9ef">CROSS</span> <span style="color:#66d9ef">JOIN</span>, <span style="color:#960050;background-color:#1e0010">这里出现这种问题是因为没有给定多表连接的条件</span>

<span style="color:#75715e">-- 加上连接条件
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id
<span style="color:#66d9ef">FROM</span> employees, departments
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;
<span style="color:#75715e">-- 这样就是正常的连接了
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">这样就剩下</span> <span style="color:#ae81ff">106</span> <span style="color:#960050;background-color:#1e0010">条记录</span>, <span style="color:#960050;background-color:#1e0010">可能是因为有</span>department_id <span style="color:#960050;background-color:#1e0010">为</span>NULL的

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">isnull</span>(department_id);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">178</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Grant</span>     <span style="color:#f92672">|</span>          <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-----------+---------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">果然如此</span>
</code></pre></div><h4 id="问题分析">问题分析</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id, department_name, employees.department_id
<span style="color:#66d9ef">FROM</span> employees, departments
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;
<span style="color:#75715e">-- 这样会报错
</span><span style="color:#75715e">-- ERROR 1052 (23000): Column &#39;department_id&#39; in field list is ambiguous
</span><span style="color:#75715e">-- 因为两个表都有 department_id 字段, 所以会报错
</span><span style="color:#75715e">-- 指定表名就好了
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">建议多表查询时</span>, <span style="color:#960050;background-color:#1e0010">每个字段前都指明其所在的表名</span>, <span style="color:#960050;background-color:#1e0010">这样可以避免字段名冲突</span>

<span style="color:#66d9ef">SELECT</span> employees.employee_id, departments.department_name, employees.department_id
<span style="color:#66d9ef">FROM</span> employees, departments
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;

<span style="color:#960050;background-color:#1e0010">会发现问题</span>, <span style="color:#66d9ef">SQL</span> <span style="color:#960050;background-color:#1e0010">有些内容太长了</span>, <span style="color:#960050;background-color:#1e0010">因此可以给表起别名</span>

<span style="color:#66d9ef">SELECT</span> e.employee_id, e.last_name, e.department_id
<span style="color:#66d9ef">FROM</span> employees e, departments d
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

<span style="color:#960050;background-color:#1e0010">设置了别名就都得使用别名</span>, <span style="color:#960050;background-color:#1e0010">不然会报错</span>.

<span style="color:#960050;background-color:#1e0010">并上</span> locations <span style="color:#960050;background-color:#1e0010">表</span>
<span style="color:#66d9ef">SELECT</span> e.employee_id, e.last_name, e.department_id, d.department_name, l.city
<span style="color:#66d9ef">FROM</span> employees e, departments d, locations l
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> d.department_id <span style="color:#66d9ef">AND</span> d.location_id <span style="color:#f92672">=</span> l.location_id;

<span style="color:#960050;background-color:#1e0010">如果有</span> n <span style="color:#960050;background-color:#1e0010">个表实现多表查询</span>, <span style="color:#960050;background-color:#1e0010">则至少有</span> n<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">个连接条件</span>

</code></pre></div><h3 id="2-多表查询分类讲解">2. 多表查询分类讲解</h3>
<h4 id="21-分类1-等值连接-vs-非等值连接">2.1 分类1: 等值连接 vs 非等值连接</h4>
<p>这是针对连接条件来说的</p>
<p>等值连接</p>
<p>之前的例子是等值连接</p>
<p>非等值连接</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">
<span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> job_grades;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> grade_level <span style="color:#f92672">|</span> lowest_sal <span style="color:#f92672">|</span> highest_sal <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> A           <span style="color:#f92672">|</span>       <span style="color:#ae81ff">1000</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2999</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> B           <span style="color:#f92672">|</span>       <span style="color:#ae81ff">3000</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">5999</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#66d9ef">C</span>           <span style="color:#f92672">|</span>       <span style="color:#ae81ff">6000</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">9999</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> D           <span style="color:#f92672">|</span>      <span style="color:#ae81ff">10000</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">14999</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> E           <span style="color:#f92672">|</span>      <span style="color:#ae81ff">15000</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">24999</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> F           <span style="color:#f92672">|</span>      <span style="color:#ae81ff">25000</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">40000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">这种就是非等值连接的例子</span>
<span style="color:#960050;background-color:#1e0010">查询员工的等级</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.salary, j.grade_level
<span style="color:#66d9ef">FROM</span> employees e, job_grades j
<span style="color:#66d9ef">WHERE</span> e.salary <span style="color:#66d9ef">BETWEEN</span> j.lowest_sal <span style="color:#66d9ef">AND</span> j.highest_sal
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> grade_level <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> E           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> E           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> E           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">C</span>           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ernst     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">C</span>           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Austin    <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> B           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Pataballa <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4800</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> B           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Lorentz   <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4200</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> B           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> D           <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Faviet    <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">C</span>           <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+-------------+
</span></code></pre></div><h4 id="22-分类2-自连接-vs-非自连接">2.2 分类2: 自连接 vs 非自连接</h4>
<p>这是根据这个表是不是自己和自己连接分类的</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 自连接
</span><span style="color:#75715e">-- 查询员工的经理信息
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> e1.last_name <span style="color:#e6db74">&#34;员工&#34;</span>, e1.employee_id, e2.last_name <span style="color:#e6db74">&#34;经理&#34;</span>, e2.employee_id
<span style="color:#66d9ef">FROM</span> employees e1, employees e2
<span style="color:#66d9ef">WHERE</span> e1.manager_id <span style="color:#f92672">=</span> e2.employee_id
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;

<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">员工</span>      <span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">经理</span>      <span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ernst     <span style="color:#f92672">|</span>         <span style="color:#ae81ff">104</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Austin    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">105</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Pataballa <span style="color:#f92672">|</span>         <span style="color:#ae81ff">106</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Lorentz   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">107</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Faviet    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">109</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Chen      <span style="color:#f92672">|</span>         <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">也可以搞多份</span>, <span style="color:#960050;background-color:#1e0010">比如三级经理</span>
<span style="color:#66d9ef">SELECT</span> e1.last_name <span style="color:#e6db74">&#34;员工&#34;</span>, e1.employee_id, e2.last_name <span style="color:#e6db74">&#34;经理&#34;</span>, e2.employee_id, e3.last_name <span style="color:#e6db74">&#34;总经理&#34;</span>, e3.employee_id
<span style="color:#66d9ef">FROM</span> employees e1, employees e2, employees e3
<span style="color:#66d9ef">WHERE</span> e1.manager_id <span style="color:#f92672">=</span> e2.employee_id <span style="color:#66d9ef">AND</span> e2.manager_id <span style="color:#f92672">=</span> e3.employee_id
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+---------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">员工</span>      <span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">经理</span>      <span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">总经理</span>  <span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+---------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> King    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ernst     <span style="color:#f92672">|</span>         <span style="color:#ae81ff">104</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Austin    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">105</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Pataballa <span style="color:#f92672">|</span>         <span style="color:#ae81ff">106</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Lorentz   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">107</span> <span style="color:#f92672">|</span> Hunold    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">103</span> <span style="color:#f92672">|</span> De Haan <span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> King    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Faviet    <span style="color:#f92672">|</span>         <span style="color:#ae81ff">109</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Chen      <span style="color:#f92672">|</span>         <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Sciarra   <span style="color:#f92672">|</span>         <span style="color:#ae81ff">111</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Urman     <span style="color:#f92672">|</span>         <span style="color:#ae81ff">112</span> <span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span>         <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span> Kochhar <span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+-----------+-------------+---------+-------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">当然这里没处理没有三级经理的情况</span>

<span style="color:#75715e">-- 非自连接
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">不同的表之间的连接就是非自连接</span>
</code></pre></div><h4 id="23-分类3-内连接-vs-外连接">2.3 分类3: 内连接 vs 外连接</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">内连接</span>
<span style="color:#960050;background-color:#1e0010">上面的都是内连接</span>
<span style="color:#960050;background-color:#1e0010">左表和右表中满足连接条件的查出来了</span>, <span style="color:#960050;background-color:#1e0010">不满足的就没有查出来</span>
<span style="color:#960050;background-color:#1e0010">因此上面有些员工没有经理的就没有查出来</span>

<span style="color:#960050;background-color:#1e0010">外连接</span>
<span style="color:#960050;background-color:#1e0010">合并具有同一列的两个以上的表的行</span>, <span style="color:#960050;background-color:#1e0010">结果集中除了包含一个表与另一个表匹配的行之外</span>, <span style="color:#960050;background-color:#1e0010">还查询到了左表</span> <span style="color:#960050;background-color:#1e0010">或</span> <span style="color:#960050;background-color:#1e0010">右表中不匹配的行</span>.

<span style="color:#960050;background-color:#1e0010">外连接</span>: 
<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">左外连接</span>
<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">右外连接</span>
<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">全</span>(<span style="color:#960050;background-color:#1e0010">满</span>)<span style="color:#960050;background-color:#1e0010">外连接</span>

<span style="color:#960050;background-color:#1e0010">在连接过程中除了返回满足连接条件的行以外还返回左表中不满足条件的行</span>, <span style="color:#960050;background-color:#1e0010">这些种连接称为左外连接</span>. 
<span style="color:#960050;background-color:#1e0010">右外连接类似</span>.

<span style="color:#960050;background-color:#1e0010">练习</span>: <span style="color:#960050;background-color:#1e0010">查询所有的员工信息和部门信息</span>, <span style="color:#960050;background-color:#1e0010">如果员工没有部门</span>, <span style="color:#960050;background-color:#1e0010">也要显示出来</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;
<span style="color:#75715e">-- +-------------+---------------+------------------+
</span><span style="color:#75715e">-- | last_name   | department_id | department_name  |
</span><span style="color:#75715e">-- +-------------+---------------+------------------+
</span><span style="color:#75715e">-- | King        |            90 | Executive        |
</span><span style="color:#75715e">-- | Kochhar     |            90 | Executive        |
</span><span style="color:#75715e">-- | De Haan     |            90 | Executive        |
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">返回了</span> <span style="color:#ae81ff">107</span> <span style="color:#960050;background-color:#1e0010">条</span>, <span style="color:#960050;background-color:#1e0010">把没有部门的员工也查出来了</span>
</code></pre></div><h4 id="sql92-语法实现外连接">SQL92 语法实现外连接</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">左外连接</span>: <span style="color:#960050;background-color:#1e0010">使用</span> <span style="color:#f92672">+</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e, departments d
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> d.department_id(<span style="color:#f92672">+</span>);
<span style="color:#75715e">-- 但是 MySQL 中不支持 SQL92 的语法.
</span><span style="color:#75715e">-- 但是 Oracle 中支持 SQL92 的语法
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">右外连接就</span>:
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e, departments d
<span style="color:#66d9ef">WHERE</span> e.department_id(<span style="color:#f92672">+</span>) <span style="color:#f92672">=</span> d.department_id;

<span style="color:#75715e">-- SQL 99语法中使用JOIN ... ON 的方式实现多表的查询.
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;


<span style="color:#66d9ef">SELECT</span> e1.last_name, e1.department_id, e1.manager_id, e2.last_name, e2.employee_id
<span style="color:#66d9ef">FROM</span> employees e1 <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> employees e2
<span style="color:#66d9ef">ON</span> e1.manager_id <span style="color:#f92672">=</span> e2.employee_id;
<span style="color:#75715e">-- +-------------+---------------+------------+-----------+-------------+
</span><span style="color:#75715e">-- | last_name   | department_id | manager_id | last_name | employee_id |
</span><span style="color:#75715e">-- +-------------+---------------+------------+-----------+-------------+
</span><span style="color:#75715e">-- | King        |            90 |       NULL | NULL      |        NULL |
</span><span style="color:#75715e">-- | Kochhar     |            90 |        100 | King      |         100 |
</span><span style="color:#75715e">-- | De Haan     |            90 |        100 | King      |         100 |
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">返回</span> <span style="color:#ae81ff">107</span> <span style="color:#960050;background-color:#1e0010">条</span>

<span style="color:#75715e">-- SQL 99 语法实现内连接
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;
<span style="color:#960050;background-color:#1e0010">返回</span> <span style="color:#ae81ff">106</span> <span style="color:#960050;background-color:#1e0010">条</span>

<span style="color:#75715e">-- Left OUTER JOIN 和 LEFT JOIN 是等价的
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 右外连接 RIGHT JOIN
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">满外连接</span>
<span style="color:#75715e">-- MySQL 不支持 FULL JOIN
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">FULL</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

MySQL中要:
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;


</code></pre></div><h3 id="3-sql99语法实现多表查询">3. SQL99语法实现多表查询</h3>
<h3 id="4-union的使用">4. UNION的使用</h3>
<p>合并查询结果, 利用 UNION 关键字, 可以给出多条 SELECT 语句, 并根据他们的结果组成单个结果集. 合并时, 两个表对应的列数和数据类型必须相同, 并且相互对应. 各个 SELECT 语句之间使用 UNION 或 UNION ALL 关键字分割.</p>
<ul>
<li>UNION: 去重</li>
<li>UNION ALL: 不去重</li>
</ul>
<p>UNION ALL 语句所需要的资源比 UNION 语句少, 如果明确知道合并数据后的结果数据不存在重复的行, 可以使用 UNION ALL 语句. 尽量使用 UNION ALL 语句, 以提高查询效率.</p>
<h3 id="5-7种sql-joins的使用">5. 7种SQL JOINS的使用</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. A <span style="color:#960050;background-color:#1e0010">∩</span> B: <span style="color:#960050;background-color:#1e0010">内连接</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

<span style="color:#960050;background-color:#1e0010">或者</span>

<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e, departments d
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">左外连接</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;

<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">右外连接</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;

<span style="color:#ae81ff">4</span>. A <span style="color:#f92672">-</span> B <span style="color:#f92672">=</span> A <span style="color:#f92672">-</span> (A <span style="color:#960050;background-color:#1e0010">∩</span> B): <span style="color:#960050;background-color:#1e0010">左外连接</span>, <span style="color:#960050;background-color:#1e0010">右表为空</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">WHERE</span> departments.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;

<span style="color:#ae81ff">5</span>. B <span style="color:#f92672">-</span> A <span style="color:#f92672">=</span> B <span style="color:#f92672">-</span> (A <span style="color:#960050;background-color:#1e0010">∩</span> B): <span style="color:#960050;background-color:#1e0010">右外连接</span>, <span style="color:#960050;background-color:#1e0010">左表为空</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;

<span style="color:#ae81ff">6</span>. A <span style="color:#960050;background-color:#1e0010">∪</span> B: <span style="color:#960050;background-color:#1e0010">全外连接</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;

<span style="color:#960050;background-color:#1e0010">也可以变成</span> <span style="color:#960050;background-color:#1e0010">左外连接</span> <span style="color:#960050;background-color:#1e0010">∪</span> B <span style="color:#f92672">-</span> A <span style="color:#f92672">=</span> B <span style="color:#f92672">-</span> (A <span style="color:#960050;background-color:#1e0010">∩</span> B)
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;

<span style="color:#ae81ff">7</span>. A <span style="color:#f92672">-</span> B <span style="color:#960050;background-color:#1e0010">∪</span> B <span style="color:#f92672">-</span> A: <span style="color:#960050;background-color:#1e0010">全外连接</span> <span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">内连接</span>
<span style="color:#960050;background-color:#1e0010">其实是</span> A <span style="color:#f92672">-</span> B <span style="color:#f92672">=</span> (A <span style="color:#f92672">-</span> (A <span style="color:#960050;background-color:#1e0010">∩</span> B)) <span style="color:#960050;background-color:#1e0010">∪</span> (B <span style="color:#f92672">-</span> A) <span style="color:#f92672">=</span> B <span style="color:#f92672">-</span> (A <span style="color:#960050;background-color:#1e0010">∩</span> B)
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">WHERE</span> departments.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">UNION</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, departments.department_id
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">RIGHT</span> <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id
<span style="color:#66d9ef">WHERE</span> employees.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;
</code></pre></div><h3 id="6-sql99语法新特性">6. SQL99语法新特性</h3>
<h4 id="61-natural-join">6.1 Natural Join</h4>
<p>NATURAL JOIN 会帮你自动查询两张连接表中所有相同的字段, 然后进行等值连接.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_name
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">NATURAL</span> <span style="color:#66d9ef">JOIN</span> departments;
</code></pre></div><h4 id="62-using-join">6.2 Using Join</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 原本是
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_name
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">ON</span> employees.department_id <span style="color:#f92672">=</span> departments.department_id;

<span style="color:#75715e">-- 使用 USING
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, department_name
<span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">JOIN</span> departments
<span style="color:#66d9ef">USING</span> (department_id);
<span style="color:#75715e">-- 括号里填写同名的字段名
</span></code></pre></div><h3 id="7-多表查询练习">7. 多表查询练习</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">显示所有员工的姓名</span>, <span style="color:#960050;background-color:#1e0010">部门号和部门名称</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;
<span style="color:#75715e">-- 107 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">查询</span><span style="color:#ae81ff">90</span><span style="color:#960050;background-color:#1e0010">号部门的员工的</span>job_id <span style="color:#960050;background-color:#1e0010">和</span><span style="color:#ae81ff">90</span><span style="color:#960050;background-color:#1e0010">号部门的</span>location_id
<span style="color:#66d9ef">SELECT</span> e.job_id, d.location_id
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">WHERE</span> e.department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">90</span>;
<span style="color:#75715e">-- 3 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">选择所有有奖金的员工的</span> last_name, department_name, location_id, city
<span style="color:#960050;background-color:#1e0010">这里是所有</span>, <span style="color:#960050;background-color:#1e0010">所以两个都要是</span> <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, d.department_name, l.location_id, l.city
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d 
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> locations l
<span style="color:#66d9ef">ON</span> d.location_id <span style="color:#f92672">=</span> l.location_id
<span style="color:#66d9ef">WHERE</span> e.commission_pct <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">OR</span> e.commission_pct <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>;
<span style="color:#75715e">-- 35 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">4</span>. <span style="color:#960050;background-color:#1e0010">选择</span> city <span style="color:#960050;background-color:#1e0010">在</span> Toronto工作的员工的 last_name, job_id, department_id, department_name
<span style="color:#66d9ef">SELECT</span> e.last_name, e.job_id, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">JOIN</span> locations l
<span style="color:#66d9ef">ON</span> d.location_id <span style="color:#f92672">=</span> l.location_id
<span style="color:#66d9ef">WHERE</span> l.city <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Toronto&#39;</span>;
<span style="color:#75715e">-- 2 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">5</span>. <span style="color:#960050;background-color:#1e0010">查询员工所在的部门名称，部门地址，姓名，工作，工资，其中员工所在的部门名称为</span> <span style="color:#e6db74">&#39;Executive&#39;</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.job_id, e.salary, d.department_name, l.city
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">JOIN</span> locations l
<span style="color:#66d9ef">ON</span> d.location_id <span style="color:#f92672">=</span> l.location_id
<span style="color:#66d9ef">WHERE</span> d.department_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Executive&#39;</span>;
<span style="color:#75715e">-- 3 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">6</span>. <span style="color:#960050;background-color:#1e0010">选择指定员工的姓名，员工号，以及他的管理者的姓名和员工号，结果以以下的格式</span>
employees EMP<span style="color:#f92672">#</span> manager Mgr<span style="color:#f92672">#</span>
xxx       xx   xxx     xx
<span style="color:#66d9ef">SELECT</span> e.last_name <span style="color:#e6db74">&#34;employees&#34;</span>, e.employee_id <span style="color:#e6db74">&#34;EMP#&#34;</span>, m.last_name <span style="color:#e6db74">&#34;manager&#34;</span>, m.employee_id <span style="color:#e6db74">&#34;Mgr#&#34;</span>
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> employees m
<span style="color:#66d9ef">ON</span> e.manager_id <span style="color:#f92672">=</span> m.employee_id;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------+-----------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employees   <span style="color:#f92672">|</span> EMP<span style="color:#f92672">#</span> <span style="color:#f92672">|</span> manager   <span style="color:#f92672">|</span> Mgr<span style="color:#f92672">#</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+------+-----------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span>  <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>      <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span>  <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>
<span style="color:#75715e">-- 107 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">7</span>. <span style="color:#960050;background-color:#1e0010">查询哪些部门没有员工</span>
<span style="color:#66d9ef">SELECT</span> d.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> departments d <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> employees e
<span style="color:#66d9ef">ON</span> d.department_id <span style="color:#f92672">=</span> e.department_id
<span style="color:#66d9ef">WHERE</span> e.last_name <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- 16 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">8</span>. <span style="color:#960050;background-color:#1e0010">查询哪个城市没有部门</span>
<span style="color:#66d9ef">SELECT</span> l.city, d.department_id
<span style="color:#66d9ef">FROM</span> locations l <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> l.location_id <span style="color:#f92672">=</span> d.location_id
<span style="color:#66d9ef">WHERE</span> d.department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- 16 rows
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">9</span>. <span style="color:#960050;background-color:#1e0010">查询部门名为</span> <span style="color:#e6db74">&#39;Sales&#39;</span> <span style="color:#960050;background-color:#1e0010">或</span> <span style="color:#e6db74">&#39;IT&#39;</span> <span style="color:#960050;background-color:#1e0010">的员工信息</span>
<span style="color:#66d9ef">SELECT</span> e.last_name, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> departments d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">WHERE</span> d.department_name <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#39;Sales&#39;</span>, <span style="color:#e6db74">&#39;IT&#39;</span>);
<span style="color:#75715e">-- 39 rows
</span><span style="color:#75715e"></span>
</code></pre></div><h2 id="7-单行函数">7. 单行函数</h2>
<h3 id="1-函数的理解">1. 函数的理解</h3>
<h4 id="11-什么是函数">1.1 什么是函数</h4>
<h4 id="12-不同dbms函数的差异">1.2 不同DBMS函数的差异</h4>
<p>不同管理系统的里面差别特别大</p>
<h4 id="13-mysql的内置函数及分类">1.3 MySQL的内置函数及分类</h4>
<p>从实现相关的角度分类</p>
<ul>
<li>数值函数</li>
<li>字符串函数</li>
<li>日期和时间函数</li>
<li>流程控制函数</li>
<li>加密与解密函数</li>
<li>获取MySQL信息函数</li>
<li>聚合函数等</li>
</ul>
<p>又根据操作数据的行数可以分为</p>
<ul>
<li>单行函数</li>
<li>聚合函数</li>
</ul>
<p>单行函数</p>
<ul>
<li>操作数据对象</li>
<li>接受参数返回一个结果</li>
<li>只对一行进行变换</li>
<li>每行返回一个结果</li>
<li>可以嵌套</li>
<li>参数可以是一列或一个值</li>
</ul>
<h3 id="2-数值函数">2. 数值函数</h3>
<h4 id="21-基本函数">2.1 基本函数</h4>
<ul>
<li>ABS(x): 返回 x 的绝对值</li>
<li>SIGN(x): 返回 x 的符号, 正数返回 1, 负数返回 -1, 0 返回 0</li>
<li>PI(): 返回圆周率的值</li>
<li>CEIL(x), CEILING(x): 返回大于或等于 x 的最小整数</li>
<li>FLOOR(x): 返回小于或等于 x 的最大整数</li>
<li>LEAST(x, y, &hellip;): 返回列表中的最小值</li>
<li>GREATEST(x, y, &hellip;): 返回列表中最大值</li>
<li>MOD(x, y): 返回 x 除以 y 的余数</li>
<li>RAND(): 返回 0 到 1 之间的随机数</li>
<li>RAND(x): 返回 x 为种子的随机数</li>
<li>ROUND(x): 四舍五入</li>
<li>ROUND(x, y): 四舍五入到小数点后 y 位</li>
<li>TRUNCATE(x, y): 返回 x 截断到小数点后 y 位</li>
<li>SQRT(x): 返回 x 的平方根</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">0</span>), ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">1</span>), ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">2</span>), ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+-------------------+-------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">0</span>) <span style="color:#f92672">|</span> ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span> ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> ROUND(<span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">456</span>, <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+-------------------+-------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>               <span style="color:#ae81ff">123</span> <span style="color:#f92672">|</span>             <span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">5</span> <span style="color:#f92672">|</span>            <span style="color:#ae81ff">123</span>.<span style="color:#ae81ff">46</span> <span style="color:#f92672">|</span>                <span style="color:#ae81ff">120</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+-------------------+-------------------+--------------------+
</span></code></pre></div><h4 id="22-角度与弧度互换函数">2.2 角度与弧度互换函数</h4>
<ul>
<li>RADIANS(x): 将角度 x 转换为弧度</li>
<li>DEGREES(x): 将弧度 x 转换为角度</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> RADIANS(<span style="color:#ae81ff">180</span>), DEGREES(<span style="color:#ae81ff">3</span>.<span style="color:#ae81ff">1415926</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> RADIANS(<span style="color:#ae81ff">180</span>)      <span style="color:#f92672">|</span> DEGREES(<span style="color:#ae81ff">3</span>.<span style="color:#ae81ff">1415926</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">3</span>.<span style="color:#ae81ff">141592653589793</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">179</span>.<span style="color:#ae81ff">99999692953102</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------+--------------------+
</span></code></pre></div><h4 id="23-三角函数">2.3 三角函数</h4>
<p>这里的 x 都是弧度值, 不是角度值</p>
<ul>
<li>SIN(x): 返回 x 的正弦</li>
<li>ASIN(x): 返回 x 的反正弦, 如果x不在-1到1之间, 返回NULL</li>
<li>COS(x): 返回 x 的余弦</li>
<li>ACOS(x): 返回 x 的反余弦, 如果x不在-1到1之间, 返回NULL</li>
<li>TAN(x): 返回 x 的正切</li>
<li>ATAN(x): 返回 x 的反正切</li>
<li>ATAN2(y, x): 返回 y/x 的反正切, 返回值在 -PI 到 PI 之间</li>
<li>COT(x): 返回 x 的余切</li>
</ul>
<h4 id="24-指数与对数">2.4 指数与对数</h4>
<ul>
<li>POW(x, y), POWER(x,y): 返回 x 的 y 次幂</li>
<li>EXP(x): 返回 e 的 x 次幂</li>
<li>LN(x), LOG(x): 返回 x 的自然对数, 当 x 为负数或 0 时, 返回 NULL</li>
<li>LOG10(x): 返回 x 的以 10 为底的对数, 当 x 为负数或 0 时, 返回 NULL</li>
<li>LOG2(x): 返回 x 的以 2 为底的对数, 当 x 为负数或 0 时, 返回 NULL</li>
</ul>
<h4 id="25-进制间的转换">2.5 进制间的转换</h4>
<ul>
<li>BIN(x): 返回 x 的二进制值</li>
<li>HEX(x): 返回 x 的十六进制值</li>
<li>OCT(x): 返回 x 的八进制值</li>
<li>CONV(x, a, b): 返回 x 的 a 进制值转换为 b 进制值</li>
</ul>
<h3 id="3-字符串函数">3. 字符串函数</h3>
<ul>
<li>ASCII(S): 返回 S 的<strong>第一个</strong>字符的 ASCII 值</li>
<li>CHAR_LENGTH(S), LENGTH(S): 返回 S 的字符数</li>
<li>LENGTHB(S): 返回 S 的字节数, 与字符集相关</li>
<li>CONCAT(S1, S2, &hellip;): 返回连接 S1, S2, &hellip; 的结果</li>
<li>CONCAT_WS(separator, S1, S2, &hellip;): 返回连接 S1, S2, &hellip; 的结果, 并用 separator 分隔开</li>
<li>INSERT(str, start, length, new_str): 返回 str 的子串, 从 start 开始, 长度为 length, 替换为 new_str</li>
<li>REPLACE(str, from_str, to_str): 返回 str 的子串, 将 from_str 替换为 to_str</li>
<li>UPPER(S) 或 UCASE(S): 返回 S 的大写形式</li>
<li>LOWER(S) 或 LCASE(S): 返回 S 的小写形式</li>
<li>LEFT(S, N): 返回 S 的前 N 个字符</li>
<li>RIGHT(S, N): 返回 S 的后 N 个字符</li>
<li>LPAD(S, N, pad_str): 返回 S 的左填充 pad_str 字符, 直到长度为 N</li>
<li>RPAD(S, N, pad_str): 返回 S 的右填充 pad_str 字符, 直到长度为 N</li>
<li>LTRIM(S): 返回去掉 S 左边空格的结果</li>
<li>RTRIM(S): 返回去掉 S 右边空格的结果</li>
<li>TRIM(S): 返回去掉 S 两边空格的结果</li>
<li>TRIM(s1 FROM s2): 返回去掉 s2 两边 s1 的结果</li>
<li>TRIM(LEADING s1 FROM s2): 返回去掉 s2 左边 s1 的结果</li>
<li>TRIM(TRAILING s1 FROM s2): 返回去掉 s2 右边 s1 的结果</li>
<li>REPEAT(S, N): 返回 S 重复 N 次的结果</li>
<li>SPACE(N): 返回 N 个空格</li>
<li>STRCMP(S1, S2): 返回 S1 和 S2 的比较结果, 相等返回 0, S1 大于 S2 返回 1, S1 小于 S2 返回 -1</li>
<li>SUBSTR(s, start, length), SUBSTRING(s, start, length), MID(s, start, length): 返回 s 的子串, 从 start 开始, 长度为 length</li>
<li>LOCATE(s1, s2), POSITION(s1 IN s2), INSTR(s1, s2): 返回 s1 在 s2 中的位置, 从 1 开始</li>
<li>ELT(N, S1, S2, &hellip;): 返回 S1, S2, &hellip; 中的第 N 个字符串</li>
<li>FIELD(S, S1, S2, &hellip;): 返回 S 在 S1, S2, &hellip; 中的位置, 从 1 开始</li>
<li>FIND_IN_SET(S, S1): 返回 S 在 S1 中的位置, 从 1 开始</li>
<li>REVERSE(S): 返回 S 的反转结果</li>
<li>NULLIF(S1, S2): 如果 S1 = S2, 返回 NULL, 否则返回 S1</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 字符数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">CHAR_LENGTH</span>(<span style="color:#e6db74">&#34;hello&#34;</span>), <span style="color:#66d9ef">CHAR_LENGTH</span>(<span style="color:#e6db74">&#34;你好&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------+---------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CHAR_LENGTH</span>(<span style="color:#e6db74">&#34;hello&#34;</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">CHAR_LENGTH</span>(<span style="color:#e6db74">&#34;你好&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------+---------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                    <span style="color:#ae81ff">5</span> <span style="color:#f92672">|</span>                   <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------+---------------------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- 字节数
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#e6db74">&#34;hello&#34;</span>), <span style="color:#66d9ef">LENGTH</span>(<span style="color:#e6db74">&#34;你好&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#e6db74">&#34;hello&#34;</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">LENGTH</span>(<span style="color:#e6db74">&#34;你好&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>               <span style="color:#ae81ff">5</span> <span style="color:#f92672">|</span>              <span style="color:#ae81ff">4</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+----------------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- CONCAT_WS
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> CONCAT_WS(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> CONCAT_WS(<span style="color:#e6db74">&#39;,&#39;</span>, <span style="color:#e6db74">&#39;a&#39;</span>, <span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> a,b,<span style="color:#66d9ef">c</span>                         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- INSERT
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hello MySQLd                         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">7</span>, <span style="color:#ae81ff">5</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hello MySQL                          <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">7</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hello wMySQL                         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e">-- 看来是超出就超出了, 他不管你
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">INSERT</span>(<span style="color:#e6db74">&#39;hello world&#39;</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;MySQL&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> MySQLlo world                        <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------------+
</span><span style="color:#75715e">-- MySQL 里字符串的索引是从 1 开始的
</span><span style="color:#75715e"></span>
<span style="color:#75715e">-- LPAD
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;ax&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> LPAD(<span style="color:#e6db74">&#39;hello&#39;</span>, <span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#39;ax&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> axaxahello              <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------+
</span><span style="color:#75715e">-- 看起来是一直重复填充字符串，然后取前 10-char_length(S) 个字符
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">LOWER</span>(<span style="color:#e6db74">&#39;HELLO你好&#39;</span>), <span style="color:#66d9ef">UPPER</span>(<span style="color:#e6db74">&#39;hello你好&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">LOWER</span>(<span style="color:#e6db74">&#39;HELLO你好&#39;</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">UPPER</span>(<span style="color:#e6db74">&#39;hello你好&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> hello你好          <span style="color:#f92672">|</span> HELLO你好          <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+--------------------+
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">TRIM</span>(s1 <span style="color:#66d9ef">FROM</span> s2)
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> bbacc                      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">就是去除首尾的</span> a


<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#e6db74">&#39;ab&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;ababbaccaab&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#e6db74">&#39;ab&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;ababbaccaab&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> bacca                         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">去除首尾的</span> ab


<span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">LEADING</span> s1 <span style="color:#66d9ef">FROM</span> s2): <span style="color:#960050;background-color:#1e0010">返回去掉</span> s2 <span style="color:#960050;background-color:#1e0010">左边</span> s1 <span style="color:#960050;background-color:#1e0010">的结果</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">LEADING</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">LEADING</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> bbaccaa                            <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">就是类似于</span>LTRIM的功能


<span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">TRAILING</span> s1 <span style="color:#66d9ef">FROM</span> s2): <span style="color:#960050;background-color:#1e0010">返回去掉</span> s2 <span style="color:#960050;background-color:#1e0010">右边</span> s1 <span style="color:#960050;background-color:#1e0010">的结果</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">TRAILING</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">TRIM</span>(<span style="color:#66d9ef">TRAILING</span> <span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">FROM</span> <span style="color:#e6db74">&#39;aabbaccaa&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> aabbacc                             <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">就是类似于</span>RTRIM的功能


FIND_IN_SET(S, S1): <span style="color:#960050;background-color:#1e0010">返回</span> S <span style="color:#960050;background-color:#1e0010">在</span> S1 <span style="color:#960050;background-color:#1e0010">中的位置</span>, <span style="color:#960050;background-color:#1e0010">从</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">开始</span>
<span style="color:#66d9ef">SELECT</span> FIND_IN_SET(<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;a,b,c,d&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> FIND_IN_SET(<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;a,b,c,d&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                           <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">感觉就是分割后用了</span> FIELD <span style="color:#960050;background-color:#1e0010">函数</span>

</code></pre></div><p><strong>MySQL 中字符串的索引是从 1 开始的!</strong></p>
<h3 id="4-日期和时间函数">4. 日期和时间函数</h3>
<h4 id="41-获取日期时间">4.1 获取日期、时间</h4>
<ul>
<li>CURDATE(), CURRENT_DATE(): 返回当前日期, 只包含年月日</li>
<li>CURTIME(), CURRENT_TIME(): 返回当前时间, 只包含时分秒</li>
<li>NOW(), SYSDATE(), CURRENT_TIMESTAMP(), LOCALTIME(), LOCALTIMESTAMP(): 返回当前日期和时间</li>
<li>UTC_DATE(): 返回当前日期, 以 UTC 为准</li>
<li>UTC_TIME(): 返回当前时间, 以 UTC 为准</li>
<li>UNIX_TIMESTAMP(): 返回当前日期和时间的时间戳</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> CURDATE(), <span style="color:#66d9ef">CURRENT_DATE</span>(), CURTIME(), <span style="color:#66d9ef">CURRENT_TIME</span>(), NOW(), SYSDATE(), <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>(), <span style="color:#66d9ef">LOCALTIME</span>(), <span style="color:#66d9ef">LOCALTIMESTAMP</span>(), UTC_DATE(), UTC_TIME(), UNIX_TIMESTAMP();
<span style="color:#f92672">+</span><span style="color:#75715e">------------+----------------+-----------+----------------+---------------------+---------------------+---------------------+---------------------+---------------------+------------+------------+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> CURDATE()  <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_DATE</span>() <span style="color:#f92672">|</span> CURTIME() <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_TIME</span>() <span style="color:#f92672">|</span> NOW()               <span style="color:#f92672">|</span> SYSDATE()           <span style="color:#f92672">|</span> <span style="color:#66d9ef">CURRENT_TIMESTAMP</span>() <span style="color:#f92672">|</span> <span style="color:#66d9ef">LOCALTIME</span>()         <span style="color:#f92672">|</span> <span style="color:#66d9ef">LOCALTIMESTAMP</span>()    <span style="color:#f92672">|</span> UTC_DATE() <span style="color:#f92672">|</span> UTC_TIME() <span style="color:#f92672">|</span> UNIX_TIMESTAMP() <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+----------------+-----------+----------------+---------------------+---------------------+---------------------+---------------------+---------------------+------------+------------+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span>  <span style="color:#f92672">|</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span>       <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">02</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span>   <span style="color:#f92672">|</span>       <span style="color:#ae81ff">1710298667</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+----------------+-----------+----------------+---------------------+---------------------+---------------------+---------------------+---------------------+------------+------------+------------------+
</span><span style="color:#75715e"></span>
</code></pre></div><h4 id="42-日期与时间戳的转换">4.2 日期与时间戳的转换</h4>
<ul>
<li>UNIX_TIMESTAMP(): 以 UNIX 时间戳的形式返回当前时间</li>
<li>UNIX_TIMESTAMP(date): 以 UNIX 时间戳的形式返回 date 的时间</li>
<li>FROM_UNIXTIME(unix_timestamp): 返回 UNIX 时间戳 unix_timestamp 的日期和时间</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> from_unixtime(<span style="color:#ae81ff">1710298667</span>);
mysql<span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">SELECT</span> from_unixtime(<span style="color:#ae81ff">1710298667</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> from_unixtime(<span style="color:#ae81ff">1710298667</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">13</span> <span style="color:#ae81ff">10</span>:<span style="color:#ae81ff">57</span>:<span style="color:#ae81ff">47</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------------+
</span><span style="color:#75715e"></span>
</code></pre></div><h4 id="43-获取月份星期星期数天数等函数">4.3 获取月份、星期、星期数、天数等函数</h4>
<ul>
<li>YEAR(date): 返回 date 的年份</li>
<li>MONTH(date): 返回 date 的月份</li>
<li>DAY(date): 返回 date 的天</li>
<li>HOUR(time): 返回 time 的小时</li>
<li>MINUTE(time): 返回 time 的分钟</li>
<li>SECOND(time): 返回 time 的秒</li>
<li>MONTHNAME(date): 返回 date 的月份名, 英文</li>
<li>DAYNAME(date): 返回 date 的星期名, 英文</li>
<li>WEEKDAY(date): 返回 date 是周几, 0 表示星期一, 6 表示星期日</li>
<li>QUARTER(date): 返回 date 的季度, 范围是 1-4</li>
<li>WEEK(data): 返回是 data 的年份中的第几周</li>
<li>WEEKOFYEAR(date): 返回是 data 的年份中的第几周</li>
<li>DAYOFYEAR(date): 返回 date 是 data 的年份中的第几天</li>
<li>DAYOFMONTH(date): 返回 date 是 data 的月份中的第几天</li>
<li>DAYOFWEEK(date): 返回 date 是 data 的星期中的第几天, 周一是1</li>
</ul>
<h4 id="44-日期的操作函数">4.4 日期的操作函数</h4>
<ul>
<li>EXTRACT(unit FROM date): 返回 date 的 unit 部分, unit 可以是 YEAR, MONTH, DAY, HOUR, MINUTE, SECONDs</li>
</ul>
<h4 id="45-时间和秒钟转换的函数">4.5 时间和秒钟转换的函数</h4>
<ul>
<li>TIME_TO_SEC(time): 返回 time 的秒数</li>
<li>SEC_TO_TIME(seconds): 返回 seconds 秒数的时间</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> TIME_TO_SEC(CURTIME()), SEC_TO_TIME(TIME_TO_SEC(CURTIME()));
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+-------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> TIME_TO_SEC(CURTIME()) <span style="color:#f92672">|</span> SEC_TO_TIME(TIME_TO_SEC(CURTIME())) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+-------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                  <span style="color:#ae81ff">48507</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">13</span>:<span style="color:#ae81ff">28</span>:<span style="color:#ae81ff">27</span>                            <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+-------------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">就是今天的时间转换成秒数</span>, <span style="color:#960050;background-color:#1e0010">然后再转换回来</span>
</code></pre></div><h4 id="46-计算日期和时间的函数">4.6 计算日期和时间的函数</h4>
<ul>
<li>
<p>DATE_ADD(date, INTERVAL expr type): 返回 date 加上 expr 的结果</p>
</li>
<li>
<p>DATE_SUB(date, INTERVAL expr type): 返回 date 减去 expr 的结果</p>
</li>
<li>
<p>ADDTIME(time1, time2): 返回 time1 加上 time2 的结果</p>
</li>
<li>
<p>SUBTIME(time1, time2): 返回 time1 减去 time2 的结果</p>
</li>
<li>
<p>DATEDIFF(date1, date2): 返回 date1 和 date2 之间的天数</p>
</li>
<li>
<p>TIMEDIFF(time1, time2): 返回 time1 和 time2 之间的时间差</p>
</li>
<li>
<p>FROM_DAYS(N): 返回 0 年 1 月 1 日 N 天之后的日期</p>
</li>
<li>
<p>TO_DAYS(date): 返回 date 距离 0 年 1 月 1 日的天数</p>
</li>
<li>
<p>LAST_DAY(date): 返回 date 所在月的最后一天</p>
</li>
<li>
<p>MAKEDATE(year, dayofyear): 返回 year 年的第 dayofyear 天</p>
</li>
<li>
<p>MAKETIME(hour, minute, second): 返回 hour 小时 minute 分 second 秒的时间</p>
</li>
<li>
<p>PERIOD_ADD(P, N): 返回 P 加上 N 个月的结果</p>
</li>
</ul>
<h4 id="47-日期的格式化与解析">4.7 日期的格式化与解析</h4>
<ul>
<li>DATE_FORMAT(date, format): 返回 date 的格式化结果</li>
<li>TIME_FORMAT(time, format): 返回 time 的格式化结果</li>
<li>GET_FORMAT([DATE|TIME], [EUR|USA|JIS|ISO|INTERNAL|DB]): 返回日期或时间的格式, 返回当地的日期或时间格式</li>
<li>STR_TO_DATE(str, format): 返回 str 根据 format 格式化的日期</li>
</ul>
<h3 id="5-流程控制函数">5. 流程控制函数</h3>
<ul>
<li>IF(value, value1,value2): 如果 value 为真, 返回 value1, 否则返回 value2</li>
<li>IFNULL(value1, value2): 如果 value1 不为 NULL, 返回 value1, 否则返回 value2</li>
<li>CASE WHEN condition1 THEN result1 WHEN condition2 THEN result2 ELSE result END: 返回满足条件的结果</li>
<li>CASE expr WHEN value1 THEN result1 WHEN value2 THEN result2 ELSE result END: 返回满足条件的结果</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">IF</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;yes&#39;</span>, <span style="color:#e6db74">&#39;no&#39;</span>), IFNULL(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;yes&#39;</span>), IFNULL(<span style="color:#e6db74">&#39;no&#39;</span>, <span style="color:#e6db74">&#39;yes&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+---------------------+---------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">IF</span>(<span style="color:#ae81ff">1</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;yes&#39;</span>, <span style="color:#e6db74">&#39;no&#39;</span>) <span style="color:#f92672">|</span> IFNULL(<span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#39;yes&#39;</span>) <span style="color:#f92672">|</span> IFNULL(<span style="color:#e6db74">&#39;no&#39;</span>, <span style="color:#e6db74">&#39;yes&#39;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+---------------------+---------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">no</span>                     <span style="color:#f92672">|</span> yes                 <span style="color:#f92672">|</span> <span style="color:#66d9ef">no</span>                  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------+---------------------+---------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> last_name, salary, <span style="color:#66d9ef">IF</span>(salary <span style="color:#f92672">&gt;=</span><span style="color:#ae81ff">6000</span>, <span style="color:#e6db74">&#34;高&#34;</span>, <span style="color:#e6db74">&#34;低&#34;</span>) <span style="color:#e6db74">&#34;工资等级&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">工资等级</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">高</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">高</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">高</span>       <span style="color:#f92672">|</span>


<span style="color:#66d9ef">SELECT</span> last_name, commission_pct, IFNULL(commission_pct, <span style="color:#ae81ff">0</span>) <span style="color:#e6db74">&#34;奖金&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> commission_pct <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">奖金</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------------+------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span>           <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span>           <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>


IFNULL(value1, value2) <span style="color:#960050;background-color:#1e0010">可以看成是</span> <span style="color:#66d9ef">IF</span>(value1 <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>, value2, value1) <span style="color:#960050;background-color:#1e0010">的这种情况</span>


<span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> ... <span style="color:#66d9ef">THEN</span> ... <span style="color:#66d9ef">WHEN</span> ... <span style="color:#66d9ef">THEN</span> ... <span style="color:#66d9ef">ELSE</span> ... <span style="color:#66d9ef">END</span>

<span style="color:#66d9ef">SELECT</span> last_name, salary, <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> salary <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">15000</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#34;大于15000&#34;</span>
                               <span style="color:#66d9ef">WHEN</span> salary <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">10000</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#34;大于10000&#34;</span>
                               <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#34;小于10000&#34;</span> <span style="color:#66d9ef">END</span> <span style="color:#e6db74">&#34;工资等级&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">工资等级</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+-----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">大于</span><span style="color:#ae81ff">15000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">大于</span><span style="color:#ae81ff">15000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">大于</span><span style="color:#ae81ff">15000</span> <span style="color:#f92672">|</span>

<span style="color:#960050;background-color:#1e0010">类似于</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">else</span> <span style="color:#960050;background-color:#1e0010">的情况</span>, <span style="color:#960050;background-color:#1e0010">也可以没有最后的</span><span style="color:#66d9ef">else</span>

<span style="color:#66d9ef">SELECT</span> last_name, salary, <span style="color:#66d9ef">CASE</span> salary <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">24000</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#34;最高&#34;</span>
                                     <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">17000</span> <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#34;次高&#34;</span>
                                     <span style="color:#66d9ef">END</span> <span style="color:#e6db74">&#34;工资等级&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">工资等级</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">最高</span>     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">次高</span>     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">次高</span>     <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Hunold      <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>     <span style="color:#f92672">|</span>


<span style="color:#66d9ef">CASE</span> ... <span style="color:#66d9ef">WHEN</span> ... <span style="color:#66d9ef">THEN</span> ... <span style="color:#66d9ef">WHEN</span> ... <span style="color:#66d9ef">THEN</span> ... <span style="color:#66d9ef">ELSE</span> ... <span style="color:#66d9ef">END</span>

<span style="color:#960050;background-color:#1e0010">查询部门号为</span> <span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span> <span style="color:#960050;background-color:#1e0010">的员工信息</span>
<span style="color:#960050;background-color:#1e0010">若部门号为</span> <span style="color:#ae81ff">10</span>, <span style="color:#960050;background-color:#1e0010">则打印其工资的</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">倍</span>
<span style="color:#960050;background-color:#1e0010">若部门号为</span> <span style="color:#ae81ff">20</span>, <span style="color:#960050;background-color:#1e0010">则打印其工资的</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">2</span> <span style="color:#960050;background-color:#1e0010">倍</span>
<span style="color:#960050;background-color:#1e0010">若部门号为</span> <span style="color:#ae81ff">30</span>, <span style="color:#960050;background-color:#1e0010">则打印其工资的</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">3</span> <span style="color:#960050;background-color:#1e0010">倍</span>
<span style="color:#960050;background-color:#1e0010">其他部门打印其工资的</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">5</span> <span style="color:#960050;background-color:#1e0010">倍</span>

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, department_id, salary,
       <span style="color:#66d9ef">CASE</span> department_id <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">10</span> <span style="color:#66d9ef">THEN</span> salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">1</span>
                          <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">20</span> <span style="color:#66d9ef">THEN</span> salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">2</span>
                          <span style="color:#66d9ef">WHEN</span> <span style="color:#ae81ff">30</span> <span style="color:#66d9ef">THEN</span> salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">3</span>
                          <span style="color:#66d9ef">ELSE</span> salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">1</span>.<span style="color:#ae81ff">5</span> <span style="color:#66d9ef">END</span> <span style="color:#e6db74">&#34;工资&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+---------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">工资</span>     <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+---------------+----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>         <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span> King        <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">36000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">101</span> <span style="color:#f92672">|</span> Kochhar     <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">25500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>         <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span> De Haan     <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">25500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>

<span style="color:#960050;background-color:#1e0010">也可以没有</span> <span style="color:#66d9ef">ELSE</span> <span style="color:#960050;background-color:#1e0010">的情况</span>

</code></pre></div><h3 id="6-加密与解密函数">6. 加密与解密函数</h3>
<ul>
<li>PASSWORD(str): 返回 str 的加密结果, 41 位长度, 不可逆</li>
<li>MD5(str): 返回 str 的 MD5 加密结果, 若输入为 NULL, 返回 NULL</li>
<li>SHA(str): 返回 str 的 SHA 加密结果, 若输入为 NULL, 返回 NULL, 比 MD5 安全</li>
<li>ENCODE(value, password_seed): 返回 value 的加密结果, 使用 password_seed 作为种子</li>
<li>DECODE(value, password_seed): 返回 value 的解密结果, 使用 password_seed 作为种子</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">之后就不让用</span> PASSWORD <span style="color:#960050;background-color:#1e0010">了</span>
<span style="color:#f92672">#</span> <span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">也不支持</span> ENCODE <span style="color:#960050;background-color:#1e0010">和</span> DECODE <span style="color:#960050;background-color:#1e0010">了</span>
<span style="color:#66d9ef">SELECT</span> PASSWORD(<span style="color:#e6db74">&#39;aaaa&#39;</span>);

<span style="color:#66d9ef">SELECT</span> MD5(<span style="color:#e6db74">&#39;aaaa&#39;</span>), SHA(<span style="color:#e6db74">&#39;aaaa&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------+------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> MD5(<span style="color:#e6db74">&#39;aaaa&#39;</span>)                      <span style="color:#f92672">|</span> SHA(<span style="color:#e6db74">&#39;aaaa&#39;</span>)                              <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------+------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">74</span>b87337454200d4d33f80c4663dc5e5 <span style="color:#f92672">|</span> <span style="color:#ae81ff">70</span>c881d4a26984ddce795f6f71817c9cf4480e79 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------------+------------------------------------------+
</span></code></pre></div><h3 id="7-mysql-信息函数">7. MySQL 信息函数</h3>
<ul>
<li>VERSION(): 返回 MySQL 服务器的版本</li>
<li>CONNECTION_ID(): 返回连接数</li>
<li>DATABASE(): 返回当前数据库名</li>
<li>SCHEMA(): 返回当前数据库名</li>
<li>USER(), CURRENT_USER(), SYSTEM_USER(), SESSION_USER(): 返回当前用户</li>
<li>CHARSET(value): 返回 value 的字符集</li>
<li>COLLATION(value): 返回 value 的比较规则</li>
</ul>
<h3 id="8-其他函数">8. 其他函数</h3>
<ul>
<li>FORMAT(value, n): 返回对数字 value 进行格式化后的结果数据, n 为小数点后的位数</li>
<li>CONV(value, from, to): 将 value 的值进行不同进制之间的转换</li>
<li>INET_ATON(str): 将以点分割的IP地址转化为一个数字</li>
<li>INET_NTOA(value): 将数字形式的 IP 地址转化为以点分隔的 IP 地址</li>
<li>BENCHMARK(n, expr): 将表达式重复执行 n 次, 用域测试 MySQL 处理 expr 表达式所耗费的时间</li>
<li>CONVERT(value USING charset): 返回 value 的字符集为 charset 的结果</li>
</ul>
<h3 id="9-课后练习">9. 课后练习</h3>
<p>看过了</p>
<h2 id="8-聚合函数">8. 聚合函数</h2>
<h3 id="1-聚合函数介绍">1. 聚合函数介绍</h3>
<p>多进一出的函数, 下面介绍几个常见的聚合函数</p>
<h4 id="11-avg和sum-函数">1.1 AVG和SUM 函数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary), <span style="color:#66d9ef">SUM</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">6461</span>.<span style="color:#ae81ff">682243</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">691400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(last_name) 
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(last_name) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>              <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">这个其实是没有意义的</span>
</code></pre></div><h4 id="12-min和max-函数">1.2 MIN和MAX 函数</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(salary), <span style="color:#66d9ef">MIN</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">2100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(last_name), <span style="color:#66d9ef">MIN</span>(last_name)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(last_name) <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(last_name) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Zlotkey        <span style="color:#f92672">|</span> Abel           <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------+----------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">根据字母表排序的</span>
</code></pre></div><h4 id="13-count-函数">1.3 COUNT 函数</h4>
<p>作用: 计算指定字段中在查询结果中出现的个数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(employee_id)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">COUNT</span>(employee_id) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                <span style="color:#ae81ff">107</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">COUNT</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>           <span style="color:#ae81ff">107</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">计算表中有多少条记录</span>
<span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)
<span style="color:#66d9ef">COUNT</span>(<span style="color:#ae81ff">1</span>)
<span style="color:#66d9ef">COUNT</span>(<span style="color:#960050;background-color:#1e0010">具体字段</span>): <span style="color:#960050;background-color:#1e0010">但是这个不一定对</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(commission_pct)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">COUNT</span>(commission_pct) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                    <span style="color:#ae81ff">35</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">但是实际上有</span> <span style="color:#ae81ff">107</span> <span style="color:#960050;background-color:#1e0010">条</span>

<span style="color:#66d9ef">SELECT</span> commission_pct
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> commission_pct <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#75715e">-- 35 rows 
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">因此</span><span style="color:#66d9ef">COUNT</span>(<span style="color:#960050;background-color:#1e0010">具体字段</span>)<span style="color:#960050;background-color:#1e0010">就是找的非</span>NULL的值的个数

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(commission_pct), <span style="color:#66d9ef">SUM</span>(commission_pct),  <span style="color:#66d9ef">SUM</span>(commission_pct)<span style="color:#f92672">/</span><span style="color:#66d9ef">COUNT</span>(commission_pct), <span style="color:#66d9ef">SUM</span>(commission_pct)<span style="color:#f92672">/</span><span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------+---------------------+-------------------------------------------+------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(commission_pct) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(commission_pct) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(commission_pct)<span style="color:#f92672">/</span><span style="color:#66d9ef">COUNT</span>(commission_pct) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(commission_pct)<span style="color:#f92672">/</span><span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------+---------------------+-------------------------------------------+------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">222857</span> <span style="color:#f92672">|</span>                <span style="color:#ae81ff">7</span>.<span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>                                  <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">222857</span> <span style="color:#f92672">|</span>                     <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">072897</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------------+---------------------+-------------------------------------------+------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SUM</span> <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#66d9ef">AVG</span> <span style="color:#960050;background-color:#1e0010">都是自动跳过了</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">AVG</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">SUM</span><span style="color:#f92672">/</span><span style="color:#66d9ef">COUNT</span>

<span style="color:#960050;background-color:#1e0010">可以这样写</span>, <span style="color:#960050;background-color:#1e0010">平均奖金</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(IFNULL(commission_pct, <span style="color:#ae81ff">0</span>))
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(IFNULL(commission_pct, <span style="color:#ae81ff">0</span>)) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                       <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">072897</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------------------+
</span><span style="color:#75715e"></span>


<span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>), <span style="color:#66d9ef">COUNT</span>(<span style="color:#ae81ff">1</span>), <span style="color:#66d9ef">COUNT</span>(<span style="color:#960050;background-color:#1e0010">具体字段</span>) <span style="color:#960050;background-color:#1e0010">哪个效率更高</span><span style="color:#f92672">?</span>
<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">如果使用的是</span> MyISAM <span style="color:#960050;background-color:#1e0010">存储引擎</span>, <span style="color:#960050;background-color:#1e0010">那么</span> <span style="color:#960050;background-color:#1e0010">三者</span> <span style="color:#960050;background-color:#1e0010">的效率是一样的</span>, <span style="color:#960050;background-color:#1e0010">都是</span>O(<span style="color:#ae81ff">1</span>), <span style="color:#960050;background-color:#1e0010">都是直接返回表的总行数</span>
<span style="color:#f92672">-</span> <span style="color:#960050;background-color:#1e0010">如果使用的是</span> InnoDB <span style="color:#960050;background-color:#1e0010">存储引擎</span>, <span style="color:#960050;background-color:#1e0010">那么</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">=</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#ae81ff">1</span>) <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#960050;background-color:#1e0010">具体字段</span>), <span style="color:#960050;background-color:#1e0010">因为</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#ae81ff">1</span>) <span style="color:#960050;background-color:#1e0010">是直接返回表的总行数</span>, <span style="color:#960050;background-color:#1e0010">而</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#960050;background-color:#1e0010">具体字段</span>) <span style="color:#960050;background-color:#1e0010">是返回非空值的行数</span>, <span style="color:#960050;background-color:#1e0010">需要扫描具体字段的值</span>
</code></pre></div><h3 id="2-group-by-子句">2. GROUP BY 子句</h3>
<p>需求: 想要求出每个部门的平均工资</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 整个公司的平均工资
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;

<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>          <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">10</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#960050;background-color:#1e0010">相当于把员工表分成了很多组</span>, <span style="color:#960050;background-color:#1e0010">每一组的平均工资</span>

<span style="color:#960050;background-color:#1e0010">查询各个</span> job_id <span style="color:#960050;background-color:#1e0010">的平均工资</span>
<span style="color:#66d9ef">SELECT</span> job_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> job_id     <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> AD_PRES    <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AD_VP      <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> MK_MAN     <span style="color:#f92672">|</span> <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
</code></pre></div><p>需求: 查询各个部门, 工种的平均工资</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> department_id, job_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id, job_id
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>  <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> job_id     <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> AD_PRES    <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> AD_VP      <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span> MK_MAN     <span style="color:#f92672">|</span> <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#75715e">-- 20 rows
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> department_id, job_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id, department_id
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>;
<span style="color:#75715e">-- 20 rows 
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">这两个是一样的</span>, <span style="color:#960050;background-color:#1e0010">因为属于同一组的记录都是通过两个元素定位的</span>, <span style="color:#960050;background-color:#1e0010">元素的顺序已经和名字绑定了</span>, <span style="color:#960050;background-color:#1e0010">因此是一样的</span>


<span style="color:#960050;background-color:#1e0010">错误代码</span>
<span style="color:#66d9ef">SELECT</span> department_id, job_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id;
<span style="color:#960050;background-color:#1e0010">非聚合函数和列名必须声明在</span> <span style="color:#66d9ef">group</span> <span style="color:#66d9ef">by</span> <span style="color:#960050;background-color:#1e0010">中</span>.

<span style="color:#66d9ef">SELECT</span> department_id, job_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id;
<span style="color:#960050;background-color:#1e0010">也是错的</span>

<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">声明在</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">语句后面</span>, <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">语句的后面</span>, <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#960050;background-color:#1e0010">语句的前面</span>.


<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">ROLLUP</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>          <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">7000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">10</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4150</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">40</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6500</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">50</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">3475</span>.<span style="color:#ae81ff">555556</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">60</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">5760</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">70</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">10000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8955</span>.<span style="color:#ae81ff">882353</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">19333</span>.<span style="color:#ae81ff">333333</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8600</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">10150</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>          <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">6461</span>.<span style="color:#ae81ff">682243</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+--------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">最后这个是总的平均工资</span>, <span style="color:#960050;background-color:#1e0010">即</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#ae81ff">6461</span>.<span style="color:#ae81ff">682243</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">就是说</span>, <span style="color:#960050;background-color:#1e0010">有了</span> <span style="color:#66d9ef">WITH</span> <span style="color:#66d9ef">ROLLUP</span>, <span style="color:#960050;background-color:#1e0010">就会多出一行</span>, <span style="color:#960050;background-color:#1e0010">这一行是总的</span>.


</code></pre></div><h4 id="21-基本使用">2.1 基本使用</h4>
<h4 id="22-使用多个列分组">2.2 使用多个列分组</h4>
<h4 id="23-group-by-中使用-with-rollup">2.3 GROUP BY 中使用 WITH ROLLUP</h4>
<h3 id="3-having">3. HAVING</h3>
<h4 id="31-基本使用">3.1 基本使用</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询各个部门中最高工资比</span> <span style="color:#ae81ff">10000</span> <span style="color:#960050;background-color:#1e0010">高的部门信息</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MAX</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">11000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">80</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">14000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>           <span style="color:#ae81ff">100</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>           <span style="color:#ae81ff">110</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MAX</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#960050;background-color:#1e0010">用</span> <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">会报错</span>

</code></pre></div><ul>
<li>如果用了聚合函数, 就必须用 <code>HAVING</code>, 不能用 <code>WHERE</code></li>
<li>如果出现了 <code>HAVING</code>, 那么必须放在 <code>GROUP BY</code> 后面声明.</li>
<li><code>HAVING</code> 后面的条件是对分组后的结果进行过滤, 而 <code>WHERE</code> 后面的条件是对原始数据进行过滤.</li>
<li>开发中, 使用 <code>HAVING</code> 的前提是使用了 GROUP BY</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询部门</span> id <span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">30</span>,<span style="color:#ae81ff">40</span> <span style="color:#960050;background-color:#1e0010">这</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">个部门中最高工资比</span><span style="color:#ae81ff">10000</span><span style="color:#960050;background-color:#1e0010">高的部门信息</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MAX</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">40</span>)
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">11000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">另一种方式</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MAX</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>
<span style="color:#66d9ef">AND</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">30</span>, <span style="color:#ae81ff">40</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>            <span style="color:#ae81ff">20</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>            <span style="color:#ae81ff">30</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">11000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">这里会发现</span> <span style="color:#66d9ef">HAVING</span> <span style="color:#960050;background-color:#1e0010">里也能写普通的过滤条件</span>, <span style="color:#960050;background-color:#1e0010">推荐使用第一个方法</span>, <span style="color:#960050;background-color:#1e0010">因为第一个方法执行效率更高</span>.


</code></pre></div><ul>
<li>当过滤条件中有聚合函数时, 此过滤条件必须声明在 <code>HAVING</code> 中</li>
<li>当过滤条件中没有聚合函数时, 则此过滤条件声明在 <code>WHERE</code> 或 <code>HAVING</code> 中都是可以的, 但是建议声明在 WHERE 里.</li>
</ul>
<h4 id="32-where-和-having-的区别">3.2 WHERE 和 HAVING 的区别</h4>
<ol>
<li>适用范围上来说, HAVING 的使用范围更广, 有聚合函数的时候, 只能使用 <code>HAVING</code></li>
<li>如果过滤条件中没有聚合函数: 这种情况下使用 <code>WHERE</code>, 因为 <code>WHERE</code> 的执行效率比 <code>HAVING</code> 高.</li>
</ol>
<h3 id="4-select-的执行过程">4. SELECT 的执行过程</h3>
<h4 id="41-查询的结构">4.1 查询的结构</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- sql92 的语法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> ..., ..., ...(<span style="color:#960050;background-color:#1e0010">假设存在聚合函数</span>)
<span style="color:#66d9ef">FROM</span> ..., ..., ...
<span style="color:#66d9ef">WHERE</span> ... <span style="color:#66d9ef">AND</span> ... (<span style="color:#960050;background-color:#1e0010">不包含聚合函数的过滤条件</span> <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#960050;background-color:#1e0010">多表的连接条件</span>)
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">HAVING</span> ... (<span style="color:#960050;background-color:#1e0010">包含聚合函数的过滤条件</span>)
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">LIMIT</span> ...

<span style="color:#75715e">-- sql99 的语法
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> ..., ..., ...(<span style="color:#960050;background-color:#1e0010">假设存在聚合函数</span>)
<span style="color:#66d9ef">FROM</span> ... (<span style="color:#66d9ef">LEFT</span><span style="color:#f92672">/</span><span style="color:#66d9ef">RIGHT</span>) <span style="color:#66d9ef">JOIN</span> ... 
<span style="color:#66d9ef">ON</span> ...
<span style="color:#66d9ef">WHERE</span> ... (<span style="color:#960050;background-color:#1e0010">不包含聚合函数的过滤条件</span>)
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">HAVING</span> ... (<span style="color:#960050;background-color:#1e0010">包含聚合函数的过滤条件</span>)
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">LIMIT</span> ...
</code></pre></div><h4 id="42-select-的执行顺序">4.2 SELECT 的执行顺序</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">第一步</span>:
<span style="color:#66d9ef">FROM</span> ... (<span style="color:#66d9ef">LEFT</span><span style="color:#f92672">/</span><span style="color:#66d9ef">RIGHT</span>) <span style="color:#66d9ef">JOIN</span> ... 
<span style="color:#66d9ef">ON</span> ...
<span style="color:#66d9ef">WHERE</span> ... (<span style="color:#960050;background-color:#1e0010">不包含聚合函数的过滤条件</span>)
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">HAVING</span> ... (<span style="color:#960050;background-color:#1e0010">包含聚合函数的过滤条件</span>)

<span style="color:#960050;background-color:#1e0010">第二步</span>:
<span style="color:#66d9ef">SELECT</span> ..., ..., ...(<span style="color:#960050;background-color:#1e0010">假设存在聚合函数</span>)

<span style="color:#960050;background-color:#1e0010">第三步</span>:
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> ...
<span style="color:#66d9ef">LIMIT</span> ...

<span style="color:#960050;background-color:#1e0010">每一步里是按顺序执行的</span>
<span style="color:#960050;background-color:#1e0010">中间的过程中会存在很多的虚拟表</span>

   <span style="color:#66d9ef">FROM</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">ON</span>
<span style="color:#f92672">-&gt;</span> (<span style="color:#66d9ef">LEFT</span><span style="color:#f92672">/</span><span style="color:#66d9ef">RIGHT</span>) <span style="color:#66d9ef">JOIN</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">WHERE</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">HAVING</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">SELECT</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">DISTINCT</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span>
<span style="color:#f92672">-&gt;</span> <span style="color:#66d9ef">LIMIT</span>
</code></pre></div><h4 id="43-sql-的执行原理">4.3 SQL 的执行原理</h4>
<h4 id="5-练习">5. 练习</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#66d9ef">WHERE</span> <span style="color:#960050;background-color:#1e0010">子句是否可以使用组函数进行过滤</span><span style="color:#f92672">?</span>
<span style="color:#960050;background-color:#1e0010">不可以</span>

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">查询公司员工工资的最大值</span>, <span style="color:#960050;background-color:#1e0010">最小值</span>, <span style="color:#960050;background-color:#1e0010">平均值</span>, <span style="color:#960050;background-color:#1e0010">总和</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(salary), <span style="color:#66d9ef">MIN</span>(salary), <span style="color:#66d9ef">AVG</span>(salary), <span style="color:#66d9ef">SUM</span>(salary)
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+-------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">2100</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">6461</span>.<span style="color:#ae81ff">682243</span> <span style="color:#f92672">|</span>   <span style="color:#ae81ff">691400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+-------------+-------------+
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">查询各</span> job_id <span style="color:#960050;background-color:#1e0010">的员工工资的最大值最小值</span>, <span style="color:#960050;background-color:#1e0010">平均值</span>, <span style="color:#960050;background-color:#1e0010">总和</span>
<span style="color:#66d9ef">SELECT</span> job_id, <span style="color:#66d9ef">MAX</span>(salary), <span style="color:#66d9ef">MIN</span>(salary), <span style="color:#66d9ef">AVG</span>(salary), <span style="color:#66d9ef">SUM</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id;
<span style="color:#f92672">+</span><span style="color:#75715e">------------+-------------+-------------+--------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> job_id     <span style="color:#f92672">|</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span> <span style="color:#66d9ef">SUM</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+-------------+-------------+--------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> AC_ACCOUNT <span style="color:#f92672">|</span>     <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AC_MGR     <span style="color:#f92672">|</span>    <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AD_ASST    <span style="color:#f92672">|</span>     <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AD_PRES    <span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>    <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>


<span style="color:#ae81ff">4</span>. <span style="color:#960050;background-color:#1e0010">选择具有各个</span>job_id <span style="color:#960050;background-color:#1e0010">的员工的人数</span>
<span style="color:#66d9ef">SELECT</span> job_id, <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id;
<span style="color:#f92672">+</span><span style="color:#75715e">------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> job_id     <span style="color:#f92672">|</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> AC_ACCOUNT <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AC_MGR     <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> AD_ASST    <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>

<span style="color:#ae81ff">5</span>. <span style="color:#960050;background-color:#1e0010">查询员工最高工资和最低工资的差距</span> DIFFERENCE
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(salary) <span style="color:#f92672">-</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#e6db74">&#34;DIFFERENCE&#34;</span>
<span style="color:#66d9ef">FROM</span> employees;
<span style="color:#f92672">+</span><span style="color:#75715e">------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> DIFFERENCE <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>   <span style="color:#ae81ff">21900</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">6</span>. <span style="color:#960050;background-color:#1e0010">查询各个管理者手下员工的最低工资</span>, <span style="color:#960050;background-color:#1e0010">其中最低工资不能低于</span><span style="color:#ae81ff">6000</span>, <span style="color:#960050;background-color:#1e0010">没有管理者的员工不计算在内</span>

<span style="color:#66d9ef">SELECT</span> manager_id, <span style="color:#66d9ef">MIN</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> manager_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">6000</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> manager_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------+-------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>        <span style="color:#ae81ff">102</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">9000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>        <span style="color:#ae81ff">108</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">6900</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>        <span style="color:#ae81ff">145</span> <span style="color:#f92672">|</span>     <span style="color:#ae81ff">7000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>

<span style="color:#ae81ff">7</span>. <span style="color:#960050;background-color:#1e0010">查询所有部门的名称</span>, location_id, <span style="color:#960050;background-color:#1e0010">员工的数量和平均工资</span>, <span style="color:#960050;background-color:#1e0010">并按平均工资降序排序</span>
<span style="color:#66d9ef">SELECT</span> department_name, location_id, <span style="color:#66d9ef">COUNT</span>(e.employee_id), IFNULL(<span style="color:#66d9ef">AVG</span>(salary), <span style="color:#ae81ff">0</span>) <span style="color:#e6db74">&#34;AVG(salary)&#34;</span>
<span style="color:#66d9ef">FROM</span> departments d <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> employees e
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_name, location_id
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------+-------------+----------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_name      <span style="color:#f92672">|</span> location_id <span style="color:#f92672">|</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">AVG</span>(salary)  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------+-------------+----------+--------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Executive            <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1700</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">19333</span>.<span style="color:#ae81ff">333333</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Accounting           <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1700</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">10150</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> <span style="color:#66d9ef">Public</span> Relations     <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2700</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">10000</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Marketing            <span style="color:#f92672">|</span>        <span style="color:#ae81ff">1800</span> <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">9500</span>.<span style="color:#ae81ff">000000</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Sales                <span style="color:#f92672">|</span>        <span style="color:#ae81ff">2500</span> <span style="color:#f92672">|</span>       <span style="color:#ae81ff">34</span> <span style="color:#f92672">|</span>  <span style="color:#ae81ff">8955</span>.<span style="color:#ae81ff">882353</span> <span style="color:#f92672">|</span>


<span style="color:#ae81ff">8</span>. <span style="color:#960050;background-color:#1e0010">查询每个工种</span>, <span style="color:#960050;background-color:#1e0010">每个部门的部门名</span>, <span style="color:#960050;background-color:#1e0010">工种名和最低工资</span>
<span style="color:#66d9ef">SELECT</span> d.department_name, j.job_title, <span style="color:#66d9ef">MIN</span>(e.salary)
<span style="color:#66d9ef">FROM</span> departments d <span style="color:#66d9ef">JOIN</span> employees e
<span style="color:#66d9ef">ON</span> d.department_id <span style="color:#f92672">=</span> e.department_id
<span style="color:#66d9ef">JOIN</span> jobs j
<span style="color:#66d9ef">ON</span> e.job_id <span style="color:#f92672">=</span> j.job_id
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> d.department_name, j.job_title;
<span style="color:#f92672">+</span><span style="color:#75715e">------------------+---------------------------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> department_name  <span style="color:#f92672">|</span> job_title                       <span style="color:#f92672">|</span> <span style="color:#66d9ef">MIN</span>(e.salary) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------+---------------------------------+---------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Accounting       <span style="color:#f92672">|</span> <span style="color:#66d9ef">Public</span> Accountant               <span style="color:#f92672">|</span>       <span style="color:#ae81ff">8300</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Accounting       <span style="color:#f92672">|</span> Accounting Manager              <span style="color:#f92672">|</span>      <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Administration   <span style="color:#f92672">|</span> Administration Assistant        <span style="color:#f92672">|</span>       <span style="color:#ae81ff">4400</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#960050;background-color:#1e0010">这题总觉得有些问题</span>, <span style="color:#960050;background-color:#1e0010">可能是我对题意理解有问题</span>
</code></pre></div><h2 id="9-子查询">9. 子查询</h2>
<p>子查询就是将查询语句嵌套在另一个查询语句内部的查询, MySQL 4.1 开始引入.</p>
<h3 id="1-需求分析与问题解决">1. 需求分析与问题解决</h3>
<h4 id="11-实际问题">1.1 实际问题</h4>
<p>问题: 谁比Abel 的工资高?<br>
诞生子问题: Abel 的工资是多少?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Abel&#39;</span>);

<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Russell   <span style="color:#f92672">|</span> <span style="color:#ae81ff">14000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Partners  <span style="color:#f92672">|</span> <span style="color:#ae81ff">13500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Errazuriz <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ozer      <span style="color:#f92672">|</span> <span style="color:#ae81ff">11500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Hartstein <span style="color:#f92672">|</span> <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Higgins   <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">不用子查询的方式</span>
<span style="color:#66d9ef">SELECT</span> e1.last_name, e1.salary
<span style="color:#66d9ef">FROM</span> employees e1, employees e2
<span style="color:#66d9ef">WHERE</span> e1.salary <span style="color:#f92672">&gt;</span> e2.salary
<span style="color:#66d9ef">AND</span> e2.last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Abel&#39;</span>;
<span style="color:#960050;background-color:#1e0010">算是不等值连接</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Kochhar   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> De Haan   <span style="color:#f92672">|</span> <span style="color:#ae81ff">17000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Greenberg <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Russell   <span style="color:#f92672">|</span> <span style="color:#ae81ff">14000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Partners  <span style="color:#f92672">|</span> <span style="color:#ae81ff">13500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Errazuriz <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Ozer      <span style="color:#f92672">|</span> <span style="color:#ae81ff">11500</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Hartstein <span style="color:#f92672">|</span> <span style="color:#ae81ff">13000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> Higgins   <span style="color:#f92672">|</span> <span style="color:#ae81ff">12000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+----------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">会发现结果是相同的</span>.

<span style="color:#960050;background-color:#1e0010">称呼</span>: <span style="color:#960050;background-color:#1e0010">外查询</span>, <span style="color:#960050;background-color:#1e0010">内查询</span>(<span style="color:#960050;background-color:#1e0010">都是相对的</span>)
</code></pre></div><h4 id="12-子查询的基本使用">1.2 子查询的基本使用</h4>
<ul>
<li>子查询(内查询)在主查询之前一次执行完成</li>
<li>子查询的结果被主(外)查询使用</li>
<li>注意事项
<ul>
<li>子查询要包含在括号内</li>
<li>将子查询放在比较条件的右侧</li>
<li>单行操作符对应单行子查询, 多行操作符对应多行子查询</li>
</ul>
</li>
</ul>
<h4 id="13-子查询的分类">1.3 子查询的分类</h4>
<p>内查询返回的结果的条目数:</p>
<ul>
<li>单行子查询: 返回的结果是一行一列</li>
<li>多行子查询: 返回的结果是多行多列</li>
</ul>
<p>内查询是否被执行多次:</p>
<ul>
<li>相关子查询</li>
<li>非相关子查询</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">相关子查询的需求</span>, <span style="color:#960050;background-color:#1e0010">子查询的返回每次返回的可能不一样</span>, <span style="color:#960050;background-color:#1e0010">需要根据外部的条件来确定</span>  

<span style="color:#960050;background-color:#1e0010">相关子查询</span>:  
<span style="color:#960050;background-color:#1e0010">查询工资大于本部门平均工资的员工信息</span>(<span style="color:#960050;background-color:#1e0010">子查询查出来的值要根据外部的部门</span>id来确定, <span style="color:#960050;background-color:#1e0010">因此是相关的</span>)


<span style="color:#960050;background-color:#1e0010">非相关子查询</span>:
<span style="color:#960050;background-color:#1e0010">查询工资大于公司平均工资的员工信息</span>(<span style="color:#960050;background-color:#1e0010">子查询查出来的都是一样的</span>, <span style="color:#960050;background-color:#1e0010">都是公司平均工资</span>, <span style="color:#960050;background-color:#1e0010">这个只用执行一次</span>.)
</code></pre></div><h3 id="2-单行子查询">2. 单行子查询</h3>
<h4 id="21-单行比较操作符">2.1 单行比较操作符</h4>
<ul>
<li>等于: =</li>
<li>不等于: !=, &lt;&gt;</li>
<li>大于: &gt;</li>
<li>小于: &lt;</li>
<li>大于等于: &gt;=</li>
<li>小于等于: &lt;=</li>
</ul>
<h4 id="22-代码示例">2.2 代码示例</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询工资大于</span> <span style="color:#ae81ff">149</span><span style="color:#960050;background-color:#1e0010">号员工工资的员工的信息、</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">149</span>);

<span style="color:#960050;background-color:#1e0010">可以从外往里写</span>, <span style="color:#960050;background-color:#1e0010">也可以从里往外写</span>.



<span style="color:#960050;background-color:#1e0010">返回</span> job_id <span style="color:#960050;background-color:#1e0010">与</span> <span style="color:#ae81ff">141</span> <span style="color:#960050;background-color:#1e0010">号员工相同</span>, salary <span style="color:#960050;background-color:#1e0010">比</span> <span style="color:#ae81ff">143</span> <span style="color:#960050;background-color:#1e0010">号员工多的员工信息</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, job_id, salary, job_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> job_id
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">141</span>)
      <span style="color:#66d9ef">AND</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">143</span>);


<span style="color:#960050;background-color:#1e0010">返回公司工资最少的员工的</span> last_name, job_id <span style="color:#960050;background-color:#1e0010">和</span> salary
<span style="color:#66d9ef">SELECT</span> last_name, job_id, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees);



<span style="color:#960050;background-color:#1e0010">查询与</span> <span style="color:#ae81ff">141</span> <span style="color:#960050;background-color:#1e0010">号员工的</span> manager_id <span style="color:#960050;background-color:#1e0010">和</span> department_id <span style="color:#960050;background-color:#1e0010">相同的其他员工</span>
<span style="color:#960050;background-color:#1e0010">用了成对比较的方法</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, manager_id, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> (manager_id, department_id) <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> manager_id, department_id
                                      <span style="color:#66d9ef">FROM</span> employees
                                      <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">141</span>)
      <span style="color:#66d9ef">AND</span> employee_id <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">141</span>);

</code></pre></div><h4 id="23-having-中的子查询">2.3 HAVING 中的子查询</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询最低工资大于</span><span style="color:#ae81ff">50</span><span style="color:#960050;background-color:#1e0010">号部门最低工资的部门</span>id <span style="color:#960050;background-color:#1e0010">和其最低工资</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MIN</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">MIN</span>(salary) <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">50</span>);

</code></pre></div><h4 id="24-case-中的子查询">2.4 CASE 中的子查询</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">显示员工的</span>employee_id, last_name, job_id <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#66d9ef">location</span>, <span style="color:#960050;background-color:#1e0010">其中若员工的</span> department_id <span style="color:#960050;background-color:#1e0010">与</span> location_id为1800的department_id相同, <span style="color:#960050;background-color:#1e0010">则</span> <span style="color:#66d9ef">location</span> <span style="color:#960050;background-color:#1e0010">为</span> <span style="color:#e6db74">&#39;Canada&#39;</span>, <span style="color:#960050;background-color:#1e0010">其余为</span> <span style="color:#e6db74">&#39;USA&#39;</span>
<span style="color:#66d9ef">SELECT</span> e.employee_id, e.last_name, e.job_id, 
       <span style="color:#66d9ef">CASE</span> <span style="color:#66d9ef">WHEN</span> e.department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                                    <span style="color:#66d9ef">FROM</span> departments
                                    <span style="color:#66d9ef">WHERE</span> location_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1800</span>)
            <span style="color:#66d9ef">THEN</span> <span style="color:#e6db74">&#39;Canada&#39;</span>
            <span style="color:#66d9ef">ELSE</span> <span style="color:#e6db74">&#39;USA&#39;</span> <span style="color:#66d9ef">END</span> <span style="color:#e6db74">&#34;location&#34;</span>
<span style="color:#66d9ef">FROM</span> employees e;
</code></pre></div><h4 id="25-子查询中的空值问题">2.5 子查询中的空值问题</h4>
<p>有时候子查询不返回任何结果, 这时候就会返回 NULL</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> last_name, job_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> salary
                <span style="color:#66d9ef">FROM</span> employees
                <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;hans&#39;</span>);
<span style="color:#960050;background-color:#1e0010">其实也还好</span>, <span style="color:#960050;background-color:#1e0010">就是空的</span>
</code></pre></div><h4 id="26-非法使用子查询">2.6 非法使用子查询</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">有时候回返回多行</span>, <span style="color:#960050;background-color:#1e0010">但是等号又是单行操作符</span>, <span style="color:#960050;background-color:#1e0010">这时候就会报错</span>
</code></pre></div><h3 id="3-多行子查询">3. 多行子查询</h3>
<h4 id="31-多行比较操作符">3.1 多行比较操作符</h4>
<ul>
<li>内查询返回的结果是多行的</li>
<li>使用多行比较操作符</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">IN</span>: <span style="color:#960050;background-color:#1e0010">等于列表中的任意一个值</span>
<span style="color:#66d9ef">ANY</span>: <span style="color:#960050;background-color:#1e0010">需要和单行比较操作符一起使用</span>, <span style="color:#960050;background-color:#1e0010">和子查询返回的某一个值进行比较</span>
<span style="color:#66d9ef">ALL</span>: <span style="color:#960050;background-color:#1e0010">需要和单行比较操作符一起使用</span>, <span style="color:#960050;background-color:#1e0010">和子查询返回的所有值比较</span>
<span style="color:#66d9ef">SOME</span>: <span style="color:#960050;background-color:#1e0010">实际上是</span> <span style="color:#66d9ef">ANY</span> <span style="color:#960050;background-color:#1e0010">的别名</span>, <span style="color:#960050;background-color:#1e0010">作用相同</span>
</code></pre></div><h4 id="32-代码示例">3.2 代码示例</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询各个部门的最低工资的员工是哪一位</span>
<span style="color:#66d9ef">SELECT</span> last_name, department_id, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> (department_id, salary) <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">MIN</span>(salary)
                                  <span style="color:#66d9ef">FROM</span> employees
                                  <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id);



<span style="color:#66d9ef">ANY</span>: <span style="color:#960050;background-color:#1e0010">意思是存在一个就可以</span>
<span style="color:#960050;background-color:#1e0010">返回其他</span> job_id <span style="color:#960050;background-color:#1e0010">比</span> job_id <span style="color:#960050;background-color:#1e0010">为</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span> <span style="color:#960050;background-color:#1e0010">部门任一工资低的员工的员工号、姓名、</span>job_id <span style="color:#960050;background-color:#1e0010">以及</span> salary
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, job_id, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>
<span style="color:#66d9ef">AND</span> salary <span style="color:#f92672">&lt;</span> <span style="color:#66d9ef">ANY</span> (<span style="color:#66d9ef">SELECT</span> salary
                  <span style="color:#66d9ef">FROM</span> employees
                  <span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;IT_PROG&#39;</span>);



<span style="color:#960050;background-color:#1e0010">查询平均工资最低的部门</span>id
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary), department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                      <span style="color:#66d9ef">FROM</span> employees
                      <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                      <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary)
                      <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);

MySQL <span style="color:#960050;background-color:#1e0010">中聚合函数不能嵌套</span>, <span style="color:#960050;background-color:#1e0010">不然直接</span> <span style="color:#66d9ef">MIN</span>(<span style="color:#66d9ef">AVG</span>(salary)), <span style="color:#960050;background-color:#1e0010">排序不用也行</span>, <span style="color:#960050;background-color:#1e0010">改成</span><span style="color:#f92672">&lt;=</span><span style="color:#66d9ef">ALL</span>, <span style="color:#960050;background-color:#1e0010">那么自己就是最小的</span>.

<span style="color:#960050;background-color:#1e0010">或者</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(t.avg_sal)
<span style="color:#66d9ef">FROM</span> (
  <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary) avg_sal, department_id
  <span style="color:#66d9ef">FROM</span> employees
  <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
) t;
</code></pre></div><h4 id="33-空值问题">3.3 空值问题</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#34;1&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#34;1&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                                 <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#e6db74">&#34;1&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                           <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#34;1&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span>, <span style="color:#66d9ef">NULL</span>, <span style="color:#e6db74">&#34;1&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                               <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------------------------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> , <span style="color:#e6db74">&#34;1&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">IN</span> (<span style="color:#e6db74">&#34;a&#34;</span>, <span style="color:#e6db74">&#34;b&#34;</span>, <span style="color:#e6db74">&#34;c&#34;</span> , <span style="color:#e6db74">&#34;1&#34;</span>) <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>                          <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------------------------+
</span></code></pre></div><h3 id="4-相关子查询">4. 相关子查询</h3>
<h4 id="41-相关子查询执行流程">4.1 相关子查询执行流程</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">相关子查询</span>
<span style="color:#66d9ef">SELECT</span> col1, col2, ...
<span style="color:#66d9ef">FROM</span> table1 <span style="color:#66d9ef">outer</span>
<span style="color:#66d9ef">WHERE</span> col1 op (<span style="color:#66d9ef">SELECT</span> col1
               <span style="color:#66d9ef">FROM</span> table2
               <span style="color:#66d9ef">WHERE</span> expr1 <span style="color:#f92672">=</span> <span style="color:#66d9ef">outer</span>.expr2);

<span style="color:#960050;background-color:#1e0010">这里体现相关性的就是子查询的条件是根据外部表的信息的</span> <span style="color:#66d9ef">outer</span>.expr2
</code></pre></div><h4 id="42-代码示例">4.2 代码示例</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查询员工中工资大于本部门平均工资的员工的</span> last_name, salary <span style="color:#960050;background-color:#1e0010">和</span> department_id
<span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees e2
                <span style="color:#66d9ef">WHERE</span> e1.department_id <span style="color:#f92672">=</span> e2.department_id);
<span style="color:#75715e">-- 38 rows
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">另一种写法</span>: <span style="color:#960050;background-color:#1e0010">在</span> <span style="color:#66d9ef">FROM</span> <span style="color:#960050;background-color:#1e0010">里写子查询</span>
<span style="color:#66d9ef">SELECT</span> last_name, salary, e1.department_id
<span style="color:#66d9ef">FROM</span> employees e1, (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary) avg_sal, department_id
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id) t
<span style="color:#66d9ef">WHERE</span> e1.department_id <span style="color:#f92672">=</span> t.department_id
<span style="color:#66d9ef">AND</span> e1.salary <span style="color:#f92672">&gt;</span> t.avg_sal;
<span style="color:#75715e">-- 38 rows
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">相当于是先得到每个部门的平均工资表</span>, <span style="color:#960050;background-color:#1e0010">然后再和员工表进行连接</span>, <span style="color:#960050;background-color:#1e0010">这样就不用每次都计算一次平均工资了</span>.
avg_sal <span style="color:#960050;background-color:#1e0010">别名是必要的</span>, <span style="color:#960050;background-color:#1e0010">因为要和外部的</span> salary <span style="color:#960050;background-color:#1e0010">进行比较</span>

<span style="color:#960050;background-color:#1e0010">如果是大于本公司的平均工资</span>
<span style="color:#66d9ef">SELECT</span> last_name, salary, department_id
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees);



<span style="color:#960050;background-color:#1e0010">查询员工的</span> id, salary <span style="color:#960050;background-color:#1e0010">按照</span> department_name <span style="color:#960050;background-color:#1e0010">排序</span>
<span style="color:#66d9ef">SELECT</span> employee_id, salary
<span style="color:#66d9ef">FROM</span>  employees e1
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> (<span style="color:#66d9ef">SELECT</span> department_name
          <span style="color:#66d9ef">FROM</span> departments d
          <span style="color:#66d9ef">WHERE</span> e1.department_id <span style="color:#f92672">=</span> d.department_id);
</code></pre></div><ul>
<li>SELECT 查询中, 除了 GROUP BY 和 LIMIT 都可以写子查询</li>
</ul>
<h4 id="43-exists-和-not-exists-关键字">4.3 EXISTS 和 NOT EXISTS 关键字</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">
<span style="color:#960050;background-color:#1e0010">查询公司管理者的</span> employee_id, last_name, job_id, department_id <span style="color:#960050;background-color:#1e0010">信息</span>
<span style="color:#66d9ef">SELECT</span> mgr.employee_id, mgr.last_name, mgr.job_id, mgr.department_id
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> employees mgr
<span style="color:#66d9ef">ON</span> e.manager_id <span style="color:#f92672">=</span> mgr.employee_id;
<span style="color:#960050;background-color:#1e0010">这样会查出来</span><span style="color:#ae81ff">106</span><span style="color:#960050;background-color:#1e0010">条</span>, <span style="color:#960050;background-color:#1e0010">会有很多重复的信息</span>
<span style="color:#960050;background-color:#1e0010">因此要加上</span> <span style="color:#66d9ef">DISTINCT</span> <span style="color:#960050;background-color:#1e0010">关键字去重</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> mgr.employee_id, mgr.last_name, mgr.job_id, mgr.department_id
<span style="color:#66d9ef">FROM</span> employees e <span style="color:#66d9ef">JOIN</span> employees mgr
<span style="color:#66d9ef">ON</span> e.manager_id <span style="color:#f92672">=</span> mgr.employee_id;
<span style="color:#960050;background-color:#1e0010">这样剩下</span> <span style="color:#ae81ff">18</span> <span style="color:#960050;background-color:#1e0010">条</span>, <span style="color:#960050;background-color:#1e0010">去重了</span>


<span style="color:#960050;background-color:#1e0010">使用子查询的方式</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, job_id, department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> manager_id
                      <span style="color:#66d9ef">FROM</span> employees);
<span style="color:#960050;background-color:#1e0010">这样直接就是</span><span style="color:#ae81ff">18</span> <span style="color:#960050;background-color:#1e0010">条了</span>, <span style="color:#960050;background-color:#1e0010">因为外查询只会遍历一遍</span> eployees <span style="color:#960050;background-color:#1e0010">表</span>, <span style="color:#960050;background-color:#1e0010">因此不会产生重复的情况</span>.

<span style="color:#960050;background-color:#1e0010">使用</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#960050;background-color:#1e0010">的方式</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, job_id, department_id
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">EXISTS</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span>
              <span style="color:#66d9ef">FROM</span> employees e2
              <span style="color:#66d9ef">WHERE</span> e1.employee_id <span style="color:#f92672">=</span> e2.manager_id);
<span style="color:#960050;background-color:#1e0010">这里</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">是因为查到的内容不重要</span>, <span style="color:#960050;background-color:#1e0010">重要的是是否存在</span>, <span style="color:#960050;background-color:#1e0010">因此</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">就可以了</span>. <span style="color:#960050;background-color:#1e0010">或者</span> <span style="color:#f92672">*</span>

<span style="color:#960050;background-color:#1e0010">查询</span> departments <span style="color:#960050;background-color:#1e0010">表中</span>, <span style="color:#960050;background-color:#1e0010">不存在于</span> employees <span style="color:#960050;background-color:#1e0010">表中的部门的</span> department_id <span style="color:#960050;background-color:#1e0010">和</span> department_name

<span style="color:#66d9ef">SELECT</span> d.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> departments d
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#ae81ff">1</span>
                  <span style="color:#66d9ef">FROM</span> employees
                  <span style="color:#66d9ef">WHERE</span> d.department_id <span style="color:#f92672">=</span> employees.department_id);
<span style="color:#ae81ff">16</span> <span style="color:#66d9ef">rows</span>
<span style="color:#960050;background-color:#1e0010">相当于查出来这几个部门是没有人的</span>
<span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#960050;background-color:#1e0010">其实不算一个关键字</span>, <span style="color:#960050;background-color:#1e0010">而是</span> <span style="color:#66d9ef">NOT</span> <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#66d9ef">EXISTS</span> <span style="color:#960050;background-color:#1e0010">的组合</span>


</code></pre></div><h4 id="44-相关更新和删除">4.4 相关更新和删除</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">在</span> employees <span style="color:#960050;background-color:#1e0010">表中增加一个</span> department_name <span style="color:#960050;background-color:#1e0010">字段</span>, <span style="color:#960050;background-color:#1e0010">并将每个员工的部门名称更新到该字段中</span>

<span style="color:#960050;background-color:#1e0010">删除</span> employees <span style="color:#960050;background-color:#1e0010">表中所有于</span> emp_history <span style="color:#960050;background-color:#1e0010">表中相同的记录</span>
</code></pre></div><h3 id="5-思考">5. 思考</h3>
<p>我们一开始的问题是: 谁比Abel 的工资高?</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">我们可用的方法有两种</span>: <span style="color:#960050;background-color:#1e0010">自连接</span> <span style="color:#960050;background-color:#1e0010">和</span> <span style="color:#960050;background-color:#1e0010">子查询</span>
<span style="color:#960050;background-color:#1e0010">那么有一个问题</span>, <span style="color:#960050;background-color:#1e0010">哪一种方法更好呢</span><span style="color:#f92672">?</span>

<span style="color:#960050;background-color:#1e0010">自连接的方法更好</span>, <span style="color:#960050;background-color:#1e0010">因为大部分</span> DBMS <span style="color:#960050;background-color:#1e0010">优化器会将自连接转换为内连接</span>, <span style="color:#960050;background-color:#1e0010">而内连接的效率要高于子查询</span>.
</code></pre></div><h3 id="6-子查询练习">6. 子查询练习</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">查询和</span> Zlotkey <span style="color:#960050;background-color:#1e0010">相同部门的员工的员工姓名和工资（会不会有重名的）</span>
<span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                       <span style="color:#66d9ef">FROM</span> employees
                       <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Zlotkey&#39;</span>);

<span style="color:#960050;background-color:#1e0010">如果有重名的就用</span>  <span style="color:#66d9ef">IN</span> <span style="color:#960050;background-color:#1e0010">而不用等号</span>.

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">查询工资比公司平均工资高的员工的员工号、姓名和工资</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees);

<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">选择工资大于所有</span> JOB_ID<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;SA_MAN&#34;</span> <span style="color:#960050;background-color:#1e0010">的员工的工资的员工的</span>last_name, job_id <span style="color:#960050;background-color:#1e0010">和</span> salary
<span style="color:#66d9ef">SELECT</span> last_name, job_id, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#66d9ef">ALL</span> (<span style="color:#66d9ef">SELECT</span> salary
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SA_MAN&#34;</span>);
<span style="color:#75715e">-- 3 rows
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">或者</span>

<span style="color:#66d9ef">SELECT</span> last_name, job_id, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span>  (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MAX</span>(salary)
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SA_MAN&#34;</span>);
<span style="color:#75715e">-- 这种也可以
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">4</span>. <span style="color:#960050;background-color:#1e0010">查询姓名中包含字母</span>u <span style="color:#960050;background-color:#1e0010">的员工在相同部门的员工的员工号和姓名</span>
<span style="color:#66d9ef">SELECT</span> e1.employee_id, e1.last_name
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> e1.department_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> department_id
                         <span style="color:#66d9ef">FROM</span> employees e2
                         <span style="color:#66d9ef">WHERE</span> e2.last_name <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#34;%u%&#34;</span>);


<span style="color:#ae81ff">5</span>. <span style="color:#960050;background-color:#1e0010">查询在部门的</span>location_id为1700的部门工作的员工的员工号
<span style="color:#66d9ef">SELECT</span> employee_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (
  <span style="color:#66d9ef">SELECT</span> department_id  
  <span style="color:#66d9ef">FROM</span> departments
  <span style="color:#66d9ef">WHERE</span> location_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1700</span>
);

<span style="color:#ae81ff">6</span>. <span style="color:#960050;background-color:#1e0010">查询管理者是</span> KING <span style="color:#960050;background-color:#1e0010">的员工姓名和工资</span>
<span style="color:#66d9ef">SELECT</span> e1.last_name, e1.salary
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> employee_id
                    <span style="color:#66d9ef">FROM</span> employees e2
                    <span style="color:#66d9ef">WHERE</span> e2.last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;KING&#39;</span>);

<span style="color:#960050;background-color:#1e0010">有重名捏</span>, <span style="color:#960050;background-color:#1e0010">用</span> <span style="color:#66d9ef">IN</span>

<span style="color:#ae81ff">7</span>. <span style="color:#960050;background-color:#1e0010">查询工资最低的员工信息</span>: last_name, salary
<span style="color:#66d9ef">SELECT</span> last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees);


<span style="color:#ae81ff">8</span>. <span style="color:#960050;background-color:#1e0010">查询平均工资最低的部门的信息</span>
<span style="color:#66d9ef">SELECT</span> d.<span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> departments d
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                       <span style="color:#66d9ef">FROM</span> employees
                       <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                       <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary)
                       <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);

<span style="color:#960050;background-color:#1e0010">或者</span>

<span style="color:#66d9ef">SELECT</span> d.<span style="color:#f92672">*</span>, (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> d.department_id) avg_sal
<span style="color:#66d9ef">FROM</span> departments d, (
    <span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary) avg_sal
    <span style="color:#66d9ef">FROM</span> employees
    <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
    <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> avg_sal <span style="color:#66d9ef">ASC</span>
    <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>
  ) t_department
<span style="color:#66d9ef">WHERE</span> d.department_id <span style="color:#f92672">=</span> t_department.department_id;

<span style="color:#960050;background-color:#1e0010">感觉没我的好</span>, <span style="color:#960050;background-color:#1e0010">下面这个是老师写的</span>

<span style="color:#ae81ff">9</span>. <span style="color:#960050;background-color:#1e0010">查询平均工资最低的部门信息和该部门的平均工资</span>
<span style="color:#66d9ef">SELECT</span> d.<span style="color:#f92672">*</span>, (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">FROM</span> employees <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> d.department_id) avg_sal
<span style="color:#66d9ef">FROM</span> departments d
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                       <span style="color:#66d9ef">FROM</span> employees
                       <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                       <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary)
                       <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);


<span style="color:#ae81ff">10</span>. <span style="color:#960050;background-color:#1e0010">查询平均工资对高的</span> job <span style="color:#960050;background-color:#1e0010">信息</span>
<span style="color:#66d9ef">SELECT</span> j.<span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> jobs j
<span style="color:#66d9ef">WHERE</span> j.job_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> job_id
                 <span style="color:#66d9ef">FROM</span> employees
                 <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> job_id
                 <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>
                 <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);

<span style="color:#ae81ff">11</span>. <span style="color:#960050;background-color:#1e0010">查询平均工资高于公司平均工资的部门有哪些</span><span style="color:#f92672">?</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> employees 
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                      <span style="color:#66d9ef">FROM</span> employees);

<span style="color:#ae81ff">12</span>. <span style="color:#960050;background-color:#1e0010">查询公司所有</span> manager <span style="color:#960050;background-color:#1e0010">的详细信息</span>
<span style="color:#66d9ef">SELECT</span> mgr.<span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> employees mgr
<span style="color:#66d9ef">WHERE</span> mgr.employee_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> manager_id
                          <span style="color:#66d9ef">FROM</span> employees);

<span style="color:#960050;background-color:#1e0010">能用</span> <span style="color:#66d9ef">IN</span> <span style="color:#960050;background-color:#1e0010">的时候通常都能改写成</span> <span style="color:#66d9ef">EXISTS</span>

<span style="color:#ae81ff">13</span>. <span style="color:#960050;background-color:#1e0010">各个部门中</span>, <span style="color:#960050;background-color:#1e0010">最高工资中最低的那个部门的最低工资是多少？</span>

<span style="color:#75715e">-- 这样子查询找到了最高工资中最低的那个部门
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">MIN</span>(salary)
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">HAVING</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                        <span style="color:#66d9ef">FROM</span> employees
                        <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                        <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">MAX</span>(salary)
                        <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);


<span style="color:#ae81ff">14</span>. <span style="color:#960050;background-color:#1e0010">查询平均工资最高的部门的</span> manager <span style="color:#960050;background-color:#1e0010">的详细信息</span>: last_name, department_id, email, salary

<span style="color:#75715e">-- 平均工资最高的部门
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> department_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
<span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>;

<span style="color:#66d9ef">SELECT</span> manager_id
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                       <span style="color:#66d9ef">FROM</span> employees
                       <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                       <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>
                       <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>);

<span style="color:#66d9ef">SELECT</span> last_name, department_id, email, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> manager_id
                     <span style="color:#66d9ef">FROM</span> employees
                     <span style="color:#66d9ef">WHERE</span> department_id <span style="color:#f92672">=</span> (<span style="color:#66d9ef">SELECT</span> department_id
                                            <span style="color:#66d9ef">FROM</span> employees
                                            <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                                            <span style="color:#66d9ef">ORDER</span> <span style="color:#66d9ef">BY</span> <span style="color:#66d9ef">AVG</span>(salary) <span style="color:#66d9ef">DESC</span>
                                            <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span>));

<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------------+-------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> email <span style="color:#f92672">|</span> salary   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------------+-------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> King      <span style="color:#f92672">|</span>            <span style="color:#ae81ff">90</span> <span style="color:#f92672">|</span> SKING <span style="color:#f92672">|</span> <span style="color:#ae81ff">24000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+---------------+-------+----------+
</span><span style="color:#75715e"></span>
<span style="color:#ae81ff">15</span>. <span style="color:#960050;background-color:#1e0010">查询部门的部门号</span>, <span style="color:#960050;background-color:#1e0010">其中不包括</span>job_id <span style="color:#960050;background-color:#1e0010">是</span> ST_CLERK <span style="color:#960050;background-color:#1e0010">的员工的部门</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> department_id
<span style="color:#66d9ef">FROM</span> departments
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> department_id
                            <span style="color:#66d9ef">FROM</span> employees
                            <span style="color:#66d9ef">WHERE</span> job_id <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;ST_CLERK&#39;</span>);


<span style="color:#ae81ff">16</span>. <span style="color:#960050;background-color:#1e0010">选择所有没有管理者的员工的</span>last_name

<span style="color:#66d9ef">SELECT</span> last_name
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NULL</span>;
<span style="color:#960050;background-color:#1e0010">这个可以不用子查询</span>


<span style="color:#ae81ff">17</span>. <span style="color:#960050;background-color:#1e0010">查询员工号、姓名、雇佣时间、工资，其中员工的管理者为</span> <span style="color:#e6db74">&#34;De Haan&#34;</span>

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, hire_date, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> manager_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> employee_id
                    <span style="color:#66d9ef">FROM</span> employees
                    <span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;De Haan&#39;</span>);

<span style="color:#960050;background-color:#1e0010">感觉子查询的不是指定主键的值作为条件或者</span> <span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">1</span> <span style="color:#960050;background-color:#1e0010">了以外最好都用</span> <span style="color:#66d9ef">EXISTS</span>

<span style="color:#ae81ff">18</span>. <span style="color:#960050;background-color:#1e0010">查询各部门中工资比本部门平均工资高的员工的员工号</span>, <span style="color:#960050;background-color:#1e0010">姓名和工资</span>

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees e1
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> (<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">AVG</span>(salary)
                <span style="color:#66d9ef">FROM</span> employees e2
                <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                <span style="color:#66d9ef">HAVING</span> e1.department_id <span style="color:#f92672">=</span> e2.department_id);

<span style="color:#ae81ff">19</span>. <span style="color:#960050;background-color:#1e0010">查询每个部门下的部门人数大于</span><span style="color:#ae81ff">5</span><span style="color:#960050;background-color:#1e0010">的部门名称</span>

<span style="color:#66d9ef">SELECT</span> department_name
<span style="color:#66d9ef">FROM</span> departments
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#66d9ef">SELECT</span> department_id
                        <span style="color:#66d9ef">FROM</span> employees
                        <span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id
                        <span style="color:#66d9ef">HAVING</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>) <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">5</span>);

<span style="color:#ae81ff">20</span>. <span style="color:#960050;background-color:#1e0010">查询每个国家下的部门个数大于</span> <span style="color:#ae81ff">2</span> <span style="color:#960050;background-color:#1e0010">的国家编号</span>

<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DISTINCT</span> l.country_id
<span style="color:#66d9ef">FROM</span> locations l
<span style="color:#66d9ef">WHERE</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">&lt;</span> (
  <span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">COUNT</span>(<span style="color:#f92672">*</span>)
  <span style="color:#66d9ef">FROM</span> departments d
  <span style="color:#66d9ef">WHERE</span> l.location_id <span style="color:#f92672">=</span> d.location_id
);

</code></pre></div><h2 id="10-创建和管理表">10. 创建和管理表</h2>
<p>DDL</p>
<h3 id="1-基础知识">1. 基础知识</h3>
<h4 id="11-一条数据存储的过程">1.1 一条数据存储的过程</h4>
<ol>
<li>创建数据库</li>
<li>确认字段</li>
<li>创建数据表</li>
<li>插入数据</li>
</ol>
<h4 id="12-标识符命名规则">1.2 标识符命名规则</h4>
<ul>
<li>数据库名、表名不得超过30个字符, 变量名限制为29个</li>
<li>必须只能包含A-Z、a-z、0-9、_、共63个字符</li>
<li>数据库名、表明、字段名等对象名中间不包含空格</li>
<li>同一个MySQL 软件中, 数据库不能重名, 同一个库中, 表不能重名, 同一表中, 字段不能重名.</li>
<li>必须保证你的字段没有和保留字、数据库系统或常用方法冲突. 如果坚持使用, 请在SQL语句中使用 ` 符号包裹</li>
<li>保持字段名和类型的一致性: 在明明字段并为其指定数据类型的时候一定要保证一致性, 加入数据类型在一个表里是整数, 在另一个表里也最好是整数</li>
</ul>
<h4 id="13-mysql-中的数据类型">1.3 MySQL 中的数据类型</h4>
<table>
<thead>
<tr>
<th>类型</th>
<th>类型举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数</td>
<td>TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT, DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR, DATE, TIME, DATETIME, TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR, VARCHAR, TINYTEXT, TEXT, MEDIUMTEXT, LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY, VARBINARY, TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON对象, JSON数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值: GEOMETRY, POINT, LINESTRING, POLYGON, 集合: MULTIPOINT, MULTILINESTRING, MULTIPOLYGON, GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<h3 id="2-创建和管理数据库">2. 创建和管理数据库</h3>
<h4 id="21-创建数据库">2.1 创建数据库</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">1</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> db_name;

<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> db_name;
<span style="color:#f92672">+</span><span style="color:#75715e">----------+-----------------------------------------------------------------------------------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Database</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">Database</span>                                                                                                                   <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------+-----------------------------------------------------------------------------------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> db_name  <span style="color:#f92672">|</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#f92672">`</span>db_name<span style="color:#f92672">`</span> <span style="color:#75715e">/*!40100 DEFAULT CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci */</span> <span style="color:#75715e">/*!80016 DEFAULT ENCRYPTION=&#39;N&#39; */</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------+-----------------------------------------------------------------------------------------------------------------------------------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">得到默认信息</span>

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">2</span>: <span style="color:#960050;background-color:#1e0010">显式指定字符集</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> db_name2 CHARACTER <span style="color:#66d9ef">SET</span> utf8mb4;

<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">3</span>: 
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> db_name3;
<span style="color:#75715e">-- 保证了不报错
</span><span style="color:#75715e"></span>
</code></pre></div><h4 id="22-使用数据库">2.2 使用数据库</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">当前连接中的数据库都有哪些</span>
<span style="color:#66d9ef">SHOW</span> DATABASES;

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">切换</span>(<span style="color:#960050;background-color:#1e0010">使用</span>)<span style="color:#960050;background-color:#1e0010">数据库</span>
USE db_name;

<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">查看当前使用的数据库中的数据表</span>
<span style="color:#66d9ef">SHOW</span> TABLES;

<span style="color:#ae81ff">4</span>. <span style="color:#960050;background-color:#1e0010">查看当前使用的数据库</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#66d9ef">DATABASE</span>();

<span style="color:#ae81ff">5</span>. <span style="color:#960050;background-color:#1e0010">查看指定数据库下保存的数据表</span>
<span style="color:#66d9ef">SHOW</span> TABLES <span style="color:#66d9ef">FROM</span> db_name;
</code></pre></div><h4 id="23-修改数据库">2.3 修改数据库</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">修改数据库的字符集</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">DATABASE</span> db_name CHARACTER <span style="color:#66d9ef">SET</span> <span style="color:#960050;background-color:#1e0010">字符集</span>;
</code></pre></div><h4 id="24-删除数据库">2.4 删除数据库</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">1</span>:
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">DATABASE</span> db_name; 

<span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">2</span>:
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> db_name;
</code></pre></div><h3 id="3-创建表">3. 创建表</h3>
<h4 id="31-创建方式1">3.1 创建方式1</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">创建一个表</span>
<span style="color:#75715e">-- 需要用户具备创建表的权限
</span><span style="color:#75715e"></span><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span>  <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> mytable (
  id INT,
  emp_name VARCHAR(<span style="color:#ae81ff">20</span>),
  hire_date DATE
);

<span style="color:#960050;background-color:#1e0010">查看表结构</span>
<span style="color:#66d9ef">DESC</span> mytable;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field     <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name  <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">或者</span>
<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> mytable;
<span style="color:#f92672">+</span><span style="color:#75715e">---------+---------------------------------
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">Table</span>                 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+---------------------------------
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> mytable <span style="color:#f92672">|</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>mytable<span style="color:#f92672">`</span> (
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> int <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>emp_name<span style="color:#f92672">`</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>hire_date<span style="color:#f92672">`</span> date <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>
) ENGINE<span style="color:#f92672">=</span>InnoDB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8mb3 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------+--------------------------------
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">如果创建表时没有指明使用的字符集</span>, <span style="color:#960050;background-color:#1e0010">则默认使用表所在的数据库的字符集</span>

</code></pre></div><h4 id="32-创建方式2">3.2 创建方式2</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">基于现有的表创建新的表</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> mytable2 
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees;

<span style="color:#66d9ef">DESC</span> mytable2;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field       <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary      <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> mytable2;
<span style="color:#960050;background-color:#1e0010">这种方式创建的表是有数据的</span>. <span style="color:#960050;background-color:#1e0010">就是得到通过查询语句得到的</span>
</code></pre></div><h4 id="33-查看数据表结构">3.3 查看数据表结构</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DESC</span> mytable2;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field       <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary      <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span></code></pre></div><h3 id="4-修改表">4. 修改表</h3>
<h4 id="41-追加一个列">4.1 追加一个列</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">增加一个字段</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">COLUMN</span>
phone VARCHAR(<span style="color:#ae81ff">20</span>);

<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable
<span style="color:#66d9ef">ADD</span> salary DOUBLE(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">AFTER</span> id;
<span style="color:#66d9ef">AFTER</span> <span style="color:#960050;background-color:#1e0010">的意思是在哪个字段后面</span>, <span style="color:#960050;background-color:#1e0010">不然就添加到表的最后面了</span>.
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field     <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary    <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name  <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> phone     <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">还有一个是</span> <span style="color:#66d9ef">FIRST</span>, <span style="color:#960050;background-color:#1e0010">就是在第一个字段的前面</span>
</code></pre></div><h4 id="42-修改一个列">4.2 修改一个列</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">修改列的数据类型之类的</span>, <span style="color:#960050;background-color:#1e0010">一般不改</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable
<span style="color:#66d9ef">MODIFY</span> emp_name VARCHAR(<span style="color:#ae81ff">45</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#e6db74">&#39;unknown&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field     <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary    <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name  <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">45</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> phone     <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">修改了一下长度</span>. <span style="color:#960050;background-color:#1e0010">增加了默认值</span>

</code></pre></div><h4 id="43-重命名一个列">4.3 重命名一个列</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable
CHANGE <span style="color:#66d9ef">COLUMN</span> phone phone_number VARCHAR(<span style="color:#ae81ff">20</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id           <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary       <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name     <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">45</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date    <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> phone_number <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span></code></pre></div><h4 id="44-删除一个列">4.4 删除一个列</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">COLUMN</span> phone_number;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field     <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary    <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name  <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">45</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span></code></pre></div><h3 id="5-重命名表">5. 重命名表</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">1</span>:
<span style="color:#66d9ef">RENAME</span> <span style="color:#66d9ef">TABLE</span> mytable <span style="color:#66d9ef">TO</span> mytable_new;

<span style="color:#960050;background-color:#1e0010">我又改回来啦</span>
<span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">2</span>:
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> mytable_new
<span style="color:#66d9ef">RENAME</span> <span style="color:#66d9ef">TO</span> mytable;
</code></pre></div><h3 id="6-删除表">6. 删除表</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">无法恢复</span>, <span style="color:#960050;background-color:#1e0010">慎用</span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> mytable2;
</code></pre></div><h3 id="7-清空表">7. 清空表</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">只是清空数据</span>, <span style="color:#960050;background-color:#1e0010">表结构还在</span>
<span style="color:#66d9ef">TRUNCATE</span> <span style="color:#66d9ef">TABLE</span> mytable;
</code></pre></div><p>DCL 中的 COMMIT 和 ROLLBACK</p>
<ul>
<li>COMMIT: 提交数据, 一旦执行 COMMIT, 则数据就被永久的保存在了数据库, 意味着数据不可以回滚</li>
<li>ROLLBACK: 回滚数据, 一旦执行 ROLLBACK, 则数据就被回滚到上一次 COMMIT 之后的状态</li>
</ul>
<p>对比 TRUNCATE TABLE 和 DELETE FROM</p>
<ul>
<li>
<p>相同点: 都可以实现对表中的所有数据的删除, 同时保留表结构</p>
</li>
<li>
<p>不同点:</p>
<ul>
<li>TRUNCATE TABLE 是清空表数据. 同时数据无法回滚</li>
<li>DELETE FROM 是删除表中的数据, 同时数据可以回滚, 可以只删除部分数据</li>
</ul>
</li>
<li>
<p>DDL 的操作一旦执行, 就无法回滚, 因为 DDL 操作结束后一定会自动执行一次 COMMIT, 而此COMMIT 操作不受<code>SET autocommit = false</code> 影响</p>
</li>
<li>
<p>DML 的操作在默认情况下是无法回滚的, 但是可以通过设置事务的方式来实现回滚, 设置 <code>SET autocommit = false</code>, 则执行的 DML 操作就可以实现回滚, 想要回滚的时候执行 ROLLBACK</p>
</li>
</ul>
<h3 id="8-内容拓展">8. 内容拓展</h3>
<ul>
<li>
<p>阿里巴巴规范: TRUNCATE TABLE 比 DELETE 速度快, 且使用的系统和事务日志资源少, 但 TRUNCATE 无事务且不触发 TRIGGER, 有可能造成事故, 因此不建议在开发代码中使用这个语句</p>
</li>
<li>
<p>TRUNCATE TABLE 在功能上与不带 WHERE 子句的 DELETE 语句相同.</p>
</li>
<li>
<p>[强制] 表明、字段名必须使用小写字母或数字, 禁止出现数字开头, 禁止两个下划线中间只出现数字, 数据库字段名的修改代价大, 因为无法进行预发布, 所以字段名需要慎重考虑</p>
<ul>
<li>正例: aliyun_admin, rdc_config</li>
<li>反例: AliyunAdmin</li>
</ul>
</li>
<li>
<p>[强制] 禁用保留字, 如 desc 等</p>
</li>
<li>
<p>[强制] 表必备三字段, id, gmt_create, gmt_modified</p>
<ul>
<li>id 必为主键, 类型为 BIGINT UNSIGNED、单表时自增, 步长为1</li>
<li>gmt_create 表示主动式创建</li>
<li>gmt_modified 表示被动式更新</li>
</ul>
</li>
<li>
<p>[推荐] 表的命名最好是遵循&quot;业务名称_表的作用&quot;</p>
<ul>
<li>alipay_task, force_project</li>
</ul>
</li>
</ul>
<p>MySQL 新特性-DDL 的原子化</p>
<p>DDL 操作要么成功要么回滚</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">如下显示</span>
<span style="color:#960050;background-color:#1e0010">当前只有一个表</span> book21, <span style="color:#960050;background-color:#1e0010">没有</span> book2
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TABLE</span> book1, book2;
<span style="color:#960050;background-color:#1e0010">这时候会报错</span>, book1 <span style="color:#960050;background-color:#1e0010">会依然在</span>.
</code></pre></div><h2 id="11-数据处理之增删改">11. 数据处理之增删改</h2>
<h3 id="1-插入数据">1. 插入数据</h3>
<h4 id="11-插入数据实际问题">1.1 插入数据实际问题</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">use atguigudb;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> emp1(
  id INT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  hire_date DATE,
  salary DOUBLE(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>)
);
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field     <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> name      <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">15</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> hire_date <span style="color:#f92672">|</span> date        <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary    <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">此时里面是没有数据的</span>
</code></pre></div><h4 id="12-方式1-values-的方式添加">1.2 方式1: VALUES 的方式添加</h4>
<p>一条一条添加数据</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">没有指明添加字段</span>, <span style="color:#960050;background-color:#1e0010">因此要严格按照声明的顺序添加</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1 <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#e6db74">&#34;2010-3-3&#34;</span>, <span style="color:#ae81ff">20000</span>);

<span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">指明了添加的字段</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1 (id, salary, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">30000</span>, <span style="color:#e6db74">&#34;ting&#34;</span>);
<span style="color:#960050;background-color:#1e0010">没有写的字段就按默认的</span>

<span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">一次插入多条</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1 (id, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>, salary)
<span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#34;zhao&#34;</span>, <span style="color:#ae81ff">4000</span>),
(<span style="color:#ae81ff">4</span>, <span style="color:#e6db74">&#34;wang&#34;</span>, <span style="color:#ae81ff">5000</span>);

</code></pre></div><h4 id="12-方式2-将查询结果插入到表内">1.2 方式2: 将查询结果插入到表内</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1 (id, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>, salary)
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> employees
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IN</span> (<span style="color:#ae81ff">60</span>,<span style="color:#ae81ff">70</span>);
<span style="color:#960050;background-color:#1e0010">要提前看看被添加的表的字段的长度不能低于被查询的表的长度</span>
</code></pre></div><h3 id="2-更新数据">2. 更新数据</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">UPDATE</span> ... <span style="color:#66d9ef">SET</span> ... <span style="color:#66d9ef">WHERE</span> ...

<span style="color:#66d9ef">UPDATE</span> emp1
<span style="color:#66d9ef">SET</span> salary<span style="color:#f92672">=</span><span style="color:#ae81ff">25000</span>
<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;luo&#39;</span>;

<span style="color:#960050;background-color:#1e0010">同时修改一条数据的多个字段</span>
<span style="color:#66d9ef">UPDATE</span> emp1
<span style="color:#66d9ef">SET</span> salary<span style="color:#f92672">=</span>salary<span style="color:#f92672">+</span><span style="color:#ae81ff">1000</span>, hire_date<span style="color:#f92672">=</span>CURDATE()
<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;luo&#39;</span>;

<span style="color:#960050;background-color:#1e0010">修改数据是有可能修改不成功的</span>, <span style="color:#960050;background-color:#1e0010">有可能因为约束的影响造成的</span>

</code></pre></div><h3 id="3-删除数据">3. 删除数据</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> ...
<span style="color:#66d9ef">WHERE</span> ...

<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> emp1
<span style="color:#66d9ef">WHERE</span> <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;luo&#39;</span>;

<span style="color:#66d9ef">DELETE</span> <span style="color:#960050;background-color:#1e0010">也可能删除失败</span>, <span style="color:#960050;background-color:#1e0010">有可能因为约束的影响造成的</span>

DML <span style="color:#960050;background-color:#1e0010">操作默认情况下</span>, <span style="color:#960050;background-color:#1e0010">执行完都会自动提交数据</span>
<span style="color:#960050;background-color:#1e0010">如果下网执行完不自动提交数据</span>, <span style="color:#960050;background-color:#1e0010">则需要使用</span><span style="color:#66d9ef">SET</span> autocommit <span style="color:#f92672">=</span> <span style="color:#66d9ef">FALSE</span>;


</code></pre></div><h3 id="4-mysql-8-新特性-计算列">4. MySQL 8 新特性: 计算列</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">某一列的值是通过别的列计算得来的</span>, <span style="color:#960050;background-color:#1e0010">这个列就是计算列</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> emp2(
  id INT,
  salary DOUBLE(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>),
  bonus DOUBLE(<span style="color:#ae81ff">8</span>, <span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">GENERATED</span> ALWAYS <span style="color:#66d9ef">AS</span> (salary <span style="color:#f92672">*</span> <span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">1</span>) VIRTUAL
);
</code></pre></div><h3 id="5-综合案例">5. 综合案例</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">空着了</span>
</code></pre></div><h2 id="12-mysql-数据类型精讲">12. MySQL 数据类型精讲</h2>
<h3 id="1-mysql-中的数据类型">1. MySQL 中的数据类型</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>类型举例</th>
</tr>
</thead>
<tbody>
<tr>
<td>整数</td>
<td>TINYINT, SMALLINT, MEDIUMINT, INT, BIGINT</td>
</tr>
<tr>
<td>浮点类型</td>
<td>FLOAT, DOUBLE</td>
</tr>
<tr>
<td>定点数类型</td>
<td>DECIMAL</td>
</tr>
<tr>
<td>位类型</td>
<td>BIT</td>
</tr>
<tr>
<td>日期时间类型</td>
<td>YEAR, DATE, TIME, DATETIME, TIMESTAMP</td>
</tr>
<tr>
<td>文本字符串类型</td>
<td>CHAR, VARCHAR, TINYTEXT, TEXT, MEDIUMTEXT, LONGTEXT</td>
</tr>
<tr>
<td>枚举类型</td>
<td>ENUM</td>
</tr>
<tr>
<td>集合类型</td>
<td>SET</td>
</tr>
<tr>
<td>二进制字符串类型</td>
<td>BINARY, VARBINARY, TINYBLOB, BLOB, MEDIUMBLOB, LONGBLOB</td>
</tr>
<tr>
<td>JSON类型</td>
<td>JSON对象, JSON数组</td>
</tr>
<tr>
<td>空间数据类型</td>
<td>单值: GEOMETRY, POINT, LINESTRING, POLYGON, 集合: MULTIPOINT, MULTILINESTRING, MULTIPOLYGON, GEOMETRYCOLLECTION</td>
</tr>
</tbody>
</table>
<p>创建表时常遇到的数据类型的属性, 如下:</p>
<table>
<thead>
<tr>
<th>MySQL关键字</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>NULL</td>
<td>数据列可包含NULL值</td>
</tr>
<tr>
<td>NOT NULL</td>
<td>数据列不允许包含NULL值</td>
</tr>
<tr>
<td>DEFAULT</td>
<td>默认值</td>
</tr>
<tr>
<td>PRIMARY KEY</td>
<td>主键</td>
</tr>
<tr>
<td>AUTO_INCREMENT</td>
<td>自增, 适用于整数类型</td>
</tr>
<tr>
<td>UNSIGNED</td>
<td>无符号, 适用于整数类型</td>
</tr>
<tr>
<td>CHARACTER SET 字符集</td>
<td>指定字符集</td>
</tr>
</tbody>
</table>
<h3 id="2-整数类型">2. 整数类型</h3>
<h4 id="21-类型介绍">2.1 类型介绍</h4>
<p>整数类型一共有5种, 包括: TINYINT, SMALLINT, MEDIUMINT, INT(INTEGER), BIGINT</p>
<table>
<thead>
<tr>
<th>整数类型</th>
<th>字节</th>
<th>有符号取值范围</th>
<th>无符号取值范围</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYINT</td>
<td>1</td>
<td>(-128, 127)</td>
<td>(0, 255)</td>
</tr>
<tr>
<td>SMALLINT</td>
<td>2</td>
<td>(-32768, 32767)</td>
<td>(0, 65535)</td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>3</td>
<td>(-8388608, 8388607)</td>
<td>(0, 16777215)</td>
</tr>
<tr>
<td>INT</td>
<td>4</td>
<td>(-2147483648, 2147483647)</td>
<td>(0, 4294967295)</td>
</tr>
<tr>
<td>BIGINT</td>
<td>8</td>
<td>(-9223372036854775808, 9223372036854775807)</td>
<td>(0, 18446744073709551615)</td>
</tr>
</tbody>
</table>
<h4 id="22-可选属性">2.2 可选属性</h4>
<h5 id="221-m">2.2.1 M</h5>
<p>M: 表示显示宽度, M 的取值范围: [0,255]</p>
<p>MySQL 5.7 会在类型后面有一个括号, 括号里面的数字代表可能的最大的长度, 比如 TINYINT(4) 是显示宽度, 但是不会影响存储和取值范围, 直接用没有用, 但是加上 ZEROFILL 就会有用了. 显示宽度不足4位时会用0填充. 用了 ZEROFILL 之后, 会自动加上 UNSIGNED.</p>
<p>从 MySQL 8 开始, 整数数据类型不推荐使用显示宽度属性.</p>
<h5 id="222-unsigned">2.2.2 UNSIGNED</h5>
<p>UNSIGNED 是无符号类型, 所有的整数类型都有一个可选的属性 UNSIGNED</p>
<h5 id="223-zerofill">2.2.3 ZEROFILL</h5>
<p>0 填充, 与 M 属性配合, 会自动加上 UNSIGNED</p>
<h4 id="23-适用场景">2.3 适用场景</h4>
<ul>
<li>TINYINT: 一般用域枚举数据, 比如系统设定取值范围很小且固定的场景</li>
<li>SMALLINT: 可以用于较小范围的统计数据, 比如统计工厂的固定资产库存数量</li>
<li>MEDIUMINT: 用于较大范围的统计数据, 比如车站每日的客流量</li>
<li>INT: 用于较大范围的统计数据, 比如公司每日的销售额</li>
<li>BIGINT: 用于较大范围的统计数据, 比如国家的人口数量，或者双十一的交易量</li>
</ul>
<h4 id="24-如何选择">2.4 如何选择?</h4>
<p>根据实际情况选择, 一般来说, 一个表中的整数类型的字段越小, 则占用的存储空间越小, 读取的速度也越快, 但是如果数据量很大, 则需要选择大一点的整数类型. 考虑存储空间和可靠性. 一般用 INT, 系统故障的成本比存储空间的成本要高得多.</p>
<h3 id="3-浮点类型">3. 浮点类型</h3>
<h4 id="31-类型介绍">3.1 类型介绍</h4>
<p>浮点数和定点数都可以处理小数, 可以把整数看成小数的一个特例, 因此浮点数和定点数的使用场景更大. MySQL 支持的浮点数类型: FLOAT, DOUBLE, REAL.</p>
<p>REAL 默认就是 DOUBLE, 如果你把 SQL 模式设定为启动 &ldquo;REAL_AS_FLOAT&rdquo; 选项, 那么 REAL 就是 FLOAT, 如果要启动 &ldquo;REAL_AS_FLOAT&rdquo; 选项, 可以 <code>SET sql-mode=REAL_AS_FLOAT</code></p>
<h4 id="32-数据精度说明">3.2 数据精度说明</h4>
<p>MySQL 中单精度值使用 4 个字节, 双精度使用 8 个字节</p>
<h4 id="33-精度误差说明">3.3 精度误差说明</h4>
<p>因为是2进制存储的, 所以有些小数是无法精确存储的. 因此在浮点数的时候, 要避免用 &ldquo;=&rdquo; 来判断两个数是否相等</p>
<h3 id="4-定点数类">4. 定点数类</h3>
<h4 id="41-类型介绍">4.1 类型介绍</h4>
<p>使用 DECIMAL(M,D) 来表示高精度小数, 其中 M 被称为精度, D被称为标度.<br>
DECIMAL 的最大取值范围与 DOUBLE 类型一样. 默认是 DECIMAL(10,0), 也就是说默认是整数.</p>
<ul>
<li>浮点数相对于定点数的有点是在长度一定的情况下, 浮点类型取值范围大, 但是不精确, 适用于需要取值范围大, 又可以容忍微小误差的科学计算场景</li>
<li>定点数类型取值范围相对小, 但是精准, 没有误差, 适合用域对精度要求极高的场景, 比如涉及钱的计算的场景.</li>
<li>DECIMAL 会存在四舍五入</li>
</ul>
<h4 id="42-开发中经验">4.2 开发中经验</h4>
<p>由于 DECIMAL 数据类型的精准性, 在项目中, 除了极少数(如商品编号)用到整数类型外, 其他的数值用的都是 DECIMAL 类型, 以保证数据的精准性, 对于钱的全部用 DECIMAL 类型</p>
<h3 id="5-位类型">5. 位类型</h3>
<p>BIT(M): 长度 M, M 的取值范围是 1-64, 占用约 (M+7)/8 个字节, 用 值+0 就可以显示10进制的值</p>
<h3 id="6-日期与时间类型">6. 日期与时间类型</h3>
<table>
<thead>
<tr>
<th>类型</th>
<th>名称</th>
<th>字节</th>
<th>日期格式</th>
<th>最小值</th>
<th>最大值</th>
</tr>
</thead>
<tbody>
<tr>
<td>YEAR</td>
<td>年</td>
<td>1</td>
<td>YYYY</td>
<td>1901</td>
<td>2155</td>
</tr>
<tr>
<td>TIME</td>
<td>时间</td>
<td>3</td>
<td>HH:MM:SS</td>
<td>&lsquo;-838:59:59&rsquo;</td>
<td>&lsquo;838:59:59&rsquo;(还能表示时间间隔)</td>
</tr>
<tr>
<td>DATE</td>
<td>日期</td>
<td>3</td>
<td>YYYY-MM-DD</td>
<td>&lsquo;1000-01-01&rsquo;</td>
<td>&lsquo;9999-12-31&rsquo;</td>
</tr>
<tr>
<td>DATETIME</td>
<td>日期时间</td>
<td>8</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>&lsquo;1000-01-01 00:00:00&rsquo;</td>
<td>&lsquo;9999-12-31 23:59:59&rsquo;</td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>时间戳</td>
<td>4</td>
<td>YYYY-MM-DD HH:MM:SS</td>
<td>&lsquo;1970-01-01 00:00:00&rsquo; UTC</td>
<td>&lsquo;2038-01-19 03:14:07&rsquo; UTC</td>
</tr>
</tbody>
</table>
<h4 id="61-year类型">6.1 YEAR类型</h4>
<p>几种存储格式:</p>
<ul>
<li>以 4 位字符串或数字格式表示 YEAR 类型, 其格式为 YYYY, 可以存储的范围是 1901-2155</li>
<li>以 2 位字符串格式表示 YEAR 类型, 最小值为 00, 最大值为 99
<ul>
<li>当取值范围为 01-69 时, 表示的年份为 2001-2069</li>
<li>当取值范围为 70-99 时, 表示的年份为 1970-1999</li>
<li>00 比较复杂, 一种是 0000 年, 一种是 2000 年</li>
<li>&lsquo;00&rsquo;/&lsquo;0&rsquo; 表示 2000 年</li>
<li>00/0 表示 0000 年
2 位不推荐使用了, 默认现在是 4 位</li>
</ul>
</li>
</ul>
<h4 id="62-date类型">6.2 DATE类型</h4>
<ul>
<li>以 YYYY-MM-DD 格式存储日期, 取值范围是 1000-01-01 到 9999-12-31</li>
<li>以 YY-MM-DD 格式或者 YYYYMMDD 格式存储日期, 取值范围是 1970-01-01 到 2069-12-31</li>
<li>使用 CURRENT_DATE() 或 NOW() 可以获取当前日期</li>
</ul>
<h4 id="63-time类型">6.3 TIME类型</h4>
<p>需要占 3 个字节,</p>
<ul>
<li>可以使用带有冒号的字符串, 比如 &ldquo;D HH:MM:SS&rdquo;, &ldquo;HH:MM:SS&rdquo;, &ldquo;HH:MM&rdquo;, &ldquo;D HH:MM&rdquo;, &ldquo;D HH&rdquo; 或 &ldquo;SS&rdquo; 格式, D 表示天, 最小值是0, 最大值是 34, 如果使用带有 D 格式的字符串插入 TIME 类型的字段时, D 会被转化为小时, 计算格式为 &ldquo;D*24+HH&rdquo;, 当使用带有冒号且不带 D 的字符串表示时间时, 表示当天的时间, 比如 12:10 表示  12:10:00 而不是 00:12:10</li>
<li>可以使用不带有冒号的字符串或数字, 格式为 &ldquo;HHMMSS&rdquo; 或者 HHMMSS。 如果插入一个不合法的字符串或者数字, MySQL 在存储数据时, 会将其自动转化为 00:00:00 进行存储, 比如 1210, MySQL 会将最右边的两位解析成秒, 表示 00:12:10 而不是 12:10:00</li>
<li>使用 CURRENT_DATE() 或 NOW() 可以获取当前日期</li>
</ul>
<h4 id="64-datetime类型">6.4 DATETIME类型</h4>
<p>需要占用 8 个字节</p>
<ul>
<li>可以表示为 &ldquo;YYYY-MM-DD HH:MM:SS&rdquo; 格式, 取值范围是 1000-01-01 00:00:00 到 9999-12-31 23:59:59</li>
<li>以 YY-MM-DD HH:MM:SS 格式或者 YYYYMMDDHHMMSS 格式存储日期, 取值范围是 1970-01-01 00:00:00 到 2069-12-31 23:59:59</li>
</ul>
<h4 id="65-timestamp类型">6.5 TIMESTAMP类型</h4>
<p>需要占用 4 个字节</p>
<ul>
<li>存储数据的时候需要对当前时间所在的时区进行转换, 查询数据的时候再将时间转换回当前的失去, 因此, 使用 TIMESTAMP 存储同一个时间值, 在不同的时区查询会显示不同的时间</li>
<li>时间范围是 1970-01-01 00:00:01 到 2038-01-19 03:14:07</li>
</ul>
<h4 id="66-开发中经验">6.6 开发中经验</h4>
<p>一般用时间戳</p>
<h3 id="7-文本字符串类型">7. 文本字符串类型</h3>
<table>
<thead>
<tr>
<th>文本字符串类型</th>
<th>值的长度</th>
<th>长度范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>CHAR(M)</td>
<td>M</td>
<td>0-255</td>
<td>M 字节</td>
</tr>
<tr>
<td>VARCHAR(M)</td>
<td>M</td>
<td>0-65535</td>
<td>实际长度+1 字节</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>L</td>
<td>0-255</td>
<td>L+2 字节</td>
</tr>
<tr>
<td>TEXT</td>
<td>L</td>
<td>0-65535</td>
<td>L+2 字节</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>L</td>
<td>0-16777215</td>
<td>L+3 字节</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>L</td>
<td>0-4294967295</td>
<td>L+4 字节</td>
</tr>
<tr>
<td>ENUM</td>
<td>L</td>
<td>0-65535</td>
<td>1或2 字节</td>
</tr>
<tr>
<td>SET</td>
<td>L</td>
<td>0-64</td>
<td>1, 2, 3, 4 或 8 字节</td>
</tr>
</tbody>
</table>
<h4 id="71-char与varchar类型">7.1 CHAR与VARCHAR类型</h4>
<ul>
<li>CHAR: 固定长度字符串, 如果存储的字符串长度小于 M, 则会在字符串后面用空格填充, 如果存储的字符串长度大于 M, 则会被截断或者报错</li>
<li>如果 CHAR 插入的字符串后面有空格, 检索出来的时候也会被去掉</li>
<li>VARCHAR: 可变长度字符串, 如果存储的字符串长度小于 M, 则会按照实际长度存储, 如果存储的字符串长度大于 M, 则会被截断</li>
</ul>
<p>CHAR</p>
<ul>
<li>一般需要预先定义字符串长度, 如果不指定M, 则默认为1个字符</li>
<li>如果保存时, 数据的实际长度比 CHAR 类型声明的长度小, 则会在右侧填充空格以达到指定的长度. 当 MySQL 检索 CHAR 类型的数据时, CHAR 类型的字段会去除尾部的空格.</li>
<li>定义 CHAR 类型字段时, 声明的字段长度即为 CHAR 类型字段所占的存储空间的字符数</li>
</ul>
<p>VARCHAR</p>
<ul>
<li>VARCHAT(M) 定义时, 必须指定长度 M, 否则报错</li>
<li>MySQL4.0以下的版本, VARCHAR(20): 指的是20个字节, 如果存放 UTF8汉字时, 只能存放 6 个汉字, 但是 MySQL5.0 以上的版本, VARCHAR(20): 指的是20个字符, 如果存放 UTF8汉字时, 可以存放 20 个汉字</li>
<li>检索 VARCHAR 类型的字段数据时, 会保留数据尾部的空格. VARCHAR 类型的字段所占用的存储空间为字符串的实际长度加1个字节.</li>
<li>VARCHAR 后面最大应该是 21845, 如果超过了, 就会报错, 因为65535/3=21845, 但是还要减去一些空间, 所以最大是 21845</li>
</ul>
<p>根据存储引擎</p>
<ul>
<li>MyISAML 最好使用固定长度(CHAR)的数据代替可变长度(VARCHAR)的数据列, 这样是的整个表静态化, 从而使数据检索更快, 用空间换时间.</li>
<li>MEMORY: MEMORY 数据表目前都使用固定长度的数据行存储, 因此无论使用 CHAR 或 VARCHAR 列都没有关系, 两者都是作为 CHAR 类型处理的</li>
<li>InnoDB: 建议使用 VARCHAR 类型, 因为对于InnoDB数据表, 内部的行存储格式并没有区分固定长度和可变长度列, 而且主要影响性能的因素时数据行使用的存储总量, 由于 CHAR 平均占用的空间多余 VARCHAR, 所以除了简短并固定长度的, 其他考虑 VARCHAR, 这样节省空间, 对磁盘 I/O 和数据存储总量都比较好.</li>
</ul>
<h4 id="72-text类型">7.2 TEXT类型</h4>
<p>在 MySQL 中, TEXT 用来保存文本类型的字符串, 总共包含四种类型, 分别为 TINYTEXT, TEXT, MEDIUMTEXT 和 LONGTEXT</p>
<p>在向 TEXT 类型的字段保存和查询数据时, 系统自动按照实际长度存储, 不需要预先定义长度, 这一点和 VARCHAR 类型相同.</p>
<p>每种 TEXT 类型保存的数据长度和所占用的存储空间不同, 如下:</p>
<table>
<thead>
<tr>
<th>文本字符串类型</th>
<th>特点</th>
<th>长度</th>
<th>长度范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>TINYTEXT</td>
<td>小文本, 可变长</td>
<td>L</td>
<td>0-255</td>
<td>L+2 字节</td>
</tr>
<tr>
<td>TEXT</td>
<td>文本, 可变长</td>
<td>L</td>
<td>0-65535</td>
<td>L+2 字节</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>中等文本, 可变长</td>
<td>L</td>
<td>0-16777215</td>
<td>L+3 字节</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>大文本, 可变长</td>
<td>L</td>
<td>0-4294967295</td>
<td>L+4 字节</td>
</tr>
</tbody>
</table>
<p>由于实际存储的长度不确定, MySQL 不允许 TEXT 类型的字段做主键. 遇到这种情况, 只能采用 CHAR(M), 或者 VARCHAR(M) 来代替 TEXT 类型的字段.</p>
<ul>
<li>保存的时候不会自动删除尾部的空格.</li>
<li>TEXT 文本类型, 可以存储比较大的文本段, 搜索速度比较慢, 因此如果不是特别大的内容, 建议使用 CHAR, VARCHAR 来代替.</li>
</ul>
<h3 id="8-enum类型">8. ENUM类型</h3>
<p>ENUM 类型也叫枚举类型, ENUM 类型的取值范围需要在定义字段时进行指定, 设置字段值时, ENUM 类型只允许从成员中选取单个值, 不能一次选取多个值</p>
<p>其所需要的存储空间由定义 ENUM 类型时指定的成员个数决定.</p>
<table>
<thead>
<tr>
<th>文本字符串类型</th>
<th>长度</th>
<th>长度范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>ENUM</td>
<td>L</td>
<td>0-65535</td>
<td>1或2 字节</td>
</tr>
</tbody>
</table>
<ul>
<li>当 ENUM 类型包含 1-255 个成员时, 占用 1 个字节</li>
<li>当 ENUM 类型包含 256-65535 个成员时, 占用 2 个字节</li>
<li>ENUM 类型的成员个数的上限为 65535 个, 如果超过这个上限, 则会报错</li>
</ul>
<h3 id="9-set类型">9. SET类型</h3>
<p>SET 表示一个字符串对象, 可以表示0个或者多个成员, 但是成员个数的上限为 64, 设置字段值时, 可以取取值范围内的0个或者多个值</p>
<p>当 SET 类型包含的成员个数不同时, 其所占用的存储空间也是不同的, 具体如下:</p>
<table>
<thead>
<tr>
<th>成员个数范围</th>
<th>占用的存储空间</th>
</tr>
</thead>
<tbody>
<tr>
<td>1-8</td>
<td>1 字节</td>
</tr>
<tr>
<td>9-16</td>
<td>2 字节</td>
</tr>
<tr>
<td>17-24</td>
<td>3 字节</td>
</tr>
<tr>
<td>25-32</td>
<td>4 字节</td>
</tr>
<tr>
<td>33-64</td>
<td>8 字节</td>
</tr>
</tbody>
</table>
<p>SET 类型在存储数据时, 成员个数越多, 其占用的存储空间越大, 注意: SET 类型在选取成员时, 可以一次选择多个成员, 这与 ENUM 类型不同.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> test_set(
  s <span style="color:#66d9ef">SET</span> (<span style="color:#e6db74">&#39;a&#39;</span>,<span style="color:#e6db74">&#39;b&#39;</span>, <span style="color:#e6db74">&#39;c&#39;</span>)
);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_set <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;a,b&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> s    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> a,b  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> test_set;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_set <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;a,b,c,a&#39;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> s     <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> a,b   <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> a,b,<span style="color:#66d9ef">c</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+
</span></code></pre></div><h3 id="10-二进制字符串类型">10. 二进制字符串类型</h3>
<p>MySQL 中的二进制字符串类型主要存储一些二进制数据, 比如可以存储图片, 音频和视频等二进制数据<br>
MySQL 中支持的二进制字符串主要包括 BINAY, VARBINARY, TINYBLOB, BLOB, MEDIUMBLOB 和 LONGBLOB 类型</p>
<h4 id="101-binary与varbinary类型">10.1 BINARY与VARBINARY类型</h4>
<p>BINARY 和 VARBINARY 类似于 CHAR 和 VARCHAR, 只是他们存储的是二进制字符串</p>
<h4 id="102-blob类型">10.2 BLOB类型</h4>
<p>BLOB 是一个二进制大对象, 可以容纳可变数量的数据</p>
<p>一般用于存储: 图片, 音频, 视频等</p>
<p>实际工作中一般不会在 MySQL 数据库中使用 BLOB 存储图片, 音频, 视频等二进制数据, 一般会将这些数据存储在文件系统中, 然后在数据库中存储文件的路径.</p>
<p>TEXT 和 BLOB 的使用注意事项</p>
<ul>
<li>BLOB 和 TEXT 的值也会引起一些问题, 特别是执行了大量地删除或更新操作的时候, 删除这种值会在数据表中留下很大的空洞, 以后填入这些空洞的记录可能长度不同, 为了提高性能, 建议定期使用 OPTIMIZE TABLE 命令来进行碎片处理</li>
<li>如果需要对大文本字段进行模糊查询, MySQL 提供了前缀索引. 但是仍然要在不必要的时候避免检索大型的 BLOB 或 TEXT 的值, 例如, SELECT * 查询就不是一个好的操作, 除非你能够确定作为约束条件的 WHERE 子句只会找到所需要的数据行.</li>
<li>把 BLOB 或 TEXT 列, 分离到单独的表中. 在某些环境中, 如果把这些数据列移动到第二张数据表中, 可以让你把原数据表中的数据列转换为固定长度的数据行格式, 那么他就是有意义的. 这回减少主表中的碎片, 使得能够发挥固定长度数据行的性能优势.</li>
</ul>
<h3 id="11-json类型">11. JSON类型</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> test_json(
  info JSON
);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_json <span style="color:#66d9ef">VALUES</span> (<span style="color:#e6db74">&#39;{&#34;name&#34;: &#34;luo&#34;, &#34;age&#34;: 18}&#39;</span>);
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> test_json;
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> info                       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">{</span><span style="color:#e6db74">&#34;age&#34;</span>: <span style="color:#ae81ff">18</span>, <span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;luo&#34;</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----------------------------+
</span></code></pre></div><h3 id="12-空间类型">12. 空间类型</h3>
<p>用的比较少</p>
<h3 id="13-小结及选择建议">13. 小结及选择建议</h3>
<ul>
<li>整数用 INT</li>
<li>小数用 DECIMAL</li>
<li>如果用日期和时间用 DATETIME</li>
<li>TEXT 方便但是效率不如 CHAR 和 VARCHAR</li>
</ul>
<p>建议:</p>
<ul>
<li>VARCHAR 不超过5000, 如果超过了就用 TEXT</li>
</ul>
<h2 id="13-约束">13. 约束</h2>
<h3 id="1-约束contraint的概念">1. 约束(contraint)的概念</h3>
<h4 id="11-为什么需要约束">1.1 为什么需要约束</h4>
<p>数据完整性(Data Integrity) 是指数据的精确性(Accuracy) 和可靠性(Reliability). 他是方式数据库中存在不符合语义规定的数据和放置因错误信息的输入输出造成无效操作或错误信息而提出的</p>
<p>为了保证数据的完整性, SQL 规范以约束的方式对 表数据进行额外的条件限制, 从以下四个方面考虑:</p>
<ul>
<li>实体完整性(Entity Integrity): 例如: 同一个表中, 不能存在两条完全相同无法区分的记录</li>
<li>域完整性(Domain Integrity): 例如: 年龄范围0-255, 性别范围: 男/女</li>
<li>引用完整性(Referential Integrity): 例如: 一个表中的外键必须是另一个表中的主键, 员工属于一个部门, 部门表中要能够找到这个部门</li>
<li>用户自定义完整性(User-defined Integrity): 例如: 用户名唯一、密码不能为空</li>
</ul>
<h4 id="12-什么是约束">1.2 什么是约束</h4>
<p>约束时表级的强制规定.</p>
<h4 id="13-约束的分类">1.3 约束的分类</h4>
<ul>
<li>根据约束的字段个数: 单列约束, 多列约束</li>
<li>根据约束的作用范围: 列级约束, 表级约束</li>
<li>根据约束的作用: 非空约束(NOT NULL), 唯一性约束(UNIQUE), 主键约束(PRIMARY KEY), 外键约束(FOREIGN KEY), 默认约束(DEFAULT), 检查约束(CHECK)</li>
</ul>
<p>一般在创建表的时候就创建好了约束</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">查看表中的约束</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints 
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;employees&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> emp_email_uk    <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> emp_emp_id_pk   <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> emp_dept_fk     <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> emp_job_fk      <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> emp_manager_fk  <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> employees  <span style="color:#f92672">|</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span>
</code></pre></div><h3 id="2-非空约束">2. 非空约束</h3>
<h4 id="21-作用">2.1 作用</h4>
<p>限定某个字段的值不允许为空</p>
<h4 id="22-关键字">2.2 关键字</h4>
<p><code>NOT NULL</code></p>
<h4 id="23-特点">2.3 特点</h4>
<ul>
<li>默认, 所有的类型的值都可以是 NULL, 包括 INT, FLOAT等数据类型</li>
<li>非空约束只能出现在表对象的列上, 只能某个列单独限定非空, 不能组合非空</li>
<li>一个表可以由很多列都分别限定了非空</li>
<li>空字符串和 NULL 是不一样的</li>
</ul>
<h4 id="24-添加非空约束">2.4 添加非空约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> table1(
  id INT <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
);

<span style="color:#75715e">-- 如果原来有 NULL, 想要改成 NOT NULL, 那么就会报错
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table1
<span style="color:#66d9ef">MODIFY</span> <span style="color:#66d9ef">COLUMN</span> email VARCHAR(<span style="color:#ae81ff">25</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>;
</code></pre></div><h4 id="25-删除非空约束">2.5 删除非空约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 删除约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table1
<span style="color:#66d9ef">MODIFY</span> <span style="color:#66d9ef">COLUMN</span> email VARCHAR(<span style="color:#ae81ff">25</span>) <span style="color:#66d9ef">NULL</span>;
</code></pre></div><h3 id="3-唯一性约束">3. 唯一性约束</h3>
<h4 id="31-作用">3.1 作用</h4>
<p>用来限制某个字段/某个列的值不能重复</p>
<h4 id="32-关键字">3.2 关键字</h4>
<p><code>UNIQUE</code></p>
<h4 id="33-特点">3.3 特点</h4>
<ul>
<li>同一个表可以有多个唯一约束</li>
<li>唯一约束可以是某一个列的值唯一, 也可以是多个列组合的值唯一</li>
<li>唯一性约束允许列值为空</li>
<li>在创建唯一性约束时, 如果不给唯一约束命名, 就默认和列名相同</li>
<li>MySQL 会给唯一性约束的列上默认创建一个唯一索引</li>
</ul>
<h4 id="34-添加唯一性约束">3.4 添加唯一性约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> table2(
  id INT <span style="color:#66d9ef">UNIQUE</span>,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  email VARCHAR(<span style="color:#ae81ff">25</span>) <span style="color:#66d9ef">UNIQUE</span>,
  <span style="color:#75715e">-- 表级约束
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">CONSTRAINT</span> table2_email_uk <span style="color:#66d9ef">UNIQUE</span>(email)
);

<span style="color:#66d9ef">DESC</span> table2;
<span style="color:#f92672">+</span><span style="color:#75715e">-------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id    <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> UNI <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> name  <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">15</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> email <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> UNI <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints 
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;table2&#39;</span>;

<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> email           <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> table2     <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> id              <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> table2     <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> table2_email_uk <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> table2     <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">这个约束名是用在删除约束的时候用的</span>. <span style="color:#960050;background-color:#1e0010">对于有了唯一性约束的列</span>, <span style="color:#960050;background-color:#1e0010">可以有多个</span><span style="color:#66d9ef">NULL</span>.

<span style="color:#75715e">-- 添加约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table2
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">UNIQUE</span>(email);

<span style="color:#75715e">-- 如果要加名字
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table2
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">CONSTRAINT</span> table2_email_uk <span style="color:#66d9ef">UNIQUE</span>(email);

<span style="color:#960050;background-color:#1e0010">或者</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table2
<span style="color:#66d9ef">MODIFY</span> <span style="color:#66d9ef">COLUMN</span> email VARCHAR(<span style="color:#ae81ff">25</span>) <span style="color:#66d9ef">UNIQUE</span>;
</code></pre></div><p>关于复合唯一性约束</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> table3(
  id INT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  email VARCHAR(<span style="color:#ae81ff">25</span>),
  <span style="color:#75715e">-- 复合唯一性约束
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">UNIQUE</span>(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>, email) <span style="color:#75715e">-- 组合的话, 默认的名字是第一个
</span><span style="color:#75715e"></span>  <span style="color:#75715e">-- 如果要加名字的话
</span><span style="color:#75715e"></span>  <span style="color:#75715e">-- CONSTRAINT table3_name_email_uk UNIQUE(`name`, email)
</span><span style="color:#75715e"></span>);

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints 
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;table3&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> atguigudb         <span style="color:#f92672">|</span> name            <span style="color:#f92672">|</span> atguigudb    <span style="color:#f92672">|</span> table3     <span style="color:#f92672">|</span> <span style="color:#66d9ef">UNIQUE</span>          <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span></code></pre></div><h4 id="35-删除唯一性约束">3.5 删除唯一性约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table2
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> email;
</code></pre></div><h3 id="4-primary-key-约束">4. PRIMARY KEY 约束</h3>
<h4 id="41-作用">4.1 作用</h4>
<p>用来唯一标识表中的一行记录</p>
<h4 id="42-关键字">4.2 关键字</h4>
<p><code>PRIMARY KEY</code></p>
<h4 id="43-特点">4.3 特点</h4>
<ul>
<li>主键约束相当于 唯一约束+非空约束的组合, 主键约束列不允许重复, 也不允许出现空值</li>
<li>一个表最多只能有一个主键约束, 建立主键约束可以在列级别创建, 也可以在表级别上创建</li>
<li>主键约束对应着表中的一列或者多列(复合主键)</li>
<li>如果是多列组合的复合主键约束, 那么这些列都不允许为空值, 并且组合的值不允许重复</li>
<li>MySQL 的主键名总是 PRIMARY, 就算自己命名了主键约束名也没用</li>
<li>当创建主键约束时, 系统默认会在所在的列或者列组合上建立对应的主键索引. 如果删除主键约束了, 主键约束对印的索引就自动删除了.</li>
<li>需要注意的一点是, 不要修改主键字段的值, 因为主键是数据记录的唯一标识, 如果修改了主键的值, 就有可能会破坏数据的完整性</li>
</ul>
<h4 id="44-添加主键约束">4.4 添加主键约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 主键的特征 非空且唯一
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">在</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">时</span>, <span style="color:#960050;background-color:#1e0010">添加主键约束</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> table4(
  id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>, <span style="color:#75715e">-- 列级约束
</span><span style="color:#75715e"></span>  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  email VARCHAR(<span style="color:#ae81ff">25</span>)
);
</code></pre></div><h4 id="45-关于复合主键">4.5 关于复合主键</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">复合主键两个都不能为</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table4
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id, <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>);
</code></pre></div><h4 id="46-删除主键约束">4.6 删除主键约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- 实际开发中不会删除主键约束
</span><span style="color:#75715e"></span><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table4
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>;
</code></pre></div><h3 id="5-自增列-auto_increment">5. 自增列: AUTO_INCREMENT</h3>
<h4 id="51-作用">5.1 作用</h4>
<p>某个字段的值自增</p>
<h4 id="52-关键字">5.2 关键字</h4>
<p><code>AUTO_INCREMENT</code></p>
<h4 id="53-特点和要求">5.3 特点和要求</h4>
<ul>
<li>一个表最多只能有一个自增长列</li>
<li>当需要产生唯一标识符或顺序值时, 可设置自增长</li>
<li>自增长列约束的列必须是键列(主键列, 唯一键列)</li>
<li>自增约束的列的数据类型必须是整数类型</li>
<li>如果自增列指定了 0 和 NULL, 会在当前最大值的基础上自增, 如果自增列手动指定了具体值, 直接赋值为具体值</li>
</ul>
<h4 id="54-如何指定自增约束">5.4 如何指定自增约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table4
<span style="color:#66d9ef">MODIFY</span> <span style="color:#66d9ef">COLUMN</span> id INT AUTO_INCREMENT;
</code></pre></div><h4 id="55-如何删除自增约束">5.5 如何删除自增约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> table4
<span style="color:#66d9ef">MODIFY</span> <span style="color:#66d9ef">COLUMN</span> id INT;
</code></pre></div><h4 id="56-mysql-80-新特性-自增变量的持久化">5.6 MySQL 8.0 新特性-自增变量的持久化</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">
<span style="color:#960050;background-color:#1e0010">这里是</span> MySQL <span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">7</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> dbtest03;
USE dbtest03;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> t1(
  id INT AUTO_INCREMENT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id)
);

<span style="color:#960050;background-color:#1e0010">插入</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;zhangsan&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;lisi&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;wangwu&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;zhaoliu&#39;</span>);

<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> t1 <span style="color:#66d9ef">WHERE</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>;

<span style="color:#960050;background-color:#1e0010">再插入一条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;niuqi&#39;</span>);
<span style="color:#960050;background-color:#1e0010">这时候</span> id <span style="color:#960050;background-color:#1e0010">是</span> <span style="color:#ae81ff">5</span>

<span style="color:#960050;background-color:#1e0010">再删掉</span>
<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> t1 <span style="color:#66d9ef">WHERE</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>;

<span style="color:#960050;background-color:#1e0010">重启服务器</span>
<span style="color:#960050;background-color:#1e0010">再插入一条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;niuqi&#39;</span>);
<span style="color:#960050;background-color:#1e0010">这时候</span> id <span style="color:#960050;background-color:#1e0010">是</span> <span style="color:#ae81ff">4</span>

<span style="color:#960050;background-color:#1e0010">因为</span> MySQL <span style="color:#ae81ff">5</span>.<span style="color:#ae81ff">7</span> <span style="color:#960050;background-color:#1e0010">这个是存在内存中的</span>, <span style="color:#960050;background-color:#1e0010">重启服务器就会丢失</span>

<span style="color:#960050;background-color:#1e0010">下面是</span> MySQL <span style="color:#ae81ff">8</span>.<span style="color:#ae81ff">0</span> <span style="color:#960050;background-color:#1e0010">的区别</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> dbtest04;
USE dbtest04;
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> t1(
  id INT AUTO_INCREMENT,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">15</span>),
  <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(id)
);

<span style="color:#960050;background-color:#1e0010">插入</span><span style="color:#ae81ff">4</span><span style="color:#960050;background-color:#1e0010">条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;zhangsan&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;lisi&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;wangwu&#39;</span>);
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;zhaoliu&#39;</span>);

<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> t1 <span style="color:#66d9ef">WHERE</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>;

<span style="color:#960050;background-color:#1e0010">再插入一条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;niuqi&#39;</span>);
<span style="color:#960050;background-color:#1e0010">这时候</span> id <span style="color:#960050;background-color:#1e0010">是</span> <span style="color:#ae81ff">5</span>

<span style="color:#960050;background-color:#1e0010">再删掉</span>
<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> t1 <span style="color:#66d9ef">WHERE</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>;

<span style="color:#960050;background-color:#1e0010">重启服务器</span>
<span style="color:#960050;background-color:#1e0010">再插入一条数据</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> t1(<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;niuqi&#39;</span>);
<span style="color:#960050;background-color:#1e0010">这时候</span> id <span style="color:#960050;background-color:#1e0010">是</span> <span style="color:#ae81ff">6</span>

<span style="color:#960050;background-color:#1e0010">这个是持久化的</span>, <span style="color:#960050;background-color:#1e0010">重启服务器也不会丢失</span>
</code></pre></div><h3 id="6-foreign-key-约束">6. FOREIGN KEY 约束</h3>
<h4 id="61-作用">6.1 作用</h4>
<p>限定某个表的某个字段的引用完整性. 也就是说, 限定某个表的某个字段的值必须在另一个表的某个字段的值中存在</p>
<h4 id="62-关键字">6.2 关键字</h4>
<p><code>FOREIGN KEY</code></p>
<h4 id="63-主表和从表父表和子表">6.3 主表和从表/父表和子表</h4>
<ul>
<li>主表: 被引用的表, 被参考的表</li>
<li>从表: 引用别人的表, 参考别人的表</li>
<li>例如: 员工表的员工所在部门的这个字段的值要参考部门表, 部门表示主表, 员工表是从表</li>
<li>例如: 学生表, 课程表, 选课表: 选课表的学生和课程要分别参考学生表和课程表, 学生表和课程表是主表, 选课表是从表.</li>
</ul>
<h4 id="64-外键约束的特点">6.4 外键约束的特点</h4>
<ul>
<li>从表的外键列, 必须引用/参考主表的键主键或唯一约束的列</li>
<li>在创建外键约束时, 如果不给外键约束命名, 默认名不是列名, 而是自动产生一个外键名, 也可以指定外键约束名</li>
<li>创建表时就指定外键约束的话, 先创建主表, 再创建从表</li>
<li>删表时, 先删从表, 再删主表</li>
<li>当主表的记录被从表参照时, 主表的记录将不允许删除, 如果要删除数据, 需要先删除从表中依赖该记录的数据, 然后才可以删除主表的数据</li>
<li>在“从表”中指定外键约束, 并且一个表可以建立多个外键约束</li>
<li>从表的外键列于主表被参照的列名字可以不相同, 但是数据类型必须一样, 逻辑意义一致. 如果类型不一样, 创建子表时, 就会出现错误</li>
<li>当创建外键约束时, 系统默认会在所有的列上建立对应的普通索引. 但索引名是列名, 不是外键的约束名.(根据外键查询效率很高)</li>
<li>删除外键约束后, 必须手动删除对应的索引</li>
</ul>
<h4 id="65-添加外键约束">6.5 添加外键约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#960050;background-color:#1e0010">外键约束</span> <span style="color:#66d9ef">foreign</span> <span style="color:#66d9ef">key</span>
<span style="color:#960050;background-color:#1e0010">在</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#960050;background-color:#1e0010">时添加外键约束</span>
<span style="color:#960050;background-color:#1e0010">主表和从表</span>: <span style="color:#960050;background-color:#1e0010">父表和子表</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> dbtest05;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">先创建主表</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> dept1(
  dept_id INT,
  dept_name VARCHAR(<span style="color:#ae81ff">15</span>)
);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp1(
 emp_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
 emp_name VARCHAR(<span style="color:#ae81ff">15</span>),
 department_id INT,
  <span style="color:#75715e">-- 添加外键约束
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">CONSTRAINT</span> fk_emp1_dept_id <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>(department_id) <span style="color:#66d9ef">REFERENCES</span> dept1(dept_id)
);

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">这时候会报错</span>, <span style="color:#960050;background-color:#1e0010">因为这里</span>dept1 <span style="color:#960050;background-color:#1e0010">里的</span> dept_id <span style="color:#960050;background-color:#1e0010">不是主键，也没有唯一性约束</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">因此这里增加一个主键</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> dept1
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> (dept_id);

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">重新创建</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp1(
 emp_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
 emp_name VARCHAR(<span style="color:#ae81ff">15</span>),
 department_id INT,
  <span style="color:#75715e">-- 添加外键约束
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">CONSTRAINT</span> fk_emp1_dept_id <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>(department_id) <span style="color:#66d9ef">REFERENCES</span> dept1(dept_id)
);

<span style="color:#66d9ef">DESC</span> emp1;
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+------+-----+---------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field         <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra          <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+------+-----+---------+----------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> emp_id        <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span> PRI <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span> auto_increment <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp_name      <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">15</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>                <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> MUL <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>                <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">---------------+-------------+------+-----+---------+----------------+
</span><span style="color:#75715e"></span>
<span style="color:#960050;background-color:#1e0010">或者查看约束信息</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;emp1&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp1       <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> fk_emp1_dept_id <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp1       <span style="color:#f92672">|</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span>

</code></pre></div><h4 id="66-演示问题">6.6 演示问题</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">演示外键的效果</span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">1000</span>, <span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">10</span>);
<span style="color:#75715e">-- ERROR 1452 (23000): Cannot add or update a child row: a foreign key constraint fails (`dbtest05`.`emp1`, CONSTRAINT `fk_emp1_dept_id` FOREIGN KEY (`department_id`) REFERENCES `dept1` (`dept_id`))
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">这时候会报错，是因为主表中没有</span> dept_id <span style="color:#960050;background-color:#1e0010">为</span> <span style="color:#ae81ff">10</span> <span style="color:#960050;background-color:#1e0010">的记录</span>

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> dept1
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>, <span style="color:#e6db74">&#34;IT&#34;</span>);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp1
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">1000</span>, <span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">10</span>);

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">这时候就能成功插入</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">删除失败</span>
<span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">FROM</span> dept1
<span style="color:#66d9ef">WHERE</span> dept_id <span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>;
<span style="color:#75715e">-- ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`dbtest05`.`emp1`, CONSTRAINT `fk_emp1_dept_id` FOREIGN KEY (`department_id`) REFERENCES `dept1` (`dept_id`))
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">删除失败</span>, <span style="color:#960050;background-color:#1e0010">这是因为</span> emp1 <span style="color:#960050;background-color:#1e0010">中用到了</span>dept_id <span style="color:#960050;background-color:#1e0010">为</span> <span style="color:#ae81ff">10</span>, <span style="color:#960050;background-color:#1e0010">因此从表还关联着</span>, <span style="color:#960050;background-color:#1e0010">主表没办法删</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">更新失败</span>
<span style="color:#66d9ef">UPDATE</span> dept1
<span style="color:#66d9ef">SET</span> dept_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">20</span>
<span style="color:#66d9ef">WHERE</span> dept_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">10</span>;
<span style="color:#75715e">-- ERROR 1451 (23000): Cannot delete or update a parent row: a foreign key constraint fails (`dbtest05`.`emp1`, CONSTRAINT `fk_emp1_dept_id` FOREIGN KEY (`department_id`) REFERENCES `dept1` (`dept_id`))
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">与上面的道理是相同的</span>
</code></pre></div><p>约束关系时针对双方的:</p>
<ul>
<li>添加了外键约束后, 主表的修改和删除数据受约束</li>
<li>添加了外键约束后，从表的添加和修改数据受约束</li>
<li>在从表上建立外键，要求主表必须存在</li>
<li>删除主表时, 要求从表先删除，或将从表中外键引用该主表的关系先删除</li>
</ul>
<h4 id="67-约束等级">6.7 约束等级</h4>
<ul>
<li>Cascade 方式: 在父表上 update/delete 记录时, 同步 update/delete 掉子表的匹配记录, 更新跟着更新, 删除跟着删除</li>
<li>Set null 方式: 在父表上 update/delete 记录时, 同步将子表上匹配记录的列设为null, 但是要注意子表的外键列不能设置为 null, 更新和删除都是设为 null</li>
<li>No action 方式: 如果子表中有匹配的记录, 则不允许对父表相关记录进行 update/delete 操作</li>
<li>Restrict 方式: 同 No action, 都是立即检查外键约束</li>
<li>Set Default 方式: 父表有变更时, 子表将外键列设置成一个默认的值, 但是 innodb 不能识别</li>
</ul>
<p>如果没有指定约束等级, 就默认使用 Restrict 方式.</p>
<p>一般实际操作时采用: <code>ON UPDATE CASCADE ON DELETE RESTRICT</code> 的方式</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp3(
  eid INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
  ename VARCHAR(<span style="color:#ae81ff">15</span>),
  deptid INT,
  <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (deptid) <span style="color:#66d9ef">REFERENCES</span> dept(dept) <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">UPDATE</span> <span style="color:#66d9ef">CASCADE</span> <span style="color:#66d9ef">ON</span> <span style="color:#66d9ef">DELETE</span> <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">NULL</span>
);
</code></pre></div><h4 id="68-删除外键约束">6.8 删除外键约束</h4>
<p>一个表中可以有多个外键约束</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">建表结束后进行添加外键约束</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> dept2 (
  dept_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
  dept_name VARCHAR(<span style="color:#ae81ff">15</span>)
);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp2(
  emp_id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT, 
  emp_name VARCHAR(<span style="color:#ae81ff">15</span>),
  department_id INT
);

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;emp2&#34;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp2       <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">这时候只有一个主键约束</span>

<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> emp2
<span style="color:#66d9ef">ADD</span> <span style="color:#66d9ef">CONSTRAINT</span> fk_emp2_dept_id <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (department_id) <span style="color:#66d9ef">REFERENCES</span> dept2(dept_id);

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">然后看看</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.table_constraints
<span style="color:#66d9ef">WHERE</span> <span style="color:#66d9ef">table_name</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;emp2&#34;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp2       <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> fk_emp2_dept_id <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp2       <span style="color:#f92672">|</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">删除外键约束</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> emp1
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> fk_emp1_dept_id;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_CATALOG</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_SCHEMA</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">CONSTRAINT_NAME</span> <span style="color:#f92672">|</span> TABLE_SCHEMA <span style="color:#f92672">|</span> <span style="color:#66d9ef">TABLE_NAME</span> <span style="color:#f92672">|</span> CONSTRAINT_TYPE <span style="color:#f92672">|</span> ENFORCED <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> def                <span style="color:#f92672">|</span> dbtest05          <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span> dbtest05     <span style="color:#f92672">|</span> emp1       <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>     <span style="color:#f92672">|</span> YES      <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+-------------------+-----------------+--------------+------------+-----------------+----------+
</span><span style="color:#75715e"></span><span style="color:#960050;background-color:#1e0010">对应的外键就被删除了</span>

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">再手动删除外键约束对应的普通索引</span>
<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">INDEX</span> <span style="color:#66d9ef">FROM</span> emp1;
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+-----------------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span> <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name        <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span>   <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+-----------------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> emp1  <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>         <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> emp_id        <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>           <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emp1  <span style="color:#f92672">|</span>          <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> fk_emp1_dept_id <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> department_id <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>           <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+-----------------+--------------+---------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> emp1 
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">INDEX</span> fk_emp1_dept_id;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">根据外键约束名进行删除索引</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">Table</span> <span style="color:#f92672">|</span> Non_unique <span style="color:#f92672">|</span> Key_name <span style="color:#f92672">|</span> Seq_in_index <span style="color:#f92672">|</span> <span style="color:#66d9ef">Column_name</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Cardinality</span> <span style="color:#f92672">|</span> Sub_part <span style="color:#f92672">|</span> Packed <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> Index_type <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span> Index_comment <span style="color:#f92672">|</span> Visible <span style="color:#f92672">|</span> Expression <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> emp1  <span style="color:#f92672">|</span>          <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">PRIMARY</span>  <span style="color:#f92672">|</span>            <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> emp_id      <span style="color:#f92672">|</span> A         <span style="color:#f92672">|</span>           <span style="color:#ae81ff">0</span> <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>   <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#f92672">|</span> BTREE      <span style="color:#f92672">|</span>         <span style="color:#f92672">|</span>               <span style="color:#f92672">|</span> YES     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+---------+------------+
</span><span style="color:#75715e"></span>
</code></pre></div><h4 id="69-开发场景">6.9 开发场景</h4>
<ul>
<li>问题1: 如果两个表之间有关系(一对一、一对多)，比如: 员工表和部门表(一对多), 他们之间是否一定要建外键约束</li>
</ul>
<p>答: 不一定需要</p>
<ul>
<li>问题2: 建和不建外键约束有什么区别</li>
</ul>
<p>答: 建外键约束, 操作(创建表, 删除表, 添加, 修改, 删除) 会受到限制, 从语法层面受到限制. 例如: 在员工表中不能添加一个部门不存在的员工</p>
<p>不建外键约束, 操作(创建表, 删除表, 添加, 修改, 删除) 不受到限制, 保证数据的引用完整性只能依靠程序员的自觉, 或者是在 Java 程序中进行限制. 例如: 在员工表中可以添加一个员工信息, 他的部门指定为一个完全不存在的部门.</p>
<ul>
<li>问题3: 那么建和不建外键约束和查询有没有关系</li>
</ul>
<p>答: 没有</p>
<p>在 MySQL 里, 外键约束是有成本的, 需要消耗系统资源, 对于大并发的 SQL 操作, 有可能会不合适. 比如大型网站的中央数据库, 可能会因为外键约束导致系统开销而变得很慢. 所以, MySQL 允许不适用系统自带的外键约束, 在应用层面完成检查数据一致性的逻辑, 因此, 即使不使用外键约束, 也要想办法通过系统应用层面的附加逻辑, 来实现外键约束的功能, 确保数据的一致性</p>
<h4 id="610-阿里开发规范">6.10 阿里开发规范</h4>
<ul>
<li>[强制] 不得使用外键与级联, 一切外键概念必须在应用层面解决.</li>
</ul>
<p>说明: 学生表中的student_id 是主键, 那么成绩表中 student_id 则为外键, 如果更新学生表中的 student_id, 同时出发成绩表中的 student_id 更新, 即为级联更新. 外键与级联更新适用于单机低并发, 不适合使用于 分布式、高并发集群, 级联更新是强阻塞, 存在数据库更新风暴的风险, 外键影响数据库的插入速度.</p>
<h3 id="7-check-约束">7. CHECK 约束</h3>
<h4 id="71-作用">7.1 作用</h4>
<p>检查某个字段的值是否符合xx要求, 一般指的是值的范围.</p>
<h4 id="72-关键字">7.2 关键字</h4>
<p>CHECK</p>
<h4 id="73-说明">7.3 说明</h4>
<p>MySQL 5.7 不支持 check 约束, 就是你加了不会报错, 但是不起作用.</p>
<p>MySQL 8.0 中开始支持 check 约束了.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp4(
  id INT,
  last_name VARCHAR(<span style="color:#ae81ff">15</span>),
  salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">CHECK</span>(salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">2500</span>)
);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp4
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">2000</span>);
<span style="color:#75715e">-- ERROR 3819 (HY000): Check constraint &#39;emp4_chk_1&#39; is violated.
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp4
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">2500</span>);
<span style="color:#75715e">-- ERROR 3819 (HY000): Check constraint &#39;emp4_chk_1&#39; is violated.
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp4
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">10</span>,<span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">2501</span>);
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">添加成功</span>
</code></pre></div><h3 id="8-default-约束">8. DEFAULT 约束</h3>
<h4 id="81-作用">8.1 作用</h4>
<p>给某个字段指定默认值, 一旦设置默认值, 在插入数据时, 如果没有显示赋值, 则赋值为默认值.</p>
<h4 id="82-关键字">8.2 关键字</h4>
<p><code>DEFAULT</code></p>
<h4 id="83-如何给字段加默认值">8.3 如何给字段加默认值</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp5(
  id INT,
  last_name VARCHAR(<span style="color:#ae81ff">15</span>),
  salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">2000</span>
);

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp5
VALUE(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#34;luo&#34;</span>, <span style="color:#ae81ff">3000</span>);

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> emp5;
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id   <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> luo       <span style="color:#f92672">|</span> <span style="color:#ae81ff">3000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> emp5 (id, last_name)
<span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#34;ting&#34;</span>);
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id   <span style="color:#f92672">|</span> last_name <span style="color:#f92672">|</span> salary  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>    <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> luo       <span style="color:#f92672">|</span> <span style="color:#ae81ff">3000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>    <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> ting      <span style="color:#f92672">|</span> <span style="color:#ae81ff">2000</span>.<span style="color:#ae81ff">00</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">------+-----------+---------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emp6(
  id INT,
  last_name VARCHAR(<span style="color:#ae81ff">15</span>),
  salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>) 
);

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">增加默认值</span>
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> emp6
<span style="color:#66d9ef">MODIFY</span> salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#ae81ff">2000</span>;

</code></pre></div><h4 id="84-如何删除默认值约束">8.4 如何删除默认值约束</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">TABLE</span> emp6
<span style="color:#66d9ef">MODIFY</span> salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
</code></pre></div><h3 id="9-面试">9. 面试</h3>
<ul>
<li>问题1: 为什么建表时, 加 not null default &quot;&quot; 或 default 0</li>
</ul>
<p>答: 因为不想让表中出现 null 值</p>
<ul>
<li>问题2: 为什么不想要 null 值</li>
</ul>
<p>答: 1. 不好比较, null 是一种特殊值, 比较时只能用专门的 is null 和 is not null 来比较, 碰到运算符通常都返回 null</p>
<ul>
<li>问题3: 带 AUTO_INCREMENT 约束的字段值是从1开始的吗?</li>
</ul>
<p>在 MySQL 中, 默认AUTO_INCREMENT 的初始值是1, 每新增一条记录, 字段值自动加1. 设置自增属性的时候m 还可以指定第一条插入记录的自增字段的值, 这样插入的记录的自增字段值从初始值开始递增, 如在表中插入第一条记录, 同时指定 id 值为5, 则以后插入的记录的 id 值就会从 6 开始外伤增加, 添加主键约束时, 往往需要设置字段自动增加属性.</p>
<ul>
<li>问题4: 是不是每个表都可以任意选择存储引擎?</li>
</ul>
<p>外键约束(FOREIGN KEY) 不能跨引擎使用</p>
<p>MySQL 支持多种存储引擎. 每个表都可以指定一个不同的存储引擎, 需要注意的是: 外键约束是用来保证数据的参照完整性的, 如果表之间需要关联外键, 却指定了不同的存储引擎, 那么这些表之间是不能创建外键约束的, 所以说, 存储引擎的选择也不是完全随意的.</p>
<h2 id="14-视图">14. 视图</h2>
<h3 id="1-常见的数据库对象">1. 常见的数据库对象</h3>
<table>
<thead>
<tr>
<th>对象</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>表(table)</td>
<td>表是存储数据的逻辑单元, 由行和列组成, 列就是字段, 行就是记录</td>
</tr>
<tr>
<td>数据字典</td>
<td>就是系统表, 存放数据库相关信息的表. 系统表的数据通常由数据库系统维护, 程序员通常不应该修改, 只可查看</td>
</tr>
<tr>
<td>约束(constraint)</td>
<td>执行数据校验的规则, 用于保证数据完整性的规则</td>
</tr>
<tr>
<td>视图(VIEW)</td>
<td>一个或者多个数据表里的数据的逻辑显示, 视图并不存储数据</td>
</tr>
<tr>
<td>索引(INDEX)</td>
<td>用于提高查询性能, 相当于书的目录</td>
</tr>
<tr>
<td>存储过程(PROCEDURE)</td>
<td>用于完成一次完整的业务处理, 没有返回值, 但可通过传出参数将多个值传给调用环境</td>
</tr>
<tr>
<td>存储函数(FUNCTION)</td>
<td>用于完成一次特定的计算, 具有一个返回值</td>
</tr>
<tr>
<td>触发器(TRIGGER)</td>
<td>相当于一个事件监听器, 当数据库发生特定事件后, 触发器被处罚, 完成相应的处理</td>
</tr>
</tbody>
</table>
<h3 id="2-视图概念">2. 视图概念</h3>
<h4 id="21-为什么使用视图">2.1 为什么使用视图</h4>
<p>有时候我们想要给别人看表里部分字段的数据, 但是又不想通过维护一个子表的形式来实现, 因此我们可以使用视图, 因为视图的数据都还在原表里.</p>
<p>视图一方面可以帮我们使用表的一部分而不是所有的表, 另一方面也可以针对不同的用户制定不同的查询视图. 比图, 针对一个公司的销售人员, 我们只想给他看部分数据, 而某些特殊的数据,比如采购的价格, 则不会提供给他. 再比如, 人员薪酬是个敏感的字段, 那么只给某个级别以上的人员开放, 其他人的查询视图中则不提供这个字段.</p>
<h4 id="22-视图的理解">2.2 视图的理解</h4>
<ul>
<li>视图是一种虚拟表, 本身是不具有数据的, 占用很少的内存空间, 他是 SQL 中的一个重要概念.</li>
<li>视图建立再已有表的基础上, 视图依赖建立的这些表称为基表.</li>
<li>视图的创建和删除只影响视图本身, 不影响对应的基表. 但是当对视图中的数据进行增加、删除和修改操作时, 数据表中的数据会相应地发生变化, 反之亦然</li>
<li>向视图提供数据内容的语句为 SELECT 语句, 可以将视图理解为存储起来的 SELECT 语句
<ul>
<li>在数据库中, 视图不会保存数据, 数据真正保存在数据表中. 当对视图中的数据进行增加、删除和修改操作时, 数据表中的数据会相应地发生变化, 反之亦然.</li>
</ul>
</li>
<li>视图, 是向用户提供基表数据的另一种表现形式. 通常情况下, 小型项目的数据库可以不适用视图, 但是在大型项目中, 以及数据表比较复杂的情况下, 视图的价值就凸显出来了, 他可以帮助我们把经常查询的结果集放到虚拟表中, 提升使用效率. 理解和使用起来都非常方便.</li>
</ul>
<h3 id="3-创建视图">3. 创建视图</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> <span style="color:#960050;background-color:#1e0010">视图名</span> 
<span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">语句</span>;

</code></pre></div><h4 id="31-创建单表视图">3.1 创建单表视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">准备工作</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> dbtest14;

USE dbtest14;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> emps
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> atguigudb.employees;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> depts
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> 
<span style="color:#66d9ef">FROM</span> atguigudb.departments;


<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">针对于单表</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp1
<span style="color:#66d9ef">AS</span> 
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> emps;

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> vu_emp1;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp2
<span style="color:#66d9ef">AS</span> 
<span style="color:#66d9ef">SELECT</span> employee_id emp_id, last_name lname, salary <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">查询语句中字段的别名会作为视图中字段的名字出现</span>
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;


<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">小括号内的字段别名要与</span> <span style="color:#66d9ef">SELECT</span> <span style="color:#960050;background-color:#1e0010">的字段一一对应</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp2(emp_id, name, money_sal)
<span style="color:#66d9ef">AS</span> 
<span style="color:#66d9ef">SELECT</span> employee_id emp_id, last_name, salary 
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">WHERE</span> salary <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">10000</span>;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">查询各个部门的平均工资的一个视图</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">上面的情况是视图中的数据是原表中就有的</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">这里是视图中的字段是基表中没有对应的字段</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp_sal
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary)
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id;
</code></pre></div><h4 id="32-创建多表联合视图">3.2 创建多表联合视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp_dept1
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> e.employee_id, e.department_id, d.department_name
<span style="color:#66d9ef">FROM</span> emps e <span style="color:#66d9ef">LEFT</span> <span style="color:#66d9ef">JOIN</span> depts d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> vu_emp_dept;


<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">利用视图对数据进行格式化</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp_dept2
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> CONCAT(e.employee_id, <span style="color:#e6db74">&#34;号员工&#34;</span>) emp_id, e.last_name, e.salary, d.department_name
<span style="color:#66d9ef">FROM</span> emps e <span style="color:#66d9ef">JOIN</span> depts d
<span style="color:#66d9ef">ON</span> e.department_id <span style="color:#f92672">=</span> d.department_id;

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> vu_emp_dept2;
</code></pre></div><h4 id="33-基于视图创建视图">3.3 基于视图创建视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> emp_dept_ysalary
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> emp_dept.ename, dname, year_salary
<span style="color:#66d9ef">FROM</span> emp_dept <span style="color:#66d9ef">INNER</span> <span style="color:#66d9ef">JOIN</span> emp_year_salary
<span style="color:#66d9ef">ON</span> emp_dept.ename <span style="color:#f92672">=</span> emp_year_salary.ename;
</code></pre></div><h3 id="4-查看视图">4. 查看视图</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">查看数据库的表对象</span>, <span style="color:#960050;background-color:#1e0010">视图对象</span>
<span style="color:#66d9ef">SHOW</span> TABLES;

<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Tables_in_dbtest14 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> depts              <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emps               <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept        <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept1       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept2       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">查看视图的结构</span>
<span style="color:#66d9ef">DESC</span> vu_emp_dept2;
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field           <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> emp_id          <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">14</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name       <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary          <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> department_name <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">30</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-----------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">查看视图的属性信息</span>
<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">TABLE</span> STATUS <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;vu_emp_dept2&#39;</span>;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-----------+----------+----------------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Name         <span style="color:#f92672">|</span> Engine <span style="color:#f92672">|</span> <span style="color:#66d9ef">Version</span> <span style="color:#f92672">|</span> Row_format <span style="color:#f92672">|</span> <span style="color:#66d9ef">Rows</span> <span style="color:#f92672">|</span> Avg_row_length <span style="color:#f92672">|</span> Data_length <span style="color:#f92672">|</span> Max_data_length <span style="color:#f92672">|</span> Index_length <span style="color:#f92672">|</span> Data_free <span style="color:#f92672">|</span> Auto_increment <span style="color:#f92672">|</span> Create_time         <span style="color:#f92672">|</span> Update_time <span style="color:#f92672">|</span> Check_time <span style="color:#f92672">|</span> <span style="color:#66d9ef">Collation</span> <span style="color:#f92672">|</span> Checksum <span style="color:#f92672">|</span> Create_options <span style="color:#f92672">|</span> <span style="color:#66d9ef">Comment</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-----------+----------+----------------+---------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> vu_emp_dept2 <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>   <span style="color:#f92672">|</span>    <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>           <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>        <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>            <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>         <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>      <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span>           <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">17</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">33</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>       <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>      <span style="color:#f92672">|</span>     <span style="color:#66d9ef">NULL</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>           <span style="color:#f92672">|</span> <span style="color:#66d9ef">VIEW</span>    <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+--------+---------+------------+------+----------------+-------------+-----------------+--------------+-----------+----------------+---------------------+-------------+------------+-----------+----------+----------------+---------+
</span><span style="color:#75715e"></span>

<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">TABLE</span> STATUS <span style="color:#66d9ef">LIKE</span> <span style="color:#e6db74">&#39;vu_emp_dept2&#39;</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. <span style="color:#66d9ef">row</span> <span style="color:#f92672">***************************</span>
           Name: vu_emp_dept2
         Engine: <span style="color:#66d9ef">NULL</span>
        <span style="color:#66d9ef">Version</span>: <span style="color:#66d9ef">NULL</span>
     Row_format: <span style="color:#66d9ef">NULL</span>
           <span style="color:#66d9ef">Rows</span>: <span style="color:#66d9ef">NULL</span>
 Avg_row_length: <span style="color:#66d9ef">NULL</span>
    Data_length: <span style="color:#66d9ef">NULL</span>
Max_data_length: <span style="color:#66d9ef">NULL</span>
   Index_length: <span style="color:#66d9ef">NULL</span>
      Data_free: <span style="color:#66d9ef">NULL</span>
 Auto_increment: <span style="color:#66d9ef">NULL</span>
    Create_time: <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">17</span>:<span style="color:#ae81ff">21</span>:<span style="color:#ae81ff">33</span>
    Update_time: <span style="color:#66d9ef">NULL</span>
     Check_time: <span style="color:#66d9ef">NULL</span>
      <span style="color:#66d9ef">Collation</span>: <span style="color:#66d9ef">NULL</span>
       Checksum: <span style="color:#66d9ef">NULL</span>
 Create_options: <span style="color:#66d9ef">NULL</span>
        <span style="color:#66d9ef">Comment</span>: <span style="color:#66d9ef">VIEW</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

<span style="color:#f92672">#</span> <span style="color:#ae81ff">4</span>. <span style="color:#960050;background-color:#1e0010">查看视图的详细定义信息</span>
<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp_dept2;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> <span style="color:#66d9ef">View</span>         <span style="color:#f92672">|</span> <span style="color:#66d9ef">Create</span> <span style="color:#66d9ef">View</span>                                                                                                                                                                                                                                                                                                                                   <span style="color:#f92672">|</span> character_set_client <span style="color:#f92672">|</span> collation_connection <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> vu_emp_dept2 <span style="color:#f92672">|</span> <span style="color:#66d9ef">CREATE</span> ALGORITHM<span style="color:#f92672">=</span>UNDEFINED <span style="color:#66d9ef">DEFINER</span><span style="color:#f92672">=`</span>root<span style="color:#f92672">`@`</span>localhost<span style="color:#f92672">`</span> <span style="color:#66d9ef">SQL</span> <span style="color:#66d9ef">SECURITY</span> <span style="color:#66d9ef">DEFINER</span> <span style="color:#66d9ef">VIEW</span> <span style="color:#f92672">`</span>vu_emp_dept2<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> <span style="color:#66d9ef">select</span> concat(<span style="color:#f92672">`</span>e<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>employee_id<span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;号员工&#39;</span>) <span style="color:#66d9ef">AS</span> <span style="color:#f92672">`</span>emp_id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>e<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>last_name<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> <span style="color:#f92672">`</span>last_name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>e<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>salary<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> <span style="color:#f92672">`</span>salary<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>d<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>department_name<span style="color:#f92672">`</span> <span style="color:#66d9ef">AS</span> <span style="color:#f92672">`</span>department_name<span style="color:#f92672">`</span> <span style="color:#66d9ef">from</span> (<span style="color:#f92672">`</span>emps<span style="color:#f92672">`</span> <span style="color:#f92672">`</span>e<span style="color:#f92672">`</span> <span style="color:#66d9ef">join</span> <span style="color:#f92672">`</span>depts<span style="color:#f92672">`</span> <span style="color:#f92672">`</span>d<span style="color:#f92672">`</span> <span style="color:#66d9ef">on</span>((<span style="color:#f92672">`</span>e<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>department_id<span style="color:#f92672">`</span> <span style="color:#f92672">=</span> <span style="color:#f92672">`</span>d<span style="color:#f92672">`</span>.<span style="color:#f92672">`</span>department_id<span style="color:#f92672">`</span>))) <span style="color:#f92672">|</span> gbk                  <span style="color:#f92672">|</span> gbk_chinese_ci       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----------------------+----------------------+
</span><span style="color:#75715e"></span>

</code></pre></div><h3 id="5-更新视图的数据">5. 更新视图的数据</h3>
<p>针对视图中的数据进行DML操作, 会影响到基表中的数据</p>
<h4 id="51-一般情况">5.1 一般情况</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;

<span style="color:#66d9ef">UPDATE</span> vu_emp1
<span style="color:#66d9ef">SET</span> salary <span style="color:#f92672">=</span> <span style="color:#ae81ff">10000</span>
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kochhar&#39;</span>;

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;

<span style="color:#75715e">-- 发现修改成功
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">UPDATE</span> emps
<span style="color:#66d9ef">SET</span> salary <span style="color:#f92672">=</span> <span style="color:#ae81ff">20000</span>
<span style="color:#66d9ef">WHERE</span> last_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;Kochhar&#39;</span>;

<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary
<span style="color:#66d9ef">FROM</span> vu_emp1
<span style="color:#66d9ef">LIMIT</span> <span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">10</span>;

<span style="color:#75715e">-- 也修改成功
</span></code></pre></div><h4 id="52-不可更新的视图">5.2 不可更新的视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">有些视图的字段不是来自于基表的</span>, <span style="color:#960050;background-color:#1e0010">就有可能不能更新</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">VIEW</span> vu_emp_sal
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> department_id, <span style="color:#66d9ef">AVG</span>(salary) avg_sal
<span style="color:#66d9ef">FROM</span> emps
<span style="color:#66d9ef">WHERE</span> department_id <span style="color:#66d9ef">IS</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>
<span style="color:#66d9ef">GROUP</span> <span style="color:#66d9ef">BY</span> department_id;
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">比如这个</span>

<span style="color:#66d9ef">UPDATE</span> vu_emp_sal
<span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">AVG</span>(salary)<span style="color:#f92672">=</span><span style="color:#ae81ff">10000</span>
<span style="color:#66d9ef">WHERE</span> department_id<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>;
</code></pre></div><p>要使得视图可更新, 视图中的行和底层基本表中的行之间必须存在一对一的关系. 另外当视图定义出现如下情况时, 视图不支持更新操作:</p>
<ul>
<li>在定义视图的时候制定了 &ldquo;ALGORITHM = TEMPTABLE&rdquo;, 视图将不支持 INSERT 和 DELETE 操作</li>
<li>视图中不包含基表中所有被定义为非空又未指定默认值的列, 视图将不支持 INSERT 操作</li>
<li>在定义视图的 SELECT 语句中使用了 <code>JOIN 联合查询</code>, 视图将不支持 INSERT 和 DELETE 操作</li>
<li>在定义视图的 SELECT 语句后的字段列表中使用了 <code>数学表达式</code> 或 <code>子查询</code>, 视图将不支持 INSERT, 也不支持 UPDATE 使用了数学表达式、子查询的字段值.</li>
<li>在定义视图的 SELECT 语句后的字段列表中使用 DISTINCT 关键字, 聚合函数, GROUP BY, HAVING, UNION 等, 视图将不支持 INSERT, UPDATE, DELETE 操作</li>
<li>视图定义基于一个 <code>不可更新视图</code></li>
<li>常量视图</li>
</ul>
<h3 id="6-修改删除视图">6. 修改、删除视图</h3>
<h4 id="61-修改视图">6.1 修改视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">1</span>: <span style="color:#960050;background-color:#1e0010">使用</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">VIEW</span> <span style="color:#960050;background-color:#1e0010">子句修改视图</span>

<span style="color:#66d9ef">DESC</span> vu_emp1;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field       <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary      <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">OR</span> <span style="color:#66d9ef">REPLACE</span> <span style="color:#66d9ef">VIEW</span> vu_emp1
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, email
<span style="color:#66d9ef">FROM</span> emps;

<span style="color:#66d9ef">DESC</span> vu_emp1;
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field       <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name   <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary      <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> email       <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">-------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">方式</span><span style="color:#ae81ff">2</span>: 
<span style="color:#66d9ef">ALTER</span> <span style="color:#66d9ef">VIEW</span> vu_emp1
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> employee_id, last_name, salary, email, phone_number
<span style="color:#66d9ef">FROM</span> emps;

<span style="color:#66d9ef">DESC</span> vu_emp1;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Field        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Type</span>        <span style="color:#f92672">|</span> <span style="color:#66d9ef">Null</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Key</span> <span style="color:#f92672">|</span> <span style="color:#66d9ef">Default</span> <span style="color:#f92672">|</span> Extra <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> employee_id  <span style="color:#f92672">|</span> int         <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#ae81ff">0</span>       <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> last_name    <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> salary       <span style="color:#f92672">|</span> double(<span style="color:#ae81ff">8</span>,<span style="color:#ae81ff">2</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> email        <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">25</span>) <span style="color:#f92672">|</span> <span style="color:#66d9ef">NO</span>   <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> phone_number <span style="color:#f92672">|</span> varchar(<span style="color:#ae81ff">20</span>) <span style="color:#f92672">|</span> YES  <span style="color:#f92672">|</span>     <span style="color:#f92672">|</span> <span style="color:#66d9ef">NULL</span>    <span style="color:#f92672">|</span>       <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------+-------------+------+-----+---------+-------+
</span></code></pre></div><h4 id="62-删除视图">6.2 删除视图</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SHOW</span> TABLES;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Tables_in_dbtest14 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> depts              <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emps               <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp1            <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept        <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept1       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept2       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_sal         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">VIEW</span> vu_emp_dept2;

<span style="color:#66d9ef">SHOW</span> TABLES;
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> Tables_in_dbtest14 <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> depts              <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> emps               <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp1            <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept        <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_dept1       <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span> vu_emp_sal         <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">--------------------+
</span><span style="color:#75715e"></span>
<span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">VIEW</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">EXISTS</span> vu_emp_dept2;

</code></pre></div><p>说明: 基于视图a,b 创建了新的视图c, 如果将视图 a 或者视图 b 删除, 会导致视图 c 的查询失败, 这样的视图 c 需要手动删除或修改, 否则影响使用</p>
<h3 id="7-总结">7. 总结</h3>
<h4 id="71-视图优点">7.1 视图优点</h4>
<ol>
<li>操作简单</li>
</ol>
<p>将经常使用的查询操作定义为视图, 可以使开发人员不需要关心视图对应的数据表的结构, 表与表之间的关联关系, 也不需要关心数据表之间的业务逻辑和查询条件, 而只需要简单地操作视图即可, 极大简化了开发人员对数据的操作</p>
<ol start="2">
<li>减少数据冗余</li>
</ol>
<p>视图与实际的数据表不一样, 它存储的式查询语句, 所以在使用的时候, 我们要通过定义视图的查询语句来获取结果集, 而是视图本身不存储数据, 不占用数据存储的资源, 减少了数据冗余</p>
<ol start="3">
<li>数据安全</li>
</ol>
<p>MySQL 将用户对数据的访问限制在某些数据的结果集上, 而这些数据的结果集可以使用试图来实现, 用户不必直接查询或操作数据表, 这也可以理解视图具有隔离性, 视图相当于在用户和实际的数据表之间加了一层虚拟表.</p>
<p>同时, MySQL 可以根据权限将用户对数据的访问限制在某些视图上, 用户不需要查询数据表, 可以直接通过视图获取数据表中的信息. 这在一定程度上保障了数据表中数据的安全性.</p>
<ol start="4">
<li>适应灵活多变的需求</li>
</ol>
<p>当业务系统的需求发生变化后, 如果需要修改数据表的结构, 则工作量较大, 因此可以使用视图来减少改动的工作量, 这种方式在实际工作中使用的比较多.</p>
<ol start="5">
<li>能够分解复杂的查询</li>
</ol>
<p>数据库中如果存在复杂的查询逻辑, 则可以将问题进行分解, 创建多个视图获取数据, 再将创建的多个视图结合起来, 完成复杂的查询逻辑</p>
<h4 id="72-视图不足">7.2 视图不足</h4>
<p>如果我们在实际数据表的接触上创建了视图, 那么, 如果实际数据表的结果变了, 我们就需要及时对相关的视图进行相应的维护. 特别是嵌套的视图, 维护会变的很复杂.</p>
<h2 id="15-存储过程与函数">15. 存储过程与函数</h2>
<p>MySQL 5.0 开始支持存储过程和函数. 存储过程和函数能够将复杂的 SQL 逻辑封装在一起, 应用程序无需关注存储过程的函数内部复杂的 SQL 逻辑, 而只需要简单地调用存储过程和函数即可.</p>
<p>就是用户自定义的函数.</p>
<h3 id="1-存储过程概述">1. 存储过程概述</h3>
<h4 id="11-理解">1.1 理解</h4>
<p>Stored Procedure, 存储过程, 是一组为了完成特定功能的 SQL 语句集, 存储在数据库中, 经过编译后存储在数据库中, 用户可以通过指定存储过程的名字并给出参数(如果该存储过程带有参数)来调用存储过程.</p>
<p>好处:</p>
<ol>
<li>简化操作, 提高了 SQL 语句的重用性, 减少了开发程序员的压力</li>
<li>减少操作过程中的失误, 提高效率</li>
<li>减少网络传输量(客户端不需要把所有的SQL语句通过网络发送给服务器)</li>
<li>减少了SQL语句暴露在网上的风险, 提高了数据查询的安全性.</li>
</ol>
<p>和视图、函数的对比</p>
<p>他和视图有相同的优点, 清晰, 安全, 还可以减少网络传输量. 不过视图是虚拟表, 通常不对底层数据表进行直接操作, 而存储过程时程序化的 SQL, 可以直接操作底层数据表, 相比于面向集合的操作方式, 能够实现一些更复杂的数据处理</p>
<p>一旦存储过程被创建出来, 使用起来就像使用函数一样简单, 直接通过调用存储过程名即可, 相较于函数, 存储过程是没有返回值的.</p>
<h4 id="12-分类">1.2 分类</h4>
<p>存储过程的参数类型可以是 IN, OUT, INOUT, 因此可以分为:</p>
<ul>
<li>没有参数(无参数无返回)</li>
<li>仅有 IN (有参数无返回)</li>
<li>仅有 OUT (无参数有返回)</li>
<li>既有 IN 又有 OUT (有参数有返回)</li>
<li>有 INOUT (有参数有返回)</li>
</ul>
<h3 id="2-创建存储过程">2. 创建存储过程</h3>
<p>跳过, 不使用这玩意</p>
<h4 id="21-语法分析">2.1 语法分析</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">PROCEDURE</span> <span style="color:#960050;background-color:#1e0010">存储过程名</span>(<span style="color:#66d9ef">IN</span><span style="color:#f92672">|</span><span style="color:#66d9ef">OUT</span><span style="color:#f92672">|</span><span style="color:#66d9ef">INOUT</span> <span style="color:#960050;background-color:#1e0010">参数名</span> <span style="color:#960050;background-color:#1e0010">数据类型</span>)
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">SQL</span> <span style="color:#960050;background-color:#1e0010">语句</span>;
<span style="color:#66d9ef">END</span>
</code></pre></div><h4 id="22-代码举例">2.2 代码举例</h4>
<h3 id="3-调用存储过程">3. 调用存储过程</h3>
<h4 id="31-调用格式">3.1 调用格式</h4>
<h4 id="32-代码举例">3.2 代码举例</h4>
<h4 id="33-如何调试">3.3 如何调试</h4>
<h3 id="4-存储函数的使用">4. 存储函数的使用</h3>
<h4 id="41-语法分析">4.1 语法分析</h4>
<h4 id="42-调用存储函数">4.2 调用存储函数</h4>
<h4 id="43-代码举例">4.3 代码举例</h4>
<h4 id="44-对比存储函数和存储过程">4.4 对比存储函数和存储过程</h4>
<h3 id="5-存储过程和函数的查看修改删除">5. 存储过程和函数的查看、修改、删除</h3>
<h4 id="51-查看">5.1 查看</h4>
<h4 id="52-修改">5.2 修改</h4>
<h4 id="53-删除">5.3 删除</h4>
<h3 id="6-关于存储过程使用的争议">6. 关于存储过程使用的争议</h3>
<h4 id="61-优点">6.1 优点</h4>
<h4 id="62-缺点">6.2 缺点</h4>
<h2 id="16-变量流程控制与游标">16. 变量、流程控制与游标</h2>
<p>和存储过程相关, 因此也跳过先</p>
<h2 id="17-触发器">17. 触发器</h2>
<p>在实际开发中, 我们经常会遇到这样的情况: 有 2 个或这多个相互关联的表, 如 商品信息 和 库存信息, 分别存放在 2 个不同的数据表中, 我们在添加一条新商品记录的时候, 为了保证数据的完整性, 必须同时在库存表中添加一条库存记录</p>
<p>这样一来, 我们就必须把这两个关联的操作步骤写道程序里面, 而且要用事务抱起来, 确保这两个操作成为一个原子操作, 要么全部执行, 要么全部不执行, 要是遇到特殊情况, 可能还要对数据进行手动维护, 这样就很容易忘记其中一步, 导致数据缺失</p>
<p>这个时候就可以使用触发器, 让商品信息数据的插入操作自动触发库存数据的插入操作, 这样一来, 就不用因为忘记添加库存数据而导致的数据缺失了.</p>
<h3 id="1-触发器概述">1. 触发器概述</h3>
<p>MySQL 5.0 开始支持, 嵌入到 MySQL 服务器中的一段程序</p>
<p>触发器是由某个事件来触发的某个操作, 这些事件包括 INSERT, UPDATE, DELETE 事件, 所谓事件就是指用户的动作或者触发某项行为, 如果定义了某个出发程序, 当数据库执行这些语句的时候, 就相当于事件发生了, 就会自动激发触发器执行相应的操作.</p>
<p>当对数据表中的数据执行插入、更新和删除操作, 需要自动执行一些数据库逻辑时, 就可以使用触发器来实现.</p>
<h3 id="2-触发器的创建">2. 触发器的创建</h3>
<h4 id="21-创建触发器语法">2.1 创建触发器语法</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> <span style="color:#960050;background-color:#1e0010">触发器名</span>
<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">BEFORE</span><span style="color:#f92672">|</span><span style="color:#66d9ef">AFTER</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">触发时机</span>
<span style="color:#960050;background-color:#1e0010">{</span><span style="color:#66d9ef">INSERT</span><span style="color:#f92672">|</span><span style="color:#66d9ef">UPDATE</span><span style="color:#f92672">|</span><span style="color:#66d9ef">DELETE</span><span style="color:#960050;background-color:#1e0010">}</span> <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">触发事件</span>
<span style="color:#66d9ef">ON</span> <span style="color:#960050;background-color:#1e0010">表名</span>
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
<span style="color:#960050;background-color:#1e0010">触发器执行的语句块</span>
</code></pre></div><ul>
<li>表名: 表示触发器监控的对象</li>
<li>BEFORE|AFTER: 表示触发器执行的时机, BEFORE 表示在触发事件之前执行, AFTER 表示在触发事件之后执行</li>
<li>INSERT|UPDATE|DELETE: 表示触发器监控的事件, INSERT 表示在插入数据之前或之后执行, UPDATE 表示在更新数据之前或之后执行, DELETE 表示在删除数据之前或之后执行</li>
<li>触发器执行的语句块: 触发器执行的具体操作, 可以是一条 SQL 语句, 也可以是一个代码块, 代码块使用 BEGIN 和 END 包裹</li>
</ul>
<h4 id="22-触发器代码举例">2.2 触发器代码举例</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> dbtest17;

USE dbtest17;

<span style="color:#f92672">#</span> <span style="color:#ae81ff">1</span>. <span style="color:#960050;background-color:#1e0010">创建数据表</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> test_trigger(
  id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
  t_note VARCHAR(<span style="color:#ae81ff">20</span>)
);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">EXISTS</span> test_trigger_log(
  id INT <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span> AUTO_INCREMENT,
  log VARCHAR(<span style="color:#ae81ff">30</span>)
);

<span style="color:#f92672">#</span> <span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">创建触发器</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">在</span>MySQL中<span style="color:#960050;background-color:#1e0010">，</span>DELIMITER是一个用于改变语句分隔符的命令<span style="color:#960050;background-color:#1e0010">。</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">默认情况下，</span>MySQL使用分号<span style="color:#960050;background-color:#1e0010">（</span>;<span style="color:#960050;background-color:#1e0010">）作为语句的分隔符，表示每个语句的结束。</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">而使用</span>DELIMITER命令<span style="color:#960050;background-color:#1e0010">，可以将分隔符改变为其他字符，以避免在语句中使用的分号与语句的分隔符冲突。</span>

<span style="color:#66d9ef">DELIMITER</span> <span style="color:#f92672">//</span>
<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> before_insert_trigger
<span style="color:#66d9ef">BEFORE</span> <span style="color:#66d9ef">INSERT</span>
<span style="color:#66d9ef">ON</span> test_trigger
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger_log(log)
  <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;插入数据之前触发&#39;</span>);
<span style="color:#66d9ef">END</span> <span style="color:#f92672">//</span>

<span style="color:#66d9ef">DELIMITER</span> ;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger(t_note)
<span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;test1&#39;</span>);

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> test_trigger_log;
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> log              <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">插入数据之前触发</span>  <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#ae81ff">2</span>. <span style="color:#960050;background-color:#1e0010">例子</span><span style="color:#ae81ff">2</span> 

<span style="color:#66d9ef">DELIMITER</span> <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> after_insert_trigger
<span style="color:#66d9ef">AFTER</span> <span style="color:#66d9ef">INSERT</span>
<span style="color:#66d9ef">ON</span> test_trigger
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger_log(log)
  <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;插入数据之后触发&#39;</span>);
<span style="color:#66d9ef">END</span> <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">DELIMITER</span> ;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger(t_note)
<span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;test2&#39;</span>);

<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> test_trigger_log;
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span> id <span style="color:#f92672">|</span> log              <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span><span style="color:#f92672">|</span>  <span style="color:#ae81ff">1</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">插入数据之前触发</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">2</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">插入数据之前触发</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">|</span>  <span style="color:#ae81ff">3</span> <span style="color:#f92672">|</span> <span style="color:#960050;background-color:#1e0010">插入数据之后触发</span> <span style="color:#f92672">|</span>
<span style="color:#f92672">+</span><span style="color:#75715e">----+------------------+
</span><span style="color:#75715e"></span>
<span style="color:#f92672">#</span> <span style="color:#ae81ff">3</span>. <span style="color:#960050;background-color:#1e0010">例子</span><span style="color:#ae81ff">3</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">定义触发器</span> salary_check_trigger, <span style="color:#960050;background-color:#1e0010">基于员工表</span> employees <span style="color:#960050;background-color:#1e0010">的</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#960050;background-color:#1e0010">事件</span>, <span style="color:#960050;background-color:#1e0010">在插入数据之前检查员工的工资是否大于他的领导的薪资</span>, <span style="color:#960050;background-color:#1e0010">如果大于领导薪资</span>, 
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">则报</span> sqlstate_value <span style="color:#960050;background-color:#1e0010">为</span> HY000 <span style="color:#960050;background-color:#1e0010">的错误</span>, <span style="color:#960050;background-color:#1e0010">从而使得添加失败</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> employees
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> atguigudb.employees;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> departments
<span style="color:#66d9ef">AS</span>
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span>
<span style="color:#66d9ef">FROM</span> atguigudb.departments;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">创建触发器</span>
<span style="color:#66d9ef">DELIMITER</span> <span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> salary_check_trigger
<span style="color:#66d9ef">BEFORE</span> <span style="color:#66d9ef">INSERT</span>
<span style="color:#66d9ef">ON</span> employees
<span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span>
<span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">DECLARE</span> leader_salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
  <span style="color:#66d9ef">SELECT</span> salary <span style="color:#66d9ef">INTO</span> leader_salary
  <span style="color:#66d9ef">FROM</span> employees
  <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">NEW</span>.manager_id;

  <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NEW</span>.salary <span style="color:#f92672">&gt;</span> leader_salary <span style="color:#66d9ef">THEN</span>
    SIGNAL <span style="color:#66d9ef">SQLSTATE</span> <span style="color:#e6db74">&#39;HY000&#39;</span>
    <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">MESSAGE_TEXT</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;员工工资不能大于领导工资&#39;</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
<span style="color:#66d9ef">END</span><span style="color:#960050;background-color:#1e0010">$</span>

<span style="color:#66d9ef">DELIMITER</span> ;

<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">测试</span>

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> employees(employee_id, last_name, email, hire_date, job_id, salary, manager_id)
<span style="color:#66d9ef">VALUES</span>(<span style="color:#ae81ff">207</span>, <span style="color:#e6db74">&#39;luo&#39;</span>, <span style="color:#e6db74">&#39;xxx@qq.com&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;AD_VP&#39;</span>, <span style="color:#ae81ff">10000</span>, <span style="color:#ae81ff">103</span>);
<span style="color:#f92672">#</span> ERROR <span style="color:#ae81ff">1644</span> (HY000): <span style="color:#960050;background-color:#1e0010">员工工资不能大于领导工资</span>

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> employees(employee_id, last_name, email, hire_date, job_id, salary, manager_id)
<span style="color:#66d9ef">VALUES</span>(<span style="color:#ae81ff">207</span>, <span style="color:#e6db74">&#39;luo&#39;</span>, <span style="color:#e6db74">&#39;xxx@qq.com&#39;</span>, <span style="color:#e6db74">&#39;2020-01-01&#39;</span>, <span style="color:#e6db74">&#39;AD_VP&#39;</span>, <span style="color:#ae81ff">8000</span>, <span style="color:#ae81ff">103</span>);
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">成功</span>
</code></pre></div><h3 id="3-查看删除触发器">3. 查看、删除触发器</h3>
<h4 id="31-查看触发器">3.1 查看触发器</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">SHOW</span> TRIGGERS;
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. <span style="color:#66d9ef">row</span> <span style="color:#f92672">***************************</span>
             <span style="color:#66d9ef">Trigger</span>: salary_check_trigger
               Event: <span style="color:#66d9ef">INSERT</span>
               <span style="color:#66d9ef">Table</span>: employees
           <span style="color:#66d9ef">Statement</span>: <span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">DECLARE</span> leader_salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
  <span style="color:#66d9ef">SELECT</span> salary <span style="color:#66d9ef">INTO</span> leader_salary
  <span style="color:#66d9ef">FROM</span> employees
  <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">NEW</span>.manager_id;

  <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NEW</span>.salary <span style="color:#f92672">&gt;</span> leader_salary <span style="color:#66d9ef">THEN</span>
    SIGNAL <span style="color:#66d9ef">SQLSTATE</span> <span style="color:#e6db74">&#39;HY000&#39;</span>
    <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">MESSAGE_TEXT</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;员工工资不能大于领导工资&#39;</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
<span style="color:#66d9ef">END</span>
              Timing: <span style="color:#66d9ef">BEFORE</span>
             Created: <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">05</span>.<span style="color:#ae81ff">86</span>
            sql_mode: ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
             <span style="color:#66d9ef">Definer</span>: root<span style="color:#f92672">@</span>localhost
character_set_client: gbk
collation_connection: gbk_chinese_ci
  <span style="color:#66d9ef">Database</span> <span style="color:#66d9ef">Collation</span>: utf8mb4_0900_ai_ci
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">2</span>. <span style="color:#66d9ef">row</span> <span style="color:#f92672">***************************</span>
             <span style="color:#66d9ef">Trigger</span>: before_insert_trigger
               Event: <span style="color:#66d9ef">INSERT</span>
               <span style="color:#66d9ef">Table</span>: test_trigger
           <span style="color:#66d9ef">Statement</span>: <span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger_log(log)
  <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;插入数据之前触发&#39;</span>);
<span style="color:#66d9ef">END</span>
              Timing: <span style="color:#66d9ef">BEFORE</span>
             Created: <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">34</span>:<span style="color:#ae81ff">33</span>.<span style="color:#ae81ff">40</span>
            sql_mode: ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
             <span style="color:#66d9ef">Definer</span>: root<span style="color:#f92672">@</span>localhost
character_set_client: gbk
collation_connection: gbk_chinese_ci
  <span style="color:#66d9ef">Database</span> <span style="color:#66d9ef">Collation</span>: utf8mb4_0900_ai_ci
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">3</span>. <span style="color:#66d9ef">row</span> <span style="color:#f92672">***************************</span>
             <span style="color:#66d9ef">Trigger</span>: after_insert_trigger
               Event: <span style="color:#66d9ef">INSERT</span>
               <span style="color:#66d9ef">Table</span>: test_trigger
           <span style="color:#66d9ef">Statement</span>: <span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> test_trigger_log(log)
  <span style="color:#66d9ef">VALUES</span>(<span style="color:#e6db74">&#39;插入数据之后触发&#39;</span>);
<span style="color:#66d9ef">END</span>
              Timing: <span style="color:#66d9ef">AFTER</span>
             Created: <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">37</span>:<span style="color:#ae81ff">10</span>.<span style="color:#ae81ff">83</span>
            sql_mode: ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
             <span style="color:#66d9ef">Definer</span>: root<span style="color:#f92672">@</span>localhost
character_set_client: gbk
collation_connection: gbk_chinese_ci
  <span style="color:#66d9ef">Database</span> <span style="color:#66d9ef">Collation</span>: utf8mb4_0900_ai_ci
<span style="color:#ae81ff">3</span> <span style="color:#66d9ef">rows</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

<span style="color:#f92672">#</span> <span style="color:#ae81ff">2</span>.
<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> salary_check_trigger<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
<span style="color:#f92672">***************************</span> <span style="color:#ae81ff">1</span>. <span style="color:#66d9ef">row</span> <span style="color:#f92672">***************************</span>
               <span style="color:#66d9ef">Trigger</span>: salary_check_trigger
              sql_mode: ONLY_FULL_GROUP_BY,STRICT_TRANS_TABLES,NO_ZERO_IN_DATE,NO_ZERO_DATE,ERROR_FOR_DIVISION_BY_ZERO,NO_ENGINE_SUBSTITUTION
<span style="color:#66d9ef">SQL</span> Original <span style="color:#66d9ef">Statement</span>: <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DEFINER</span><span style="color:#f92672">=`</span>root<span style="color:#f92672">`@`</span>localhost<span style="color:#f92672">`</span> <span style="color:#66d9ef">TRIGGER</span> <span style="color:#f92672">`</span>salary_check_trigger<span style="color:#f92672">`</span> <span style="color:#66d9ef">BEFORE</span> <span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">ON</span> <span style="color:#f92672">`</span>employees<span style="color:#f92672">`</span> <span style="color:#66d9ef">FOR</span> <span style="color:#66d9ef">EACH</span> <span style="color:#66d9ef">ROW</span> <span style="color:#66d9ef">BEGIN</span>
  <span style="color:#66d9ef">DECLARE</span> leader_salary DECIMAL(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">2</span>);
  <span style="color:#66d9ef">SELECT</span> salary <span style="color:#66d9ef">INTO</span> leader_salary
  <span style="color:#66d9ef">FROM</span> employees
  <span style="color:#66d9ef">WHERE</span> employee_id <span style="color:#f92672">=</span> <span style="color:#66d9ef">NEW</span>.manager_id;

  <span style="color:#66d9ef">IF</span> <span style="color:#66d9ef">NEW</span>.salary <span style="color:#f92672">&gt;</span> leader_salary <span style="color:#66d9ef">THEN</span>
    SIGNAL <span style="color:#66d9ef">SQLSTATE</span> <span style="color:#e6db74">&#39;HY000&#39;</span>
    <span style="color:#66d9ef">SET</span> <span style="color:#66d9ef">MESSAGE_TEXT</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;员工工资不能大于领导工资&#39;</span>;
  <span style="color:#66d9ef">END</span> <span style="color:#66d9ef">IF</span>;
<span style="color:#66d9ef">END</span>
  character_set_client: gbk
  collation_connection: gbk_chinese_ci
    <span style="color:#66d9ef">Database</span> <span style="color:#66d9ef">Collation</span>: utf8mb4_0900_ai_ci
               Created: <span style="color:#ae81ff">2024</span><span style="color:#f92672">-</span><span style="color:#ae81ff">03</span><span style="color:#f92672">-</span><span style="color:#ae81ff">24</span> <span style="color:#ae81ff">19</span>:<span style="color:#ae81ff">44</span>:<span style="color:#ae81ff">05</span>.<span style="color:#ae81ff">86</span>
<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">row</span> <span style="color:#66d9ef">in</span> <span style="color:#66d9ef">set</span> (<span style="color:#ae81ff">0</span>.<span style="color:#ae81ff">00</span> sec)

<span style="color:#f92672">#</span> <span style="color:#ae81ff">3</span>. 
<span style="color:#66d9ef">SELECT</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">FROM</span> information_schema.triggers<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
<span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">太长了</span>, <span style="color:#960050;background-color:#1e0010">就不再复制了</span>, <span style="color:#960050;background-color:#1e0010">还有别的数据库的触发器</span>

</code></pre></div><h4 id="32-删除触发器">3.2 删除触发器</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">DROP</span> <span style="color:#66d9ef">TRIGGER</span> salary_check_trigger;

<span style="color:#66d9ef">SHOW</span> <span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TRIGGER</span> salary_check_trigger<span style="color:#960050;background-color:#1e0010">\</span><span style="color:#66d9ef">G</span>
ERROR <span style="color:#ae81ff">1360</span> (HY000): <span style="color:#66d9ef">Trigger</span> does <span style="color:#66d9ef">not</span> exist
</code></pre></div><h3 id="4-触发器的优缺点">4. 触发器的优缺点</h3>
<h4 id="41-优点">4.1 优点</h4>
<ol>
<li>可以保证数据的完整性</li>
<li>触发器可以帮助我们记录操作日志</li>
<li>触发器还可以用在操作数据前, 对数据进行合法性检查</li>
</ol>
<h4 id="42-缺点">4.2 缺点</h4>
<ol>
<li>触发器会导致可读性差, 容易找不到问题</li>
<li>相关数据的变更, 可能会导致触发器出错</li>
</ol>
<h4 id="43-注意点">4.3 注意点</h4>
<p>如果再子表中定义了外键约束, 并且外键制定了 ON UPDATE/DELETE CASCADE/SET NULL 子句, 此时修改父表被引用的键值或者删除父表被引用的记录行时, 也会引起子表的修改和删除操作, 此时基于子表的UPDATE 和DELETE语句定义的出发其并不会被激活. 这是因为外键约束的级别高于触发器的级别.</p>
<h2 id="18-mysql8其他新特性">18. MySQL8其他新特性</h2>
<h3 id="1-mysql-8-新特性概述">1. MySQL 8 新特性概述</h3>
<h4 id="11-mysql-80-新增特性">1.1 MySQL 8.0 新增特性</h4>
<ol>
<li>更简便的 NoSQL 支持</li>
<li>更好的索引</li>
<li>更好的 JSON 支持</li>
<li>安全和账户管理</li>
<li>InnoDB的变化</li>
<li>数据字典</li>
<li>原子数据定义语句</li>
<li>资源管理</li>
<li>字符集支持</li>
<li>优化器增强</li>
<li>共用表表达式</li>
<li>窗口函数</li>
<li>正则表达式支持</li>
<li>内部临时表</li>
<li>日志记录</li>
<li>备份锁</li>
<li>增强的MySQL复制</li>
</ol>
<h4 id="12-mysql-80-移除的旧特性">1.2 MySQL 8.0 移除的旧特性</h4>
<ol>
<li>查询缓存
<ol>
<li>语句</li>
<li>系统变量</li>
<li>状态变量</li>
<li>线程状态</li>
</ol>
</li>
<li>加密相关的函数</li>
<li>空间函数相关</li>
<li>\N和NULL</li>
<li>mysql_install_db</li>
<li>通用分区处理程序</li>
<li>系统和状态变量信息</li>
<li>mysql_plugin 工具</li>
</ol>
<h3 id="2-新特性1-窗口函数">2. 新特性1: 窗口函数</h3>
<h4 id="21-使用窗口函数前后对比">2.1 使用窗口函数前后对比</h4>
<h4 id="22-窗口函数分类">2.2 窗口函数分类</h4>
<ol>
<li>静态窗口函数</li>
<li>动态窗口函数</li>
</ol>
<h4 id="23-语法结构">2.3 语法结构</h4>
<h4 id="24-分类讲解">2.4 分类讲解</h4>
<ol>
<li>序号函数</li>
<li>分布函数</li>
<li>前后函数</li>
<li>首位函数</li>
<li>其他函数</li>
</ol>
<h4 id="25-小结">2.5 小结</h4>
<h3 id="3-新特性2-公式表表达式">3. 新特性2: 公式表表达式</h3>
<h4 id="31-普通公用表表达式">3.1 普通公用表表达式</h4>
<h4 id="32-什么是递归公用表表达式">3.2 什么是递归公用表表达式</h4>
<h3 id="33-小结">3.3 小结</h3>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
