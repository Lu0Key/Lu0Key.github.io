<!doctype html>
<html lang="en-us">
  <head>
    <title>Mybatis // 洛七的摸鱼池塘</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.81.0" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="洛七" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/css/main.min.0fb49e70a30412f97ddfc418e18fefef1d9fcdebe45f634dbbba768b00fe1eec.css" />
    

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Mybatis"/>
<meta name="twitter:description" content="MyBatis MyBatis官网
简介 什么是MaBatis？  MyBatis 是一款优秀的持久层框架 它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。  如何获得MyBatis？
 github maven  &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.2&lt;/version&gt; &lt;/dependency&gt; 持久化 数据持久化
 持久化就是将程序的数据在持久状态和瞬时状态转化的过程 内存：断电即失 数据库(JDBC)、IO文件持久化  为什么需要持久化？
 有一些数据，不能让他丢掉 内存太贵了  持久层  完成持久化工作的代码块 层界限十分明显  为什么需要MyBatis？  方便 传统的JDBC代码太复杂了。简化，框架 帮助程序员将数据存入到数据库中 不用MyBatis也可以，MyBatis更容易上手。技术没有高低之分 优点  sql和代码分离 更容易单元测试 提供xml标签，支持编写动态sql    最重要的一点：使用的人多"/>

    <meta property="og:title" content="Mybatis" />
<meta property="og:description" content="MyBatis MyBatis官网
简介 什么是MaBatis？  MyBatis 是一款优秀的持久层框架 它支持自定义 SQL、存储过程以及高级映射。 MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。 MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。  如何获得MyBatis？
 github maven  &lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt; &lt;dependency&gt; &lt;groupId&gt;org.mybatis&lt;/groupId&gt; &lt;artifactId&gt;mybatis&lt;/artifactId&gt; &lt;version&gt;3.5.2&lt;/version&gt; &lt;/dependency&gt; 持久化 数据持久化
 持久化就是将程序的数据在持久状态和瞬时状态转化的过程 内存：断电即失 数据库(JDBC)、IO文件持久化  为什么需要持久化？
 有一些数据，不能让他丢掉 内存太贵了  持久层  完成持久化工作的代码块 层界限十分明显  为什么需要MyBatis？  方便 传统的JDBC代码太复杂了。简化，框架 帮助程序员将数据存入到数据库中 不用MyBatis也可以，MyBatis更容易上手。技术没有高低之分 优点  sql和代码分离 更容易单元测试 提供xml标签，支持编写动态sql    最重要的一点：使用的人多" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://Lu0key.github.io/post/mybatis/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-02-15T22:05:30&#43;08:00" />
<meta property="article:modified_time" content="2021-02-15T22:05:30&#43;08:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://Lu0key.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="洛七" /></a>
      <span class="app-header-title">洛七的摸鱼池塘</span>
      <nav class="app-header-menu">
          <a class="app-header-menu-item" href="/tags/">Tags</a>
      </nav>
      <p>即将没书读的咸鱼</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Mybatis</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 15, 2021
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          10 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://Lu0key.github.io/tags/mybatis/">MyBatis</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="mybatis">MyBatis</h1>
<p><a href="https://mybatis.org/mybatis-3/zh/index.html">MyBatis官网</a></p>
<h2 id="简介">简介</h2>
<h3 id="什么是mabatis">什么是MaBatis？</h3>
<ul>
<li>MyBatis 是一款优秀的持久层框架</li>
<li>它支持自定义 SQL、存储过程以及高级映射。</li>
<li>MyBatis 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</li>
<li>MyBatis 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 Java POJO（Plain Old Java Objects，普通老式 Java 对象）为数据库中的记录。</li>
</ul>
<p>如何获得MyBatis？</p>
<ul>
<li>github</li>
<li><a href="https://mvnrepository.com/">maven</a></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</span>
<span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.mybatis<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>mybatis<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>3.5.2<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><h3 id="持久化">持久化</h3>
<p>数据持久化</p>
<ul>
<li>持久化就是将程序的数据在持久状态和瞬时状态转化的过程</li>
<li>内存：断电即失</li>
<li>数据库(JDBC)、IO文件持久化</li>
</ul>
<p>为什么需要持久化？</p>
<ul>
<li>有一些数据，不能让他丢掉</li>
<li>内存太贵了</li>
</ul>
<h3 id="持久层">持久层</h3>
<ul>
<li>完成持久化工作的代码块</li>
<li>层界限十分明显</li>
</ul>
<h3 id="为什么需要mybatis">为什么需要MyBatis？</h3>
<ul>
<li>方便</li>
<li>传统的JDBC代码太复杂了。简化，框架</li>
<li>帮助程序员将数据存入到数据库中</li>
<li>不用MyBatis也可以，MyBatis更容易上手。技术没有高低之分</li>
<li>优点
<ul>
<li>sql和代码分离</li>
<li>更容易单元测试</li>
<li>提供xml标签，支持编写动态sql</li>
</ul>
</li>
</ul>
<p>最重要的一点：使用的人多</p>
<h2 id="第一个mybatis程序">第一个MyBatis程序</h2>
<p>思路：搭建环境&ndash;&gt;导入MyBatis&ndash;&gt;编写代码&ndash;&gt;测试</p>
<h3 id="搭建环境">搭建环境</h3>
<p>搭建数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#f92672">`</span>mybatis<span style="color:#f92672">`</span>;

USE <span style="color:#f92672">`</span>mysqtis<span style="color:#f92672">`</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>(
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>pwd<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>
)ENGINE<span style="color:#f92672">=</span>INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>pwd<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;你好&#39;</span>,<span style="color:#e6db74">&#39;123231&#39;</span>),
(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;asd&#39;</span>,<span style="color:#e6db74">&#39;adsas&#39;</span>),
(<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;aaaaa&#39;</span>,<span style="color:#e6db74">&#39;aaasd123&#39;</span>)
</code></pre></div><p>新建一个项目</p>
<ol>
<li>先建一个普通maven项目</li>
<li>删除src目录，作为父工程(这样子项目不要重复导包)</li>
<li>导入maven依赖</li>
</ol>
<h3 id="创建一个模块">创建一个模块</h3>
<ul>
<li>编写MyBatis核心配置文件</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE configuration
</span><span style="color:#75715e">        PUBLIC &#34;-//mybatis.org//DTD Config 3.0//EN&#34;
</span><span style="color:#75715e">        &#34;http://mybatis.org/dtd/mybatis-3-config.dtd&#34;&gt;</span>
<span style="color:#75715e">&lt;!--核心配置文件--&gt;</span>
<span style="color:#f92672">&lt;configuration&gt;</span>

    <span style="color:#f92672">&lt;environments</span> <span style="color:#a6e22e">default=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;environment</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;development&#34;</span><span style="color:#f92672">&gt;</span>
            <span style="color:#f92672">&lt;transactionManager</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;JDBC&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;dataSource</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;POOLED&#34;</span><span style="color:#f92672">&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;driver&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;com.mysql.jdbc.Driver&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;url&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;jdbc:mysql://localhost:3306/mybatis?userSSL=false&amp;amp;useUnicode=true&amp;amp;characterEncoding=UTF-8&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;username&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;root&#34;</span><span style="color:#f92672">/&gt;</span>
                <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;password&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;123456&#34;</span><span style="color:#f92672">/&gt;</span>
            <span style="color:#f92672">&lt;/dataSource&gt;</span>
        <span style="color:#f92672">&lt;/environment&gt;</span>
    <span style="color:#f92672">&lt;/environments&gt;</span>

<span style="color:#f92672">&lt;/configuration&gt;</span>
</code></pre></div><ul>
<li>编写mybatis工具类</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#75715e">// sqlSessionFactory --&gt; sqlSession
</span><span style="color:#75715e"></span><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">MybatisUtils</span> <span style="color:#f92672">{</span>

    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">static</span> SqlSessionFactory sqlSessionFactory<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">static</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">try</span><span style="color:#f92672">{</span>
            String resource <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;mybatis-config.xml&#34;</span><span style="color:#f92672">;</span>
            InputStream inputStream <span style="color:#f92672">=</span> Resources<span style="color:#f92672">.</span><span style="color:#a6e22e">getResourceAsStream</span><span style="color:#f92672">(</span>resource<span style="color:#f92672">);</span>
            sqlSessionFactory <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> SqlSessionFactoryBuilder<span style="color:#f92672">().</span><span style="color:#a6e22e">build</span><span style="color:#f92672">(</span>inputStream<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span><span style="color:#66d9ef">catch</span> <span style="color:#f92672">(</span>IOException e<span style="color:#f92672">){</span>
            e<span style="color:#f92672">.</span><span style="color:#a6e22e">printStackTrace</span><span style="color:#f92672">();</span>
        <span style="color:#f92672">}</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// 既然有个sqlSessionFactory，顾名思义，我们就可以从中获得sqlSession 的实例了
</span><span style="color:#75715e"></span>    <span style="color:#75715e">// sqlSession 完全包含了面向数据库执行 SQL 命令所需的所有方法
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> SqlSession <span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">(){</span>
        <span style="color:#66d9ef">return</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="编写代码">编写代码</h3>
<ul>
<li>实体类</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> com.luo.pojo<span style="color:#f92672">;</span>

<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String pwd<span style="color:#f92672">;</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">,</span> String name<span style="color:#f92672">,</span> String pwd<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pwd</span> <span style="color:#f92672">=</span> pwd<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">getId</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setId</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">id</span> <span style="color:#f92672">=</span> id<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getName</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setName</span><span style="color:#f92672">(</span>String name<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">name</span> <span style="color:#f92672">=</span> name<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">getPwd</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> pwd<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">setPwd</span><span style="color:#f92672">(</span>String pwd<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">this</span><span style="color:#f92672">.</span><span style="color:#a6e22e">pwd</span> <span style="color:#f92672">=</span> pwd<span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>

    <span style="color:#a6e22e">@Override</span>
    <span style="color:#66d9ef">public</span> String <span style="color:#a6e22e">toString</span><span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
        <span style="color:#66d9ef">return</span> <span style="color:#e6db74">&#34;User{&#34;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;id=&#34;</span> <span style="color:#f92672">+</span> id <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, name=&#39;&#34;</span> <span style="color:#f92672">+</span> name <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#34;, pwd=&#39;&#34;</span> <span style="color:#f92672">+</span> pwd <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;\&#39;&#39;</span> <span style="color:#f92672">+</span>
                <span style="color:#e6db74">&#39;}&#39;</span><span style="color:#f92672">;</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>Dao接口</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">interface</span> <span style="color:#a6e22e">UserDao</span> <span style="color:#f92672">{</span>
    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getUserList</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><ul>
<li>接口实现类
👉原来的UserDaoImpl转变为一个Mapper配置文件</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34; ?&gt;</span>
<span style="color:#75715e">&lt;!DOCTYPE mapper
</span><span style="color:#75715e">        PUBLIC &#34;-//mybatis.org//DTD Mapper 3.0//EN&#34;
</span><span style="color:#75715e">        &#34;http://mybatis.org/dtd/mybatis-3-mapper.dtd&#34;&gt;</span>
<span style="color:#75715e">&lt;!-- namespace=绑定一个对应的Dao/Mapper 接口--&gt;</span>
<span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">namespace=</span><span style="color:#e6db74">&#34;com.luo.dao.UserDao&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">&lt;!--select查询语句--&gt;</span>
    <span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserList&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span> <span style="color:#f92672">&gt;</span>
        select * from mybatis.user
    <span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;/mapper&gt;</span>
</code></pre></div><h3 id="测试">测试</h3>
<p>注意点：</p>
<pre><code>org.apache.ibatis.binding.BindingException: Type interface com.luo.dao.UserDao is not known to the MapperRegistry
</code></pre><p>MapperRegistry是什么？
在核心配置文件中注册mappers
在<code>mybatis-config.xml</code>的configuration中加入</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">    <span style="color:#f92672">&lt;mappers&gt;</span>
        <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;com/luo/dao/UserMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/mappers&gt;</span>
</code></pre></div><p>资源过滤问题</p>
<pre><code>Could not find resource com/luo/dao/UserMapper.xml
</code></pre><p>我们写的配置文件，无法被导出或者生效，解决方案为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!-- 在build中配置resources，防止出现资源导出失败 --&gt;</span>
<span style="color:#f92672">&lt;build&gt;</span>
    <span style="color:#f92672">&lt;resources&gt;</span>
        <span style="color:#f92672">&lt;resource&gt;</span>
            <span style="color:#f92672">&lt;directory&gt;</span>src/main/resources<span style="color:#f92672">&lt;/directory&gt;</span>
            <span style="color:#f92672">&lt;includes&gt;</span>
                <span style="color:#f92672">&lt;include&gt;</span>**/*.properties<span style="color:#f92672">&lt;/include&gt;</span>
                <span style="color:#f92672">&lt;include&gt;</span>**/*.xml<span style="color:#f92672">&lt;/include&gt;</span>
            <span style="color:#f92672">&lt;/includes&gt;</span>
            <span style="color:#f92672">&lt;filtering&gt;</span>true<span style="color:#f92672">&lt;/filtering&gt;</span>
        <span style="color:#f92672">&lt;/resource&gt;</span>
        <span style="color:#f92672">&lt;resource&gt;</span>
            <span style="color:#f92672">&lt;directory&gt;</span>src/main/java<span style="color:#f92672">&lt;/directory&gt;</span>
            <span style="color:#f92672">&lt;includes&gt;</span>
                <span style="color:#f92672">&lt;include&gt;</span>**/*.properties<span style="color:#f92672">&lt;/include&gt;</span>
                <span style="color:#f92672">&lt;include&gt;</span>**/*.xml<span style="color:#f92672">&lt;/include&gt;</span>
            <span style="color:#f92672">&lt;/includes&gt;</span>
            <span style="color:#f92672">&lt;filtering&gt;</span>true<span style="color:#f92672">&lt;/filtering&gt;</span>
        <span style="color:#f92672">&lt;/resource&gt;</span>
    <span style="color:#f92672">&lt;/resources&gt;</span>
<span style="color:#f92672">&lt;/build&gt;</span>
</code></pre></div><p>遇到的几个问题</p>
<ol>
<li></li>
</ol>
<pre><code>1字节的UTF-8序列的字节1无效
</code></pre><p>解决方法：</p>
<pre><code>把每个xml上面的encoding的UTF-8改成UTF8
</code></pre><ol start="2">
<li></li>
</ol>
<pre><code>The server time zone value '�й���׼ʱ��' is unrecognized or represents more than one time zone. You must configure either the server or JDBC driver (via the serverTimezone configuration property) to use a more specifc time zone value if you want to utilize time zone support.
</code></pre><p>解决方法</p>
<pre><code>在配置mybatis-config的时候url加上时区信息&amp;amp;serverTimezone=UTC
</code></pre><ol start="3">
<li></li>
</ol>
<pre><code>Loading class `com.mysql.jdbc.Driver'. This is deprecated. The new driver class is `com.mysql.cj.jdbc.Driver'. The driver is automatically registered via the SPI and manual loading of the driver class is generally unnecessary.
</code></pre><p>解决办法：</p>
<pre><code>这是因为mysql8 换驱动了，在mybatis-config中把driver从com.mysql.jdbc.Driver改成com.mysql.cj.jdbc.Driver即可
</code></pre><ul>
<li>junit测试</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">UserDaoTest</span> <span style="color:#f92672">{</span>

    <span style="color:#a6e22e">@Test</span>
    <span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(){</span>

        <span style="color:#75715e">// 获得SqlSession对象
</span><span style="color:#75715e"></span>        SqlSession sqlSession <span style="color:#f92672">=</span> MybatisUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>


        <span style="color:#75715e">// 执行Sql
</span><span style="color:#75715e"></span>        UserDao userDao <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>UserDao<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
        List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> userList <span style="color:#f92672">=</span> userDao<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserList</span><span style="color:#f92672">();</span>

        <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>User user <span style="color:#f92672">:</span> userList<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
            System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
        <span style="color:#f92672">}</span>
        <span style="color:#75715e">// 关闭SqlSession
</span><span style="color:#75715e"></span>        sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><h2 id="crud">CRUD</h2>
<p>一般在使用MaBatis的时候不说Dao而是说Mapper，因此将UserDao改成UserMapper</p>
<h3 id="namespace">namespace</h3>
<p>namespace中的包名要和Dao/mapper接口的包名一致</p>
<h3 id="select">select</h3>
<p>选择，查询语句</p>
<ul>
<li>id：就是对应的namespace中的方法名</li>
<li>resultType：sql语句执行的返回值</li>
<li>parameterType：参数类型</li>
</ul>
<p><strong>增删改需要提交事务</strong>：sqlSession.commit();</p>
<ol>
<li>编写接口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#75715e">// 根据Id查询用户
</span><span style="color:#75715e"></span>User <span style="color:#a6e22e">getUserById</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> id<span style="color:#f92672">);</span>
</code></pre></div><ol start="2">
<li>编写对应的mapper中的sql语句</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserById&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span><span style="color:#f92672">&gt;</span>
    select * from mybatis.user where id = #{id}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><ol start="3">
<li>测试</li>
</ol>
<h3 id="insert">Insert</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;insert</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;addUser&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span><span style="color:#f92672">&gt;</span>
    insert into mybatis.user (id, name, pwd) values (#{id},#{name},#{pwd})
<span style="color:#f92672">&lt;/insert&gt;</span>
</code></pre></div><h3 id="update">update</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;update</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;updateUser&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span><span style="color:#f92672">&gt;</span>
    update mybatis.user
    set name = #{name},pwd = #{pwd}
    where id = #{id};
<span style="color:#f92672">&lt;/update&gt;</span>
</code></pre></div><h3 id="delete">Delete</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;delete</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;deleteUser&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span><span style="color:#f92672">&gt;</span>
    delete from mybatis.user where id = #{id};
<span style="color:#f92672">&lt;/delete&gt;</span>
</code></pre></div><p>注意点：增删改需要提交事务</p>
<h3 id="map">Map</h3>
<p>假设，我们的实体类，或者数据库中表，字段或者参数过多，我们应当考虑使用Map，比如修改密码，我们只需要传id和新密码即可，这时候我们用Map比User类更方便</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;update</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;updateUser&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span><span style="color:#f92672">&gt;</span>
    update mybatis.user
    set name = #{name},pwd = #{pwd}
    where id = #{id};
<span style="color:#f92672">&lt;/update&gt;</span>
</code></pre></div><p>如果用的是User，那么必须字段要和User的对应，如果是map，那字段可以按自己的想法设置<br>
Map传递参数，直接在sql中取出key即可<br>
对象传递参数，直接在sql中取出对象的属性即可<br>
只有一个基本类型参数的情况下，可以直接在sql中取到<br>
多个参数用Map，或者注解</p>
<h3 id="思考题">思考题</h3>
<p>如何写模糊查询？</p>
<ol>
<li>Java传递的时候拼接通配符%%</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> userList <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserLike</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;%张%&#34;</span><span style="color:#f92672">);</span>
</code></pre></div><ol start="2">
<li>在SQL拼接中使用通配符</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserLike&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;String&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span><span style="color:#f92672">&gt;</span>
    select * from mybatis.user where name like &#34;%&#34;#{value}&#34;%&#34;
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h2 id="配置解析">配置解析</h2>
<h3 id="核心配置文件">核心配置文件</h3>
<ul>
<li>mybatis-config.xml</li>
<li>MyBatis的配置文件包含了会深深影响MyBatis行为的设置和属性信息</li>
</ul>
<pre><code>configuration（配置）
properties（属性）
settings（设置）
typeAliases（类型别名）
typeHandlers（类型处理器）
objectFactory（对象工厂）
plugins（插件）
environments（环境配置）
environment（环境变量）
transactionManager（事务管理器）
dataSource（数据源）
databaseIdProvider（数据库厂商标识）
mappers（映射器）
</code></pre><h3 id="环境配置environments">环境配置(environments)</h3>
<p>MyBatis 可以配置成适应多种环境<br>
<strong>尽管可以配置多个环境，但每个 SqlSessionFactory 实例只能选择一种环境。</strong></p>
<p>MyBatis默认的事务管理器就是JDBC，连接池POOLED</p>
<h3 id="属性properties">属性(properties)</h3>
<p>我们可以通过properties属性来实现引用配置文件</p>
<p>这些属性可以在外部进行配置，并可以进行动态替换。你既可以在典型的 Java 属性文件中配置这些属性，也可以在 properties 元素的子元素中设置。</p>
<p>编写一个配置文件
db.properties</p>
<pre><code class="language-properties" data-lang="properties">driver=com.mysql.cj.jdbc.Driver
url=jdbc:mysql://localhost:3306/mybatis?userSSL=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC
username=root
password=123456
</code></pre><p>在xml中，所有标签都可以规定其顺序</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--引入外部配置文件--&gt;</span>
<span style="color:#f92672">&lt;properties</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;db.properties&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>也可以引入外部配置文件，再加上一些</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--引入外部配置文件--&gt;</span>
<span style="color:#f92672">&lt;properties</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;db.properties&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;A&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;hhh&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;property</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;B&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;123&#34;</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/properties&gt;</span>
</code></pre></div><h3 id="类型别名typealiases">类型别名(typeAliases)</h3>
<ul>
<li>类型别名是为 Java 类型设置一个短的名字</li>
<li>存在的意义仅在于用来减少类完全限定名的冗余</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--可以给实体类起别名--&gt;</span>
<span style="color:#f92672">&lt;typeAliases&gt;</span>
    <span style="color:#f92672">&lt;typeAlias</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;com.luo.pojo.User&#34;</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;User&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/typeAliases&gt;</span>
</code></pre></div><p>也可以指定一个包名，MyBatis 会在包名下面搜索需要的Java Bean，比如：
扫描实体类的包，它的默认别名就为这个类的类名的首字母小写！<br>
比如扫描<code>com.luo.pojo</code> 这个包，就默认里面的<code>com.luo.pojo.User</code> 的别名为user</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;typeAliases&gt;</span>
    <span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;com.luo.pojo&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/typeAliases&gt;</span>
</code></pre></div><p>在实体类比较少的时候，使用第一种方式<br>
如果实体类比较多，建议使用第二种方式。<br>
第一种可以DIY别名，第二种则不行，如果一定要改，可以在实体类上增加注解</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Alias</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;User&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span><span style="color:#f92672">{</span>
    <span style="color:#75715e">// 代码
</span><span style="color:#75715e"></span><span style="color:#f92672">}</span>
</code></pre></div><h3 id="设置settings">设置(settings)</h3>
<p>这是 MyBatis 中极为重要的调整设置，它们会改变 MyBatis 的运行时行为。 下表描述了设置中各项设置的含义、默认值等。<br>
<a href="https://mybatis.org/mybatis-3/zh/configuration.html#settings">设置表格</a></p>
<table>
<thead>
<tr>
<th>设置名</th>
<th>描述</th>
<th>有效值</th>
<th>默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td>cacheEnabled</td>
<td>全局性地开启或关闭所有映射器配置文件中已配置的任何缓存.</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置 fetchType属性来覆盖该项的开关状态</td>
<td>true|false</td>
<td>false</td>
</tr>
<tr>
<td>logImpl</td>
<td>指定 MyBatis 所用日志的具体实现，未指定时将自动查找。</td>
<td>SLF4J | LOG4J | LOG4J2 | JDK_LOGGING | COMMONS_LOGGING | STDOUT_LOGGING | NO_LOGGING</td>
<td>未设置</td>
</tr>
</tbody>
</table>
<h3 id="其他配置">其他配置</h3>
<ul>
<li>typeHandlers（类型处理器）</li>
<li>objectFactory（对象工厂）</li>
<li>plugins（插件）
<ul>
<li>mybatis-generator-core</li>
<li>mybatis-plus</li>
<li>通用mapper</li>
</ul>
</li>
</ul>
<h3 id="映射器mappers">映射器(mappers)</h3>
<p>MapperRegistry：注册绑定我们的Mapper文件</p>
<p>方式一：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--每一个Mapper.xml都需要在MyBatis核心配置文件中注册--&gt;</span>
<span style="color:#f92672">&lt;mappers&gt;</span>
    <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;com/luo/dao/UserMapper.xml&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/mappers&gt;</span>
</code></pre></div><p>方式二： 使用class文件绑定</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mappers&gt;</span>
    <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.luo.dao.UserMapper&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/mappers&gt;</span>
</code></pre></div><p>注意点：</p>
<ul>
<li>接口和他的Mapper配置文件必须同名</li>
<li>接口和他的Mapper配置文件必须放在同一个包下</li>
</ul>
<p>方式三：使用扫描包进行绑定</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;mappers&gt;</span>
    <span style="color:#f92672">&lt;package</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;com.luo.dao&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/mappers&gt;</span>
</code></pre></div><p>注意点：</p>
<ul>
<li>接口和他的Mapper配置文件必须同名</li>
<li>接口和他的Mapper配置文件必须放在同一个包下</li>
</ul>
<h3 id="生命周期和作用域">生命周期和作用域</h3>
<p>声明周期和作用域，是至关重要的，因为错误的使用会导致非常严重的<strong>并发问题</strong></p>
<p><strong>SqlSessionFactoryBuilder</strong>：</p>
<ul>
<li>一旦创建了SqlSessionFactory，就不再需要他了</li>
<li>局部变量</li>
</ul>
<p><strong>SqlSessionFactory</strong>：</p>
<ul>
<li>说白了就可以想象为：数据库连接池</li>
<li>SqlSessionFactory一旦被创建就应该在应用的运行期间一致存在，没有任何理由丢弃它或重新创建另一个实例</li>
<li>因此 SqlSessionFactory 的最佳作用域是应用作用域</li>
<li>最简单的就是使用单例模式或静态单例模式</li>
</ul>
<p><strong>SqlSession</strong>：</p>
<ul>
<li>连接到连接池的一个请求SqlSession的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域</li>
<li>用完之后要赶紧关闭，否则资源被占用</li>
</ul>
<p>Session可以执行不同的业务(对应不同的Mapper)</p>
<h2 id="解决属性名和字段名不一致的问题">解决属性名和字段名不一致的问题</h2>
<h3 id="问题">问题</h3>
<p>数据库中的字段</p>
<p>新建一个项目，拷贝之前的，测试·测试实体类字段不一致的情况</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>测试出现问题</p>
<pre><code>// select * from mybatis.user where id = #{id}
// 类型处理器
// select id, name, pwd from mybatis.user where id = #{id}
</code></pre><p>解决方法：<br>
最简单的，起别名</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> id, name, pwd <span style="color:#66d9ef">as</span> password <span style="color:#66d9ef">from</span> mybatis.<span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> id <span style="color:#f92672">=</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id<span style="color:#960050;background-color:#1e0010">}</span>
</code></pre></div><h3 id="resultmap">resultMap</h3>
<p>结果集映射</p>
<pre><code>id name pwd
id name password
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;UserMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;User&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">&lt;!--column数据库中的字段，property实体类中的属性--&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pwd&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;name&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/resultMap&gt;</span>

<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserById&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;UserMap&#34;</span><span style="color:#f92672">&gt;</span>
    select id, name, pwd as password from mybatis.user where id = #{id}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><ul>
<li><strong>resultMap</strong> 元素是MyBatis中最重要最强大的元素</li>
<li>ResultMap 的设计思想是，对于简单的语句根本不需要配置显式的结果映射，而对于复杂一点的语句只需要描述他们的关系就行了</li>
<li>resultMap 最优秀的地方在于，虽然你已经对它相当了解了，但是根本就不需要显式地用到他们</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;UserMap&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;User&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#75715e">&lt;!--column数据库中的字段，property实体类中的属性--&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;pwd&#34;</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;password&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/resultMap&gt;</span>
</code></pre></div><p>之前的resultMap可以将相同的去掉，只留下需要更改的映射</p>
<h2 id="日志">日志</h2>
<h3 id="日志工厂">日志工厂</h3>
<p>如果一个数据库操作，出现了异常，我们需要排错。日志就是最好的助手！<br>
之前：sout、debug<br>
现在：日志工厂<br>
MyBatis有一个logImpl</p>
<ul>
<li>SLF4J</li>
<li>LOG4J【需掌握】</li>
<li>LOG4J2</li>
<li>JDK_LOGGING</li>
<li>COMMONS_LOGGING</li>
<li>STDOUT_LOGGING【需掌握】</li>
<li>NO_LOGGING</li>
</ul>
<p>在MyBatis中具体使用哪一个体制实现，在设置中设定<br>
<strong>STDOUT_LOGGING 标准日志输出</strong></p>
<h3 id="log4j">Log4j</h3>
<p>要在settings里配置，除此之外还要添加依赖</p>
<p>什么是Log4j?</p>
<ul>
<li>Log4j是Apache的一个开源项目，通过使用Log4j，我们可以控制日志信息输送的目的地是控制台、文件、GUI组件</li>
<li>我们可以控制每一条日志的输出格式</li>
<li>通过定义每一条日志信息的级别，我们能够更加细致地控制日志的生成过程</li>
<li>这些可以通过一个配置文件来灵活地进行配置，而不需要修改应用的代码</li>
</ul>
<ol>
<li>导入log4j的包</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>log4j<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>log4j<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.2.17<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><ol start="2">
<li>log4j.properties</li>
</ol>
<pre><code class="language-properties" data-lang="properties"># 将等级为DEBUG的日志输出到console和file这两个目的地，console和file的定义在下面
log4j.rootLogger=DEBUG,console,file

# 控制台输出的相关设置
log4j.appender.console = org.apache.log4j.ConsoleAppender
log4j.appender.console.Target = System.out
log4j.appender.console.Threshold = DEBUG
log4j.appender.console.layout = org.apache.log4j.PatternLayout
log4j.appender.console.layout.ConversionPattern=[%c]-%m%n

# 文件输出的相关设置
log4j.appender.file = org.apache.log4j.RollingFileAppender
log4j.appender.file.File=./log/debug.log
log4j.appender.file.MaxFileSize=10mb
log4j.appender.file.Threshold=DEBUG
log4j.appender.file.layout = org.apache.log4j.PatternLayout
log4j.appender.file.layout.ConversionPattern=[%p][%d{yy-MM-dd}][%c]-%m%n

# 日志输出级别
log4j.logger.org.mybatis=DEBUG
log4j.logger.java.sql=DEBUG
log4j.logger.java.sql.Statement=DEBUG
log4j.logger.java.sql.ResultSet=DEBUG
log4j.logger.java.sql.PreparedStatement=DEBUG
</code></pre><ol start="3">
<li>配置log4j为日志的实现</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;settings&gt;</span>
    <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;logImpl&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;LOG4J&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/settings&gt;</span>
</code></pre></div><ol start="4">
<li>Log4j的使用，直接运行之前的测试</li>
</ol>
<p><strong>简单使用</strong></p>
<ol>
<li>在要使用Log4j的类中，导入包</li>
<li>日志对象，参数为当前类的class</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">static</span> Logger logger <span style="color:#f92672">=</span> logger<span style="color:#f92672">.</span><span style="color:#a6e22e">getLogger</span><span style="color:#f92672">(</span>UserDaoTest<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><ol start="3">
<li>日志级别</li>
</ol>
<ul>
<li>info</li>
<li>debug</li>
<li>error</li>
</ul>
<h2 id="分页">分页</h2>
<p>为什么要分页？</p>
<ul>
<li>减少数据的处理量</li>
</ul>
<h3 id="使用limit分页">使用Limit分页</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">limit</span> <span style="color:#ae81ff">3</span>; <span style="color:#f92672">#</span> <span style="color:#960050;background-color:#1e0010">相当于</span>[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">3</span>]
</code></pre></div><p>使用Mybatis实现分页，核心SQL</p>
<ol>
<li>接口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getUserByLimit</span><span style="color:#f92672">(</span>Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Integer<span style="color:#f92672">&gt;</span> map<span style="color:#f92672">);</span>
</code></pre></div><ol start="2">
<li>Mapper.xml</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserByLimit&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;User&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;UserMap&#34;</span><span style="color:#f92672">&gt;</span>
    select * from mybatis.user limit #{startIndex},#{pageSize}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><ol start="3">
<li>测试</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUserByLimit</span><span style="color:#f92672">(){</span>

    <span style="color:#75715e">// 获得SqlSession对象
</span><span style="color:#75715e"></span>    SqlSession sqlSession <span style="color:#f92672">=</span> MybatisUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>


    <span style="color:#75715e">// 执行Sql
</span><span style="color:#75715e"></span>    UserMapper mapper <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>UserMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    Map<span style="color:#f92672">&lt;</span>String<span style="color:#f92672">,</span> Integer<span style="color:#f92672">&gt;</span> map <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> HashMap<span style="color:#f92672">&lt;&gt;();</span>

    map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;startIndex&#34;</span><span style="color:#f92672">,</span>0<span style="color:#f92672">);</span>
    map<span style="color:#f92672">.</span><span style="color:#a6e22e">put</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;pageSize&#34;</span><span style="color:#f92672">,</span>2<span style="color:#f92672">);</span>

    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> userList <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">getUserByLimit</span><span style="color:#f92672">(</span>map<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>User user <span style="color:#f92672">:</span> userList<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>


    <span style="color:#75715e">// 关闭SqlSession
</span><span style="color:#75715e"></span>    sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="rowbounds分页了解即可">RowBounds分页(了解即可)</h3>
<p>不再使用SQL实现分页</p>
<ol>
<li>接口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getUserByRowBounds</span><span style="color:#f92672">();</span>
</code></pre></div><ol start="2">
<li>mapper.xml</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getUserByRowBounds&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;UserMap&#34;</span><span style="color:#f92672">&gt;</span>
    select * from mybatis.user
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><ol start="3">
<li>测试</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">getUserByRowBounds</span><span style="color:#f92672">(){</span>
    <span style="color:#75715e">// 获得SqlSession对象
</span><span style="color:#75715e"></span>    SqlSession sqlSession <span style="color:#f92672">=</span> MybatisUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>

    <span style="color:#75715e">// RowBounds 实现
</span><span style="color:#75715e"></span>    RowBounds rowBounds <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> RowBounds<span style="color:#f92672">(</span>1<span style="color:#f92672">,</span> 2<span style="color:#f92672">);</span>

    List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> userList <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">selectList</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;com.luo.dao.UserMapper.getUserByRowBounds&#34;</span><span style="color:#f92672">,</span><span style="color:#66d9ef">null</span><span style="color:#f92672">,</span>rowBounds<span style="color:#f92672">);</span>

    <span style="color:#66d9ef">for</span> <span style="color:#f92672">(</span>User user <span style="color:#f92672">:</span> userList<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
    <span style="color:#f92672">}</span>

    <span style="color:#75715e">// 关闭SqlSession
</span><span style="color:#75715e"></span>    sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="分页插件">分页插件</h3>
<p>例如：MaBatis分页插件 PageHelper（了解即可）</p>
<h2 id="使用注解开发">使用注解开发</h2>
<h3 id="面向接口编程">面向接口编程</h3>
<ul>
<li>
<p>大家之前都学过面向对象编程,也学习过接口，但在真正的开发中，很多时候我们会选择面向接口编程</p>
</li>
<li>
<p><strong>根本原因: 解耦 ,可拓展,提高复用,分层开发中,上层不用管具体的实现,大家都遵守共同的标准,使得开发变得容易,规范性更好</strong></p>
</li>
<li>
<p>在一个面向对象的系统中，系统的各种功能是由许许多多的不同对象协作完成的。在这种情况下，各个对象内部是如何实现自己的，对系统设计人员来讲就不那么重要了;</p>
</li>
<li>
<p>而各个对象之间的协作关系则成为系统设计的关键。小到不同类之间的通信，大到各模块之间的交互,在系统设计之初都是要着重考虑的，这也是系统设计的主要工作内容。面向接口编程就是指按照这种思想来编程。</p>
</li>
</ul>
<p><strong>关于接口的理解</strong></p>
<ul>
<li>接口从更深层次的理解，应是定义(规范， 约束)与实现(名实分离的原则)的分离。接口的本身反映了系统设计人员对系统的抽象理解。</li>
<li>接口应有两类:
<ul>
<li>第一类是对一个个体的抽象，它可对应为一个抽象体(abstract class);</li>
<li>第二类是对一个个体某一 方面的抽象，即形成一 个抽象面(interface) ;</li>
</ul>
</li>
<li>个体有可能有多个抽象面。抽象体与抽象面是有区别的。</li>
</ul>
<p><strong>三个面向区别</strong></p>
<ul>
<li>
<p>面向对象是指,我们考虑问题时，以对象为单位，考虑它的属性及方法.</p>
</li>
<li>
<p>面向过程是指，我们考虑问题时，以一个具体的流程(事务过程)为单位，考虑它的实现.</p>
</li>
<li>
<p>接口设计与非接口设计是针对复用技术而言的，与面向对象(过程)不是一个问题.更多的体现就是对系统整体的架构.</p>
</li>
</ul>
<h3 id="使用注解开发-1">使用注解开发</h3>
<ol>
<li>注解在接口上实现</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select * from user&#34;</span><span style="color:#f92672">)</span>
List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getUsers</span><span style="color:#f92672">();</span>
</code></pre></div><ol start="2">
<li>需要在核心配置文件中绑定接口</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--绑定接口--&gt;</span>
<span style="color:#f92672">&lt;mappers&gt;</span>
    <span style="color:#f92672">&lt;mapper</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.luo.dao.UserMapper&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/mappers&gt;</span>
</code></pre></div><ol start="3">
<li>测试</li>
</ol>
<p>本质：反射</p>
<p>MyBatis详细的执行流程</p>
<ol>
<li>Rescource获取加载全局配置文件</li>
<li>实例化SqlSessionFactoryBuilder构造器</li>
<li>解析配置文件流XMLConfigBuilder</li>
<li>Configuration所有的配置信息</li>
<li>SqlSessionFactory实例化</li>
<li>transactional事务管理</li>
<li>创建executor执行器</li>
<li>创建SqlSession</li>
<li>实现CRUD
<ol>
<li>查看是否成功
<ol>
<li>否，回滚</li>
<li>是，提交事务(可以手动提交)</li>
</ol>
</li>
</ol>
</li>
<li>关闭</li>
</ol>
<h3 id="crud-1">CRUD</h3>
<p>我们可以在工具类创建的时候实现自动提交事务</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#66d9ef">public</span> <span style="color:#66d9ef">static</span> SqlSession <span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">(){</span>
    <span style="color:#66d9ef">return</span> sqlSessionFactory<span style="color:#f92672">.</span><span style="color:#a6e22e">openSession</span><span style="color:#f92672">(</span><span style="color:#66d9ef">true</span><span style="color:#f92672">);</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>编写接口，增加注解</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select id,name,pwd as password from user&#34;</span><span style="color:#f92672">)</span>
List<span style="color:#f92672">&lt;</span>User<span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">getUsers</span><span style="color:#f92672">();</span>

<span style="color:#75715e">// 方法存在多个参数，所有参数前面必须加上 @Param(&#34;id&#34;)注解，其实是参数名
</span><span style="color:#75715e"></span><span style="color:#a6e22e">@Select</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;select id,name,pwd as password from user where id = #{id}&#34;</span><span style="color:#f92672">)</span>
User <span style="color:#a6e22e">getUserById</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">);</span>

<span style="color:#a6e22e">@Insert</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;insert into user(id, name ,pwd) values (#{id},#{name},#{password})&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">addUser</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">);</span>

<span style="color:#a6e22e">@Update</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;update user set name=#{name},pwd=#{password} where id=#{id}&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">updateUser</span><span style="color:#f92672">(</span>User user<span style="color:#f92672">);</span>

<span style="color:#a6e22e">@Delete</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;delete from user where id = #{uid}&#34;</span><span style="color:#f92672">)</span>
<span style="color:#66d9ef">int</span> <span style="color:#a6e22e">deleteUser</span><span style="color:#f92672">(</span><span style="color:#a6e22e">@Param</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;uid&#34;</span><span style="color:#f92672">)</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">);</span>
</code></pre></div><p>【注意：必须要将接口注册绑定到核心配置文件中】</p>
<p><strong>关于@Param注解</strong></p>
<ul>
<li>基本类型的参数或者String类型，需要加上</li>
<li>引用类型不需要加</li>
<li>如果只有一个基本类型的话，可以忽略，但是建议加上</li>
<li>我们在SQL中引用的，就是我们这里的@Param()中设定的属性名</li>
</ul>
<p>#{} 和 ${} 的区别？ <br>
一般用#{}，可以防止SQL注入 <br>
${} 会进行SQL拼接</p>
<h2 id="lombok">Lombok</h2>
<p>主要作用：偷懒</p>
<p>使用方法</p>
<ol>
<li>下载：File-&gt;settings-&gt;Plugins-&gt;lombok</li>
<li>导入lombok依赖</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.projectlombok<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>lombok<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.18.10<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><ol start="3">
<li>在实体类上加注解</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">User</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String password<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><pre><code>@Getter and @Setter
@FieldNameConstants
@ToString
@EqualsAndHashCode
@AllArgsConstructor, @RequiredArgsConstructor and @NoArgsConstructor
@Log, @Log4j, @Log4j2, @Slf4j, @XSlf4j, @CommonsLog, @JBossLog, @Flogger, @CustomLog
@Data
@Builder
@SuperBuilder
@Singular
@Delegate
@Value
@Accessors
@Wither
@With
@SneakyThrows
@val
@var
experimental @var
@UtilityClass
Lombok config system
Code inspections
Refactoring actions (lombok and delombok)
</code></pre><p>说明：</p>
<pre><code>@Data：无参构造，get、set、toString、hashcode、equals
@AllArgsConstructor
@NoArgsConstructor
</code></pre><h2 id="多对一处理">多对一处理</h2>
<ul>
<li>多个学生，对应一个老师</li>
<li>对于学生这边而言，关联，多个学生关联一个老师【多对一】</li>
<li>对于老师而言，集合，一个老师有很多学生【一对多】</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">DATABASE</span> <span style="color:#f92672">`</span>mybatis<span style="color:#f92672">`</span>;

USE <span style="color:#f92672">`</span>mysqtis<span style="color:#f92672">`</span>;

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>(
  <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">20</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>,
  <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
  <span style="color:#f92672">`</span>pwd<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>
)ENGINE<span style="color:#f92672">=</span>INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span>(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>pwd<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>
(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;你好&#39;</span>,<span style="color:#e6db74">&#39;123231&#39;</span>),
(<span style="color:#ae81ff">2</span>,<span style="color:#e6db74">&#39;asd&#39;</span>,<span style="color:#e6db74">&#39;adsas&#39;</span>),
(<span style="color:#ae81ff">3</span>,<span style="color:#e6db74">&#39;aaaaa&#39;</span>,<span style="color:#e6db74">&#39;aaasd123&#39;</span>)

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> <span style="color:#f92672">`</span><span style="color:#66d9ef">user</span><span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>pwd<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span> (<span style="color:#ae81ff">4</span>,<span style="color:#f92672">`</span><span style="color:#960050;background-color:#1e0010">张一</span><span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;123456&#39;</span>),(<span style="color:#ae81ff">5</span>,<span style="color:#f92672">`</span><span style="color:#960050;background-color:#1e0010">张二</span><span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;123456&#39;</span>),(<span style="color:#ae81ff">6</span>,<span style="color:#f92672">`</span><span style="color:#960050;background-color:#1e0010">张三</span><span style="color:#f92672">`</span>,<span style="color:#e6db74">&#39;123456&#39;</span>);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>teacher<span style="color:#f92672">`</span>(
 <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
 <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
 <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
)ENGINE<span style="color:#f92672">=</span>INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;

<span style="color:#66d9ef">INSERT</span> <span style="color:#66d9ef">INTO</span> teacher(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>,<span style="color:#f92672">`</span>name<span style="color:#f92672">`</span>) <span style="color:#66d9ef">VALUES</span>(<span style="color:#ae81ff">1</span>,<span style="color:#e6db74">&#39;洛某&#39;</span>);

<span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>student<span style="color:#f92672">`</span>(
    <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#f92672">`</span>name<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#f92672">`</span>tid<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">10</span>) <span style="color:#66d9ef">DEFAULT</span> <span style="color:#66d9ef">NULL</span>,
    <span style="color:#66d9ef">PRIMARY</span> <span style="color:#66d9ef">KEY</span>(<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>),
    <span style="color:#66d9ef">KEY</span> <span style="color:#f92672">`</span>fktid<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>tid<span style="color:#f92672">`</span>),
    <span style="color:#66d9ef">CONSTRAINT</span> <span style="color:#f92672">`</span>fktid<span style="color:#f92672">`</span> <span style="color:#66d9ef">FOREIGN</span> <span style="color:#66d9ef">KEY</span> (<span style="color:#f92672">`</span>tid<span style="color:#f92672">`</span>) <span style="color:#66d9ef">REFERENCES</span> <span style="color:#f92672">`</span>teacher<span style="color:#f92672">`</span> (<span style="color:#f92672">`</span>id<span style="color:#f92672">`</span>)
)ENGINE<span style="color:#f92672">=</span>INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;

<span style="color:#f92672">`</span>student<span style="color:#f92672">``</span>teacher<span style="color:#f92672">`</span>
</code></pre></div><h3 id="测试环境搭建">测试环境搭建</h3>
<ol>
<li>导入lombok</li>
<li>新建实体类Teacher、Student</li>
<li>建立Mapper接口</li>
<li>建立Mapper.xml文件</li>
<li>在核心配置文件中绑定注册我们的Mapper接口或者文件</li>
<li>测试</li>
</ol>
<h3 id="按照查询嵌套处理">按照查询嵌套处理</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--
</span><span style="color:#75715e">    思路：
</span><span style="color:#75715e">        1. 查询所有的学生信息
</span><span style="color:#75715e">        2. 根据查询出来的学生的tid，寻找对应的老师
</span><span style="color:#75715e">    --&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getStudents&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;StudentTeacher&#34;</span><span style="color:#f92672">&gt;</span>
    select * from student
<span style="color:#f92672">&lt;/select&gt;</span>

<span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;StudentTeacher&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Student&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#75715e">&lt;!--复杂的情况我们需要单独处理
</span><span style="color:#75715e">        对象：association
</span><span style="color:#75715e">        集合：collection
</span><span style="color:#75715e">    --&gt;</span>
    <span style="color:#f92672">&lt;association</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;teacher&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tid&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;Teacher&#34;</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34;getTeacher&#34;</span><span style="color:#f92672">/&gt;</span>

<span style="color:#f92672">&lt;/resultMap&gt;</span>

<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getTeacher&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Teacher&#34;</span><span style="color:#f92672">&gt;</span>
    select * from teacher where id = #{id}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h3 id="按结果嵌套处理">按结果嵌套处理</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--按照结果嵌套处理--&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getStudents2&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;StudentTeacher2&#34;</span><span style="color:#f92672">&gt;</span>
    select s.id sid, s.name sname, t.name tname, s.tid stid
    from student s, teacher t
    where s.tid = t.id
<span style="color:#f92672">&lt;/select&gt;</span>

<span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;StudentTeacher2&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Student&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;sid&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;sname&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;association</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;teacher&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;Teacher&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;stid&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tname&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/association&gt;</span>
<span style="color:#960050;background-color:#1e0010">&lt;</span>/resultMap
</code></pre></div><p>回顾Mysql多对一查询方式：</p>
<ul>
<li>子查询</li>
<li>联表查询</li>
</ul>
<h2 id="一对多处理">一对多处理</h2>
<p>比如：一个老师拥有多个学生！<br>
对于老师而言，就是一对多的关系</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Student</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> tid<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Teacher</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String name<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> List<span style="color:#f92672">&lt;</span>Student<span style="color:#f92672">&gt;</span> students<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><h3 id="按照结果嵌套处理">按照结果嵌套处理</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--按结果嵌套查询--&gt;</span>
<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getTeacher&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;TeacherStudent&#34;</span><span style="color:#f92672">&gt;</span>
    select s.id sid, s.name sname, t.name tname, t.id tid
    from student s, teacher t
    where s.tid = t.id and t.id = #{tid}
<span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;TeacherStudent&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Teacher&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tid&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tname&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#75715e">&lt;!--复杂属性，我们需要单独处理
</span><span style="color:#75715e">    对象：association
</span><span style="color:#75715e">    集合：collection
</span><span style="color:#75715e">    javaType=”“指定属性的类型
</span><span style="color:#75715e">    集合中的泛型信息，我们使用ofType获取
</span><span style="color:#75715e">    --&gt;</span>
    <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;students&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;Student&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;sid&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;sname&#34;</span><span style="color:#f92672">/&gt;</span>
        <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;tid&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;tid&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;/collection&gt;</span>
<span style="color:#f92672">&lt;/resultMap&gt;</span>
</code></pre></div><h3 id="按照查询嵌套处理-1">按照查询嵌套处理</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getTeacher2&#34;</span> <span style="color:#a6e22e">resultMap=</span><span style="color:#e6db74">&#34;TeacherStudent2&#34;</span><span style="color:#f92672">&gt;</span>
    select * from teacher where id = #{tid}
<span style="color:#f92672">&lt;/select&gt;</span>
<span style="color:#f92672">&lt;resultMap</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;TeacherStudent2&#34;</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;Teacher&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;result</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;collection</span> <span style="color:#a6e22e">property=</span><span style="color:#e6db74">&#34;students&#34;</span> <span style="color:#a6e22e">javaType=</span><span style="color:#e6db74">&#34;ArrayList&#34;</span> <span style="color:#a6e22e">ofType=</span><span style="color:#e6db74">&#34;Student&#34;</span> <span style="color:#a6e22e">column=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#a6e22e">select=</span><span style="color:#e6db74">&#34;getStudentByTeacherId&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/resultMap&gt;</span>

<span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;getStudentByTeacherId&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Student&#34;</span><span style="color:#f92672">&gt;</span>
    select * from student where tid = #{tid}
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h3 id="小结">小结</h3>
<ol>
<li>关联-association【多对一】</li>
<li>集合-collection【一对多】</li>
<li>javaType &amp; ofType
<ol>
<li>javaType 用来指定实体类中属性的类型</li>
<li>ofType 用来指定映射到List或者集合中的pojo类型，泛型中的约束类型！</li>
</ol>
</li>
</ol>
<p>注意点：</p>
<ul>
<li>保证SQL的可读性，尽量保证通俗易懂</li>
<li>注意一对多和多对一中，属性名和字段名的问题</li>
<li>如果问题不好排查错误，可以使用日志，建议使用Log4j</li>
</ul>
<p>面试高频：</p>
<ul>
<li>MySql引擎</li>
<li>InnoDB底层原理</li>
<li>索引</li>
<li>索引优化</li>
</ul>
<h2 id="动态sql">动态SQL</h2>
<p>什么是动态SQL？<br>
<strong>动态SQL就是指根据不同的条件生成不同的SQL语句</strong></p>
<pre><code>if
choose (when, otherwise)
trim (where, set)
foreach
</code></pre><h3 id="搭建环境-1">搭建环境</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">CREATE</span> <span style="color:#66d9ef">TABLE</span> <span style="color:#f92672">`</span>blog<span style="color:#f92672">`</span> (
    <span style="color:#f92672">`</span>id<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">50</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;博客id&#39;</span>,
    <span style="color:#f92672">`</span>title<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">100</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;博客标题&#39;</span>,
    <span style="color:#f92672">`</span>author<span style="color:#f92672">`</span> VARCHAR(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;博客作者&#39;</span>,
    <span style="color:#f92672">`</span>create_time<span style="color:#f92672">`</span> DATETIME <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;创建时间&#39;</span>,
    <span style="color:#f92672">`</span>views<span style="color:#f92672">`</span> INT(<span style="color:#ae81ff">30</span>) <span style="color:#66d9ef">NOT</span> <span style="color:#66d9ef">NULL</span> <span style="color:#66d9ef">COMMENT</span> <span style="color:#e6db74">&#39;浏览量&#39;</span>
)ENGINE<span style="color:#f92672">=</span>INNODB <span style="color:#66d9ef">DEFAULT</span> CHARSET<span style="color:#f92672">=</span>utf8;
</code></pre></div><p>创建一个基础工程：</p>
<ol>
<li>导包</li>
<li>编写配置文件</li>
<li>编写实体类</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">
<span style="color:#a6e22e">@Data</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Blog</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> id<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String title<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> String author<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> Date createTime<span style="color:#f92672">;</span>
    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">int</span> views<span style="color:#f92672">;</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol start="4">
<li>编写实体类对应的Mapper接口和 Mapper.xml</li>
</ol>
<h3 id="if">if</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;queryBolgIf&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
    select * from blog where 1=1
    <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;title !=null&#34;</span><span style="color:#f92672">&gt;</span>
        and title = #{title}
    <span style="color:#f92672">&lt;/if&gt;</span>
    <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;author !=null&#34;</span><span style="color:#f92672">&gt;</span>
        and author = #{author}
    <span style="color:#f92672">&lt;/if&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>改进后的,用到了where标签</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;queryBolgIf&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
    select * from blog
    <span style="color:#f92672">&lt;where&gt;</span>
        <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;title !=null&#34;</span><span style="color:#f92672">&gt;</span>
            title = #{title}
        <span style="color:#f92672">&lt;/if&gt;</span>
        <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;author !=null&#34;</span><span style="color:#f92672">&gt;</span>
            and author = #{author}
        <span style="color:#f92672">&lt;/if&gt;</span>
    <span style="color:#f92672">&lt;/where&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h3 id="choosewhenotherwise">choose、when、otherwise</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;queryBlogChoose&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
    select * from blog
    <span style="color:#f92672">&lt;where&gt;</span>
        <span style="color:#f92672">&lt;choose&gt;</span>
            <span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;title != null&#34;</span><span style="color:#f92672">&gt;</span>
                title = #{title}
            <span style="color:#f92672">&lt;/when&gt;</span>
            <span style="color:#f92672">&lt;when</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;author != null&#34;</span><span style="color:#f92672">&gt;</span>
                author = #{author}
            <span style="color:#f92672">&lt;/when&gt;</span>
            <span style="color:#f92672">&lt;otherwise&gt;</span>
                views = #{views}
            <span style="color:#f92672">&lt;/otherwise&gt;</span>
        <span style="color:#f92672">&lt;/choose&gt;</span>
    <span style="color:#f92672">&lt;/where&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><h3 id="trimwhereset">trim、where、set</h3>
<p>where 元素只会在子元素返回任何内容的情况下才插入 “WHERE” 子句。而且，若子句的开头为 “AND” 或 “OR”，where 元素也会将它们去除。</p>
<p>如果 where 元素与你期望的不太一样，你也可以通过自定义 trim 元素来定制 where 元素的功能。比如，和 where 元素等价的自定义 trim 元素为：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;trim</span> <span style="color:#a6e22e">prefix=</span><span style="color:#e6db74">&#34;WHERE&#34;</span> <span style="color:#a6e22e">prefixOverrides=</span><span style="color:#e6db74">&#34;AND |OR &#34;</span><span style="color:#f92672">&gt;</span>
  ...
<span style="color:#f92672">&lt;/trim&gt;</span>
</code></pre></div><p>prefixOverrides 属性会忽略通过管道符分隔的文本序列（注意此例中的空格是必要的）。上述例子会移除所有 prefixOverrides 属性中指定的内容，并且插入 prefix 属性中指定的内容。</p>
<p>用于动态更新语句的类似解决方案叫做 set。set 元素可以用于动态包含需要更新的列，忽略其它不更新的列。</p>
<p><strong>所谓的动态SQL，本质还是SQL语句，只是我们可以在SQL层面去执行一个逻辑代码</strong></p>
<h3 id="foreach">foreach</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> <span style="color:#66d9ef">user</span> <span style="color:#66d9ef">where</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> <span style="color:#66d9ef">and</span> (id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span> <span style="color:#66d9ef">or</span> id <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span> <span style="color:#66d9ef">or</span> id<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>)
</code></pre></div><p>reach 元素的功能非常强大，它允许你指定一个集合，声明可以在元素体内使用的集合项（item）和索引（index）变量。它也允许你指定开头与结尾的字符串以及集合项迭代之间的分隔符。这个元素也不会错误地添加多余的分隔符。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;select</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;selectPostIn&#34;</span> <span style="color:#a6e22e">resultType=</span><span style="color:#e6db74">&#34;domain.blog.Post&#34;</span><span style="color:#f92672">&gt;</span>
  SELECT *
  FROM POST P
  WHERE ID in
  <span style="color:#f92672">&lt;foreach</span> <span style="color:#a6e22e">item=</span><span style="color:#e6db74">&#34;item&#34;</span> <span style="color:#a6e22e">index=</span><span style="color:#e6db74">&#34;index&#34;</span> <span style="color:#a6e22e">collection=</span><span style="color:#e6db74">&#34;list&#34;</span> <span style="color:#a6e22e">open=</span><span style="color:#e6db74">&#34;(&#34;</span> <span style="color:#a6e22e">separator=</span><span style="color:#e6db74">&#34;,&#34;</span> <span style="color:#a6e22e">close=</span><span style="color:#e6db74">&#34;)&#34;</span><span style="color:#f92672">&gt;</span>
        #{item}
  <span style="color:#f92672">&lt;/foreach&gt;</span>
<span style="color:#f92672">&lt;/select&gt;</span>
</code></pre></div><p>例子</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">&lt;</span><span style="color:#66d9ef">select</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;queryBlogForeach&#34;</span> parameterType<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;map&#34;</span> resultType<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Blog&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> blog
    <span style="color:#f92672">&lt;</span><span style="color:#66d9ef">where</span><span style="color:#f92672">&gt;</span>
        <span style="color:#f92672">&lt;</span>foreach collection<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ids&#34;</span> item<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;id&#34;</span> <span style="color:#66d9ef">open</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;(&#34;</span> separator<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;or&#34;</span> <span style="color:#66d9ef">close</span><span style="color:#f92672">=</span><span style="color:#e6db74">&#34;)&#34;</span><span style="color:#f92672">&gt;</span>
            id <span style="color:#f92672">=</span> <span style="color:#f92672">#</span><span style="color:#960050;background-color:#1e0010">{</span>id<span style="color:#960050;background-color:#1e0010">}</span>
        <span style="color:#f92672">&lt;/</span>foreach<span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;/</span><span style="color:#66d9ef">where</span><span style="color:#f92672">&gt;</span>
<span style="color:#f92672">&lt;/</span><span style="color:#66d9ef">select</span><span style="color:#f92672">&gt;</span>

<span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">假设</span>ids里面有三个元素1<span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">4</span>
<span style="color:#f92672">//</span> <span style="color:#960050;background-color:#1e0010">得到的</span>sql为
<span style="color:#f92672">//</span> <span style="color:#66d9ef">select</span> <span style="color:#f92672">*</span> <span style="color:#66d9ef">from</span> blog <span style="color:#66d9ef">WHERE</span> ( id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">or</span> id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span> <span style="color:#66d9ef">or</span> id <span style="color:#f92672">=</span> <span style="color:#f92672">?</span> )<span style="color:#960050;background-color:#1e0010">然后传入</span><span style="color:#ae81ff">1</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">2</span><span style="color:#960050;background-color:#1e0010">，</span><span style="color:#ae81ff">4</span>
</code></pre></div><h3 id="sql片段">SQL片段</h3>
<p>有时候，可能会将一些公共的部分抽取出来，以便于复用</p>
<ol>
<li>使用SQL标签抽取公共部分</li>
<li>在需要使用的地方使用include标签引用即可</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;sql</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;if-title-author&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;title !=null&#34;</span><span style="color:#f92672">&gt;</span>
        title = #{title},
    <span style="color:#f92672">&lt;/if&gt;</span>
    <span style="color:#f92672">&lt;if</span> <span style="color:#a6e22e">test=</span><span style="color:#e6db74">&#34;author != null&#34;</span><span style="color:#f92672">&gt;</span>
        author = #{author}
    <span style="color:#f92672">&lt;/if&gt;</span>
<span style="color:#f92672">&lt;/sql&gt;</span>

<span style="color:#f92672">&lt;update</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;updateBlog&#34;</span> <span style="color:#a6e22e">parameterType=</span><span style="color:#e6db74">&#34;map&#34;</span><span style="color:#f92672">&gt;</span>
    update blog
    <span style="color:#f92672">&lt;set&gt;</span>
        <span style="color:#f92672">&lt;include</span> <span style="color:#a6e22e">refid=</span><span style="color:#e6db74">&#34;if-title-author&#34;</span><span style="color:#f92672">&gt;&lt;/include&gt;</span>
    <span style="color:#f92672">&lt;/set&gt;</span>
    where id = #{id}
<span style="color:#f92672">&lt;/update&gt;</span>
</code></pre></div><p>注意事项：</p>
<ul>
<li>最好基于单表来定义SQL片段</li>
<li>不要存在where标签</li>
</ul>
<p>动态SQL就是在拼接SQL语句，我们只要保证SQL的正确性，按照SQL的格式，去排列组合就好了</p>
<p>建议：</p>
<ul>
<li>先在Mysql中写出完整的SQL，再对应地去修改成动态SQL实现通用的SQL</li>
</ul>
<h2 id="缓存">缓存</h2>
<h3 id="简介-1">简介</h3>
<pre><code>查询：连接数据库，耗费资源
一次查询的结果，给他暂存在一个可以直接取到的地方--&gt;内存：缓存

我们再次查询相同数据的时候，直接走缓存，就不用走数据库了
</code></pre><ol>
<li>什么是缓存【Cache】？
<ul>
<li>存在内存中的临时数据</li>
<li>将用户经常查询的数据放在缓存(内存)中，用户去查询数据就不用从磁盘(关系型数据库数据文件)查询，从缓存中查询，从而提高查询效率，解决了高并发系统的性能问题</li>
</ul>
</li>
<li>为什么使用缓存？
<ul>
<li>减少和数据库的交互次数，减少系统开销，提高系统效率</li>
</ul>
</li>
<li>是什么样的数据能使用缓存？
<ul>
<li>经常查询且不经常改变的数据</li>
</ul>
</li>
</ol>
<h3 id="mybatis缓存">MyBatis缓存</h3>
<ul>
<li>MyBatis包含了一个非常强大的查询缓存特性，他可以非常方便地定制和配置缓存。缓存可以极大地提升查询效率。</li>
<li>MyBatis系统中默认定义了两级缓存：<strong>一级缓存</strong>和<strong>二级缓存</strong>
<ul>
<li>默认情况下，只有一级缓存开启（SqlSession级别的缓存，也成为本地缓存）</li>
<li>二级缓存需要手动开启和配置，他是基于namespace级别的缓存</li>
<li>为了提高拓展性，MyBatis定义了缓存接口Cache。我们可以通过实现Cache接口来定义二级缓存</li>
</ul>
</li>
</ul>
<h3 id="一级缓存">一级缓存</h3>
<ul>
<li>一级缓存也叫本地缓存：SqlSession
<ul>
<li>与数据库同一次会话期间查询到的数据会放在本地缓存中</li>
<li>以后如果需要获取相同的数据，直接从缓存中拿，没必要再去查询数据库</li>
</ul>
</li>
</ul>
<p>测试步骤：</p>
<ol>
<li>开启日志</li>
<li>测试一个Session中查询两次相同记录</li>
<li>查看日志输出</li>
</ol>
<p>缓存失效的情况：</p>
<ol>
<li>查询不同的东西</li>
<li>增删改操作（只要操作了就会），可能会改变原来的数据，所以必定会刷新缓存</li>
<li>查询不同的Mapper.xml</li>
<li>手动清理缓存</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">clearCache</span><span style="color:#f92672">();</span>
</code></pre></div><p>小结：一级缓存是默认开启的，只在一次SqlSession中有效，也就是拿到连接一直到关闭连接这一段时间内</p>
<p>一级缓存就是一个Map</p>
<h3 id="二级缓存">二级缓存</h3>
<ul>
<li>二级缓存也叫全局缓存，一级缓存作用域太低了，所以诞生了二级缓存</li>
<li>基于namespace级别的缓存，一个名称空间，对应一个二级缓存</li>
<li>工作机制
<ul>
<li>一个会话查询一条数据，这个数据就会被放在当前会话的一级缓存中</li>
<li>如果当前会话关闭了，这个会话对应的一级缓存就没了；但是我们想要的是，会话关闭了，一级缓存中的数据被保存到二级缓存中</li>
<li>新的会话查询信息，就可以从二级缓存中获取内容</li>
<li>不同的mapper查出的数据会放在自己对应的缓存(map)中</li>
</ul>
</li>
</ul>
<p>步骤：</p>
<ol>
<li>开启全局缓存</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;settings&gt;</span>
    <span style="color:#75715e">&lt;!--显式地开启全局缓存--&gt;</span>
    <span style="color:#f92672">&lt;setting</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;cacheEnabled&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/settings&gt;</span>
</code></pre></div><ol start="2">
<li>在要使用二级缓存的Mapper中开启</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--在当前Mapper.xml中使用二级缓存--&gt;</span> 
<span style="color:#f92672">&lt;cache/&gt;</span>
</code></pre></div><p>也可以自定义参数</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;!--在当前Mapper.xml中使用二级缓存--&gt;</span> 
<span style="color:#f92672">&lt;cache</span>  <span style="color:#a6e22e">eviction=</span><span style="color:#e6db74">&#34;FIFO&#34;</span>
        <span style="color:#a6e22e">flushInterval=</span><span style="color:#e6db74">&#34;60000&#34;</span>
        <span style="color:#a6e22e">size=</span><span style="color:#e6db74">&#34;512&#34;</span>
        <span style="color:#a6e22e">readOnly=</span><span style="color:#e6db74">&#34;true&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><ol start="3">
<li>测试</li>
</ol>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#a6e22e">@Test</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">test</span><span style="color:#f92672">(){</span>
    SqlSession sqlSession <span style="color:#f92672">=</span> MybatisUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>
    SqlSession sqlSession2 <span style="color:#f92672">=</span> MybatisUtils<span style="color:#f92672">.</span><span style="color:#a6e22e">getSqlSession</span><span style="color:#f92672">();</span>

    UserMapper mapper <span style="color:#f92672">=</span> sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>UserMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
    UserMapper mapper2 <span style="color:#f92672">=</span> sqlSession2<span style="color:#f92672">.</span><span style="color:#a6e22e">getMapper</span><span style="color:#f92672">(</span>UserMapper<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>

    User user <span style="color:#f92672">=</span> mapper<span style="color:#f92672">.</span><span style="color:#a6e22e">queryUserById</span><span style="color:#f92672">(</span>7<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user<span style="color:#f92672">);</span>
    <span style="color:#75715e">// 要先关闭第一个sqlSession
</span><span style="color:#75715e"></span>    sqlSession<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>


    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;================================&#34;</span><span style="color:#f92672">);</span>

    User user2 <span style="color:#f92672">=</span> mapper2<span style="color:#f92672">.</span><span style="color:#a6e22e">queryUserById</span><span style="color:#f92672">(</span>7<span style="color:#f92672">);</span>
    System<span style="color:#f92672">.</span><span style="color:#a6e22e">out</span><span style="color:#f92672">.</span><span style="color:#a6e22e">println</span><span style="color:#f92672">(</span>user2<span style="color:#f92672">);</span>
    sqlSession2<span style="color:#f92672">.</span><span style="color:#a6e22e">close</span><span style="color:#f92672">();</span>
<span style="color:#f92672">}</span>
</code></pre></div><ol>
<li>问题：我们需要将实习类序列化，否则会报错</li>
</ol>
<p>小结：</p>
<ul>
<li>只要开启了二级缓存，在同一个Mapper下就有效</li>
<li>所有的数据都会先放在一级缓存中</li>
<li>只有当会话提交，或者关闭的时候，才会提交到二级缓存中</li>
</ul>
<h3 id="缓存原理">缓存原理</h3>
<p>缓存顺序</p>
<ol>
<li>先看二级缓存中有没有</li>
<li>再看一级缓存中有没有</li>
<li>查询数据库</li>
</ol>
<h3 id="自定义缓存-ehcache">自定义缓存-Ehcache</h3>
<pre><code>Ehcache 是一种广泛使用的开源Java分布式缓存。主要面向通用缓存,Java EE和轻量级容器
</code></pre>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
